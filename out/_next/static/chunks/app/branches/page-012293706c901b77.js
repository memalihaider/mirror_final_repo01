(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3063],{931:(e,a,s)=>{"use strict";s.d(a,{A:()=>i});var t=s(95155),r=s(12115),l=s(40283),n=s(35695);function i(e){let{children:a}=e,{userRole:s,loading:i}=(0,l.A)(),c=(0,n.usePathname)(),d=(0,n.useRouter)(),[o,u]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{if(!i&&s){let e=c.split("/")[1]||"dashboard",a=s.accessPages||[];"admin"===s.role||a.includes(e)?u(!0):(u(!1),d.replace("/access-denied"))}},[i,s,c,d]),i||!s)?(0,t.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600"}),(0,t.jsx)("span",{className:"ml-3 text-pink-600",children:"Checking access..."})]}):o?(0,t.jsx)(t.Fragment,{children:a}):null}},35695:(e,a,s)=>{"use strict";var t=s(18999);s.o(t,"usePathname")&&s.d(a,{usePathname:function(){return t.usePathname}}),s.o(t,"useRouter")&&s.d(a,{useRouter:function(){return t.useRouter}})},40283:(e,a,s)=>{"use strict";s.d(a,{A:()=>c,O:()=>d});var t=s(95155),r=s(12115),l=s(79323),n=s(56104);let i=(0,r.createContext)({user:null,userRole:null,loading:!0,isAdmin:!1,error:null,accessiblePages:[],canAccessPage:()=>!1}),c=()=>(0,r.useContext)(i),d=e=>{let{children:a}=e,[s,c]=(0,r.useState)(null),[d,o]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0),[h,g]=(0,r.useState)(null),[x,p]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e,a=!0;return(async()=>{try{m(!0),await (0,n.AU)(),e=(0,l.Bh)(async e=>{if(a){if(c(e),g(null),e)try{let s=await (0,l.uG)(e.uid);if(!s&&e.email){let a="ahmadxeikh786@gmail.com"===e.email?"admin":"user";await (0,l.yS)(e.uid,e.email,a,e.displayName||void 0,[]),s=await (0,l.uG)(e.uid)}(null==s?void 0:s.role)!=="admin"&&"ahmadxeikh786@gmail.com"===e.email&&(await (0,l.yS)(e.uid,e.email,"admin",e.displayName||void 0,[]),s=await (0,l.uG)(e.uid)),a&&(o(s),p((null==s?void 0:s.accessPages)||[]))}catch(e){console.error("Error getting user role:",e),a&&g("Failed to load user role")}else a&&(o(null),p([]));a&&m(!1)}})}catch(e){console.error("Firebase initialization error:",e),a&&(g("Failed to initialize authentication"),m(!1))}})(),()=>{a=!1,e&&e()}},[]);let v=(null==d?void 0:d.role)==="admin";return(0,t.jsx)(i.Provider,{value:{user:s,userRole:d,loading:u,isAdmin:v,error:h,accessiblePages:x,canAccessPage:e=>!!d&&("admin"===d.role||x.includes(e))},children:a})}},64255:(e,a,s)=>{Promise.resolve().then(s.bind(s,89141))},89141:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>c});var t=s(95155),r=s(12115),l=s(66766),n=s(43116),i=s(931);function c(){let[e,a]=(0,r.useState)([]),[s,c]=(0,r.useState)(!0),[o,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)(null),[g,x]=(0,r.useState)({name:"",address:"",phone:"",email:"",manager:"",openingHours:"",isActive:!0,image:"",city:"",country:"UAE"}),[p,v]=(0,r.useState)(null),[y,b]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,n.bm)(e=>{a(e),c(!1)},e=>{console.error("Firebase connection error:",e),c(!1),alert("Firebase connection error. Please check the setup guide.")});return()=>e()},[]);let j=async e=>{if(e.preventDefault(),g.name.trim()){b(!0);try{let e=null==m?void 0:m.imageBase64;if(p)try{e=await (0,n.w4)(p,800,.8)}catch(a){e=await (0,n.YF)(p)}m?await (0,n.Ub)(m.id,{name:g.name,address:g.address,phone:g.phone,email:g.email,manager:g.manager,openingHours:g.openingHours,isActive:g.isActive,city:g.city,country:g.country,imageBase64:e}):await (0,n.ys)({name:g.name,address:g.address,phone:g.phone,email:g.email,manager:g.manager,openingHours:g.openingHours,isActive:g.isActive,city:g.city,country:g.country,imageBase64:e}),f()}catch(e){console.error("Error saving branch:",e),alert("Error saving branch. Please try again.")}finally{b(!1)}}},f=()=>{x({name:"",address:"",phone:"",email:"",manager:"",openingHours:"",isActive:!0,image:"",city:"",country:"UAE"}),v(null),u(!1),h(null)},N=e=>{h(e),x({name:e.name,address:e.address,phone:e.phone,email:e.email,manager:e.manager,openingHours:e.openingHours,isActive:e.isActive,image:e.imageBase64||"",city:e.city,country:e.country}),v(null),u(!0)},w=async e=>{if(confirm("Delete this branch?"))try{await (0,n.SN)(e.id)}catch(e){console.error("Error deleting branch:",e),alert("Error deleting branch. Please try again.")}},A=async e=>{try{await (0,n.Ub)(e.id,{isActive:!e.isActive})}catch(e){console.error("Error updating branch status:",e),alert("Error updating branch status. Please try again.")}};return s?(0,t.jsx)(i.A,{children:(0,t.jsx)("div",{className:"p-3",children:(0,t.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600"}),(0,t.jsx)("span",{className:"ml-3 text-pink-600",children:"Loading branches..."})]})})})}):(0,t.jsxs)(i.A,{children:[(0,t.jsx)("div",{className:"p-3",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Branches"})}),0===e.length?(0,t.jsx)("p",{className:"text-center text-gray-500 py-12",children:"No branches found. Add your first branch."}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,t.jsx)(d,{branch:e,onEdit:N,onDelete:w,onToggleStatus:A},e.id))})]})}),o&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:m?"Edit Branch":"Add New Branch"}),(0,t.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,t.jsx)("input",{type:"text",placeholder:"Branch Name",value:g.name,onChange:e=>x({...g,name:e.target.value}),className:"w-full p-2 border rounded-lg",required:!0}),(0,t.jsx)("input",{type:"text",placeholder:"Address",value:g.address,onChange:e=>x({...g,address:e.target.value}),className:"w-full p-2 border rounded-lg",required:!0}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)("input",{type:"tel",placeholder:"Phone",value:g.phone,onChange:e=>x({...g,phone:e.target.value}),className:"w-full p-2 border rounded-lg"}),(0,t.jsx)("input",{type:"email",placeholder:"Email",value:g.email,onChange:e=>x({...g,email:e.target.value}),className:"w-full p-2 border rounded-lg"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)("input",{type:"text",placeholder:"Manager",value:g.manager,onChange:e=>x({...g,manager:e.target.value}),className:"w-full p-2 border rounded-lg"}),(0,t.jsx)("input",{type:"text",placeholder:"Opening Hours",value:g.openingHours,onChange:e=>x({...g,openingHours:e.target.value}),className:"w-full p-2 border rounded-lg"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)("input",{type:"text",placeholder:"City",value:g.city,onChange:e=>x({...g,city:e.target.value}),className:"w-full p-2 border rounded-lg"}),(0,t.jsx)("input",{type:"text",placeholder:"Country",value:g.country,onChange:e=>x({...g,country:e.target.value}),className:"w-full p-2 border rounded-lg"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Branch Image"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;let s=null==(a=e.target.files)?void 0:a[0];if(s){v(s);let e=new FileReader;e.onload=e=>{var a;x({...g,image:null==(a=e.target)?void 0:a.result})},e.readAsDataURL(s)}},className:"w-full"}),g.image&&(0,t.jsx)("div",{className:"mt-2 relative w-32 h-32",children:(0,t.jsx)(l.default,{src:g.image,alt:"Preview",fill:!0,className:"object-cover rounded-lg"})})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",checked:g.isActive,onChange:e=>x({...g,isActive:e.target.checked}),className:"mr-2"}),(0,t.jsx)("label",{children:"Active Branch"})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)("button",{type:"button",onClick:f,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:y,className:"px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors disabled:opacity-50",children:y?"Saving...":"Save Branch"})]})]})]})})]})}function d(e){let{branch:a,onEdit:s,onDelete:r,onToggleStatus:n}=e;return(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow",children:[a.imageBase64&&(0,t.jsx)("div",{className:"relative h-48 w-full",children:(0,t.jsx)(l.default,{src:a.imageBase64,alt:a.name,fill:!0,className:"object-cover"})}),(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:a.name}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:a.address}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[a.city,", ",a.country]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["Manager: ",a.manager]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["Phone: ",a.phone]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["Email: ",a.email]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-3",children:["Hours: ",a.openingHours]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("button",{onClick:()=>n(a),className:"px-3 py-1 rounded-full text-sm ".concat(a.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:a.isActive?"Active":"Inactive"}),(0,t.jsxs)("div",{className:"space-x-2",children:[(0,t.jsx)("button",{onClick:()=>s(a),className:"px-3 py-1 text-sm border rounded-lg hover:bg-gray-50",children:"Edit"}),(0,t.jsx)("button",{onClick:()=>r(a),className:"px-3 py-1 text-sm border rounded-lg hover:bg-gray-50 text-red-600",children:"Delete"})]})]})]})]})}}},e=>{e.O(0,[9135,7210,1748,6766,9323,3116,8441,5964,7358],()=>e(e.s=64255)),_N_E=e.O()}]);