(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1376],{931:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(95155),l=s(12115),i=s(40283),n=s(35695);function r(e){let{children:t}=e,{userRole:s,loading:r}=(0,i.A)(),c=(0,n.usePathname)(),d=(0,n.useRouter)(),[o,m]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{if(!r&&s){let e=c.split("/")[1]||"dashboard",t=s.accessPages||[];"admin"===s.role||t.includes(e)?m(!0):(m(!1),d.replace("/access-denied"))}},[r,s,c,d]),r||!s)?(0,a.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600"}),(0,a.jsx)("span",{className:"ml-3 text-pink-600",children:"Checking access..."})]}):o?(0,a.jsx)(a.Fragment,{children:t}):null}},19946:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a=s(12115);let l=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let r=(0,a.forwardRef)((e,t)=>{let{color:s="currentColor",size:l=24,strokeWidth:r=2,absoluteStrokeWidth:c,className:d="",children:o,iconNode:m,...u}=e;return(0,a.createElement)("svg",{ref:t,...n,width:l,height:l,stroke:s,strokeWidth:c?24*Number(r)/Number(l):r,className:i("lucide",d),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(u)&&{"aria-hidden":"true"},...u},[...m.map(e=>{let[t,s]=e;return(0,a.createElement)(t,s)}),...Array.isArray(o)?o:[o]])}),c=(e,t)=>{let s=(0,a.forwardRef)((s,n)=>{let{className:c,...d}=s;return(0,a.createElement)(r,{ref:n,iconNode:t,className:i("lucide-".concat(l(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),c),...d})});return s.displayName=l(e),s}},28479:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var a=s(95155),l=s(12115),i=s(26597),n=s(76118),r=s(35317),c=s(56104),d=s(47924),o=s(71007),m=s(44940),u=s(40646),x=s(54861);let h=(0,s(19946).A)("circle-arrow-out-down-right",[["path",{d:"M12 22a10 10 0 1 1 10-10",key:"130bv5"}],["path",{d:"M22 22 12 12",key:"131aw7"}],["path",{d:"M22 16v6h-6",key:"1gvm70"}]]);var p=s(81586),y=s(59836),N=s(53231),g=s(32944),j=s(72132),b=s(84423),v=s(72794),f=s(931);let w=["Al Bustan","Marina","TECOM","AL Muraqabat","IBN Batutta Mall"],k=["cash","card","bank_transfer","cobone","groupon","pay_by_link","paypal","tabby","tamara","extra_pay_mode_1","extra_pay_mode_2","user_balance","redeem"],S=["Komal","Shameem","Do Thi Kim","Alishba"],M=["today","yesterday","this_week","this_month","custom"];function C(){let[e,t]=(0,l.useState)([]),[s,C]=(0,l.useState)(!0),[A,D]=(0,l.useState)("bookings"),[P,F]=(0,l.useState)(""),[E,T]=(0,l.useState)("all"),[_,$]=(0,l.useState)(!1),[G,B]=(0,l.useState)(!1),[z,O]=(0,l.useState)(!1),[L,H]=(0,l.useState)(null),[q,U]=(0,l.useState)(w[0]),[R,I]=(0,l.useState)(()=>(0,y.GP)(new Date,"yyyy-MM-dd")),[W,Y]=(0,l.useState)("10:00"),[Z,J]=(0,l.useState)(""),[K,Q]=(0,l.useState)("cash"),[V,X]=(0,l.useState)(!1),[ee,et]=(0,l.useState)(!1),[es,ea]=(0,l.useState)(""),[el,ei]=(0,l.useState)("upcoming"),[en,er]=(0,l.useState)(""),[ec,ed]=(0,l.useState)([]),eo=ec.length?ec:S,[em,eu]=(0,l.useState)("this_month"),[ex,eh]=(0,l.useState)(()=>(0,y.GP)((0,N.w)(new Date),"yyyy-MM-dd")),[ep,ey]=(0,l.useState)(()=>(0,y.GP)((0,g.p)(new Date),"yyyy-MM-dd")),[eN,eg]=(0,l.useState)("all"),[ej,eb]=(0,l.useState)("this_month");(0,l.useEffect)(()=>{(async()=>{if(!c.db)return ed(S);try{let e=await (0,r.GG)((0,r.rJ)(c.db,"staff")),t=[];e.forEach(e=>{let s=e.data();(null==s?void 0:s.name)&&t.push(String(s.name))}),ed(t.length?t:S)}catch(e){ed(S)}})()},[]),(0,l.useEffect)(()=>{if(!c.db)return;let e=(0,r.P)((0,r.rJ)(c.db,"bookings"),(0,r.My)("createdAt","desc")),s=(0,r.aQ)(e,e=>{t(e.docs.map(e=>{var t,s,a,l;let i=e.data();return{id:e.id,userId:i.userId||"",customerName:i.customerName||"",customerEmail:i.customerEmail||"",services:i.services||[],bookingDate:(null==(t=i.bookingDate)?void 0:t.toDate())||new Date,bookingTime:i.bookingTime||"",branch:i.branch||"",staff:i.staffName||i.staff||"—",totalPrice:Number(i.totalPrice)||0,totalDuration:Number(i.totalDuration)||0,status:i.status||"upcoming",paymentMethod:i.paymentMethod||"cash",grossSales:Number(i.grossSales)||void 0,discount:Number(i.discount)||void 0,refunds:Number(i.refunds)||void 0,adjustments:Number(i.adjustments)||void 0,tax:Number(i.tax)||void 0,tips:Number(i.tips)||void 0,excludedPayments:Number(i.excludedPayments)||void 0,inHand:Number(i.inHand)||void 0,paymentDetails:i.paymentDetails||void 0,emailConfirmation:!!i.emailConfirmation,smsConfirmation:!!i.smsConfirmation,createdAt:(null==(s=i.createdAt)?void 0:s.toDate())||new Date,updatedAt:(null==(a=i.updatedAt)?void 0:a.toDate())||new Date,remarks:null!=(l=i.remarks)?l:null}})),C(!1)});return()=>s()},[]),(0,l.useEffect)(()=>{let e=new Date;switch(em){case"today":eh((0,y.GP)(e,"yyyy-MM-dd")),ey((0,y.GP)(e,"yyyy-MM-dd"));break;case"yesterday":let t=(0,j.e)(e,1);eh((0,y.GP)(t,"yyyy-MM-dd")),ey((0,y.GP)(t,"yyyy-MM-dd"));break;case"this_week":eh((0,y.GP)((0,b.k)(e,{weekStartsOn:1}),"yyyy-MM-dd")),ey((0,y.GP)((0,v.$)(e,{weekStartsOn:1}),"yyyy-MM-dd"));break;case"this_month":eh((0,y.GP)((0,N.w)(e),"yyyy-MM-dd")),ey((0,y.GP)((0,g.p)(e),"yyyy-MM-dd"))}},[em]);let ev=(0,l.useMemo)(()=>{let t=new Date(ex+"T00:00:00"),s=new Date(ep+"T23:59:59");return e.filter(e=>{let a=e.bookingDate,l="all"===eN||e.branch===eN;return a>=t&&a<=s&&l})},[e,ex,ep,eN]),ef=(0,l.useMemo)(()=>{let e={sales:0,grossSales:0,discount:0,refunds:0,adjustments:0,tax:0,totalSalesWithTax:0,tips:0,collection:0,excludedPayments:0,inHandCollection:0,paymentMethods:{}};return k.forEach(t=>e.paymentMethods[t]=0),ev.forEach(t=>{var s,a,l,i,n,r,c,d;let o=Number(null!=(s=t.grossSales)?s:t.totalPrice)||0,m=Number(null!=(a=t.discount)?a:0)||0,u=Number(null!=(l=t.refunds)?l:0)||0,x=Number(null!=(i=t.adjustments)?i:0)||0,h=Number(null!=(n=t.tax)?n:0)||0,p=Number(null!=(r=t.tips)?r:0)||0,y=Number(null!=(c=t.excludedPayments)?c:0)||0,N=o-m-u+x;e.grossSales+=o,e.discount+=m,e.refunds+=u,e.adjustments+=x,e.tax+=h,e.tips+=p,e.excludedPayments+=y,e.sales+=N,e.totalSalesWithTax+=N+h,e.collection+=N+p;let g=Number(null!=(d=t.inHand)?d:Math.max(0,N+p-y));e.inHandCollection+=g;let j=t.paymentMethod,b="string"==typeof j?j.toLowerCase():"cash";e.paymentMethods[b]||(e.paymentMethods[b]=0),t.paymentDetails&&"object"==typeof t.paymentDetails?Object.entries(t.paymentDetails).forEach(t=>{let[s,a]=t,l=String(s).toLowerCase();e.paymentMethods[l]=(e.paymentMethods[l]||0)+Number(a||0)}):e.paymentMethods[b]=(e.paymentMethods[b]||0)+Number(N+p||0)}),e},[ev]),ew=(0,l.useMemo)(()=>{let t=P.toLowerCase();return e.filter(e=>{let s=e.customerName.toLowerCase().includes(t)||e.branch.toLowerCase().includes(t)||e.services.some(e=>e.serviceName.toLowerCase().includes(t)),a="all"===E||e.status===E;return s&&a})},[e,P,E]),ek=()=>{U(w[0]),ea(""),I((0,y.GP)(new Date,"yyyy-MM-dd")),Y("10:00"),J(""),Q("cash"),X(!1),et(!1),ei("upcoming"),er(""),H(null)},eS=e=>{H(e.id),U(e.branch||w[0]),I((0,y.GP)(e.bookingDate,"yyyy-MM-dd")),Y(e.bookingTime||"10:00"),J(e.customerName||""),ea(e.customerEmail||""),Q(e.paymentMethod||"cash"),X(!!e.emailConfirmation),et(!!e.smsConfirmation),ei(e.status||"upcoming"),er(e.staff||""),$(!0)},eM=async(e,t)=>{try{if(!c.db)throw Error("Firestore not initialized");let s=(0,r.H9)(c.db,"bookings",e);await (0,r.mZ)(s,{status:t,updatedAt:(0,r.O5)()})}catch(e){console.error("Error updating booking status:",e),alert("Failed to update status.")}};return s?(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600 mx-auto"}),(0,a.jsx)("p",{className:"text-center mt-2",children:"Loading..."})]}):(0,a.jsx)(f.A,{children:(0,a.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Bookings"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"All Bookings From Booking Calender for Action (realtime from Firestore)"})]})}),"bookings"===A&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6 flex gap-4 items-center",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(d.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,a.jsx)("input",{value:P,onChange:e=>F(e.target.value),className:"pl-10 pr-3 py-2 w-full border rounded",placeholder:"Search by customer, branch, service..."})]}),(0,a.jsxs)("select",{value:E,onChange:e=>T(e.target.value),className:"border rounded px-3 py-2",children:[(0,a.jsx)("option",{value:"all",children:"All Status"}),(0,a.jsx)("option",{value:"upcoming",children:"Upcoming"}),(0,a.jsx)("option",{value:"past",children:"Past"}),(0,a.jsx)("option",{value:"cancelled",children:"Cancelled"})]}),(0,a.jsx)("button",{onClick:()=>{$(!0),ek()},className:"px-3 py-2 bg-pink-600 text-white rounded",children:"Add Booking"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Customer"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Services"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Date & Time"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Staff"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Branch"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Payment"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Actions"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Details"})]})}),(0,a.jsx)("tbody",{children:ew.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>eS(e),children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 rounded-full bg-pink-100 flex items-center justify-center",children:(0,a.jsx)(o.A,{className:"w-5 h-5 text-pink-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.customerName}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.customerEmail||"No email"})]})]})}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[e.services.slice(0,2).map((e,t)=>(0,a.jsxs)("div",{children:[e.serviceName," ",e.quantity>1&&"(x".concat(e.quantity,")")]},t)),e.services.length>2&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["+",e.services.length-2," more"]})]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("div",{children:(0,y.GP)(e.bookingDate,"MMM dd, yyyy")}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.bookingTime})]}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.staff||"—"}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.branch}),(0,a.jsxs)("td",{className:"px-4 py-3",children:["AED",e.services.reduce((e,t)=>e+Number(t.price)*Number(t.quantity)+(Number(t.tip)||0),0).toFixed(2),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.paymentDetails&&"object"==typeof e.paymentDetails?Object.entries(e.paymentDetails).map(e=>{let[t,s]=e;return"".concat(t,": AED").concat(Number(s).toFixed(2))}).join(", "):e.paymentMethod})]}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full bg-gray-100 text-xs",children:e.status})}),(0,a.jsx)("td",{className:"px-4 py-3",onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>eS(e),title:"Edit",className:"text-emerald-700",children:(0,a.jsx)(m.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>eM(e.id,"past"),title:"Mark as completed",className:"text-green-600",children:(0,a.jsx)(u.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>eM(e.id,"cancelled"),title:"Cancel",className:"text-red-600",children:(0,a.jsx)(x.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>eM(e.id,"upcoming"),title:"Upcoming",className:"text-blue-600",children:(0,a.jsx)(h,{className:"w-4 h-4"})})]})}),(0,a.jsx)("td",{className:"px-4 py-3",onClick:e=>e.stopPropagation(),children:(0,a.jsx)("button",{onClick:()=>(e=>{var t;let s=new i.Ay({unit:"pt",format:"a4",orientation:"portrait"});s.setFontSize(18),s.text("Invoice",40,40),s.setFontSize(12),s.text("Customer: ".concat(e.customerName),40,70),s.text("Email: ".concat(e.customerEmail||"N/A"),40,90),s.text("Booking Date: ".concat((0,y.GP)(e.bookingDate,"MMM dd, yyyy")),40,110),s.text("Time: ".concat(e.bookingTime),40,130),s.text("Branch: ".concat(e.branch),40,150),s.text("Staff: ".concat(e.staff||"—"),40,170);let a=e.services.map((e,t)=>[t+1,e.serviceName,e.quantity,"$".concat(Number(e.price).toFixed(2)),"number"==typeof e.tip?"$".concat(Number(e.tip).toFixed(2)):"-","$".concat((Number(e.price)*Number(e.quantity)+(Number(e.tip)||0)).toFixed(2))]);(0,n.Ay)(s,{head:[["#","Service","Qty","Unit Price","Tip","Total"]],body:a,startY:200,theme:"grid",styles:{fontSize:10},margin:{left:40,right:40}});let l=e.services.reduce((e,t)=>e+Number(t.price)*Number(t.quantity)+(Number(t.tip)||0),0),r="";e.paymentDetails&&"object"==typeof e.paymentDetails&&(r=Object.entries(e.paymentDetails).map(e=>{let[t,s]=e;return"".concat(t,": $").concat(Number(s).toFixed(2))}).join(", "));let c=(null==(t=s.lastAutoTable)?void 0:t.finalY)||200;s.setFontSize(12),s.text("Total Duration: ".concat(e.totalDuration," min"),40,c+25),s.text("Total Price: $".concat(l.toFixed(2)),40,c+45),r&&s.text("Payments: ".concat(r),40,c+65),s.save("Invoice_".concat(e.customerName.replace(/\s+/g,"_"),".pdf"))})(e),className:"px-2 py-1 bg-pink-600 text-white rounded",children:"Details"})})]},e.id))})]})}),0===ew.length&&(0,a.jsx)("div",{className:"text-center py-10 text-gray-500",children:"No bookings found."}),_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-700 bg-opacity-50 z-50 flex items-start justify-center overflow-y-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg w-11/12 md:w-3/4 mt-10",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,a.jsx)("h3",{className:"font-semibold",children:L?"Edit Booking":"Add Booking"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[L&&(0,a.jsx)("button",{onClick:async()=>{if(confirm("Delete?")){O(!0);try{if(!c.db)throw Error("Firestore not initialized");await (0,r.kd)((0,r.H9)(c.db,"bookings",L)),$(!1),ek()}catch(e){console.error(e),alert("Delete failed")}finally{O(!1)}}},className:"px-3 py-1 bg-red-600 text-white rounded",children:"Delete"}),(0,a.jsx)("button",{onClick:()=>{$(!1),ek()},className:"px-3 py-1",children:"Close"})]})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Branch"}),(0,a.jsx)("select",{value:q,onChange:e=>U(e.target.value),className:"w-full border rounded p-2",children:w.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Staff"}),(0,a.jsxs)("select",{value:en,onChange:e=>er(e.target.value),className:"w-full border rounded p-2",children:[(0,a.jsx)("option",{value:"",children:"—"}),eo.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Payment"}),(0,a.jsx)("select",{value:K,onChange:e=>Q(e.target.value),className:"w-full border rounded p-2",children:k.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Service Date"}),(0,a.jsx)("input",{type:"date",value:R,onChange:e=>I(e.target.value),className:"w-full border rounded p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Time"}),(0,a.jsx)("input",{type:"time",value:W,onChange:e=>Y(e.target.value),className:"w-full border rounded p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Customer Name"}),(0,a.jsx)("input",{value:Z,onChange:e=>J(e.target.value),className:"w-full border rounded p-2"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Customer Email"}),(0,a.jsx)("input",{type:"email",value:es,onChange:e=>ea(e.target.value),className:"w-full border rounded p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Status"}),(0,a.jsxs)("select",{value:el,onChange:e=>ei(e.target.value),className:"w-full border rounded p-2",children:[(0,a.jsx)("option",{value:"upcoming",children:"Upcoming"}),(0,a.jsx)("option",{value:"past",children:"Past"}),(0,a.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:V,onChange:e=>X(e.target.checked),className:"mr-2"}),"Email Confirmation"]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:ee,onChange:e=>et(e.target.checked),className:"mr-2"}),"SMS Confirmation"]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>{$(!1),ek()},children:"Close"}),(0,a.jsx)("button",{className:"px-3 py-2 bg-emerald-600 text-white rounded",onClick:async()=>{alert("Use back-end saving as needed")},children:"Save"})]})]})]})})]}),"finance"===A&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Timeline"}),(0,a.jsx)("select",{value:em,onChange:e=>eu(e.target.value),className:"w-full border rounded p-2",children:M.map(e=>(0,a.jsx)("option",{value:e,children:e.replace("_"," ")},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"From"}),(0,a.jsx)("input",{type:"date",value:ex,onChange:e=>eh(e.target.value),className:"w-full border rounded p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"To"}),(0,a.jsx)("input",{type:"date",value:ep,onChange:e=>ey(e.target.value),className:"w-full border rounded p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"Branch"}),(0,a.jsxs)("select",{value:eN,onChange:e=>eg(e.target.value),className:"w-full border rounded p-2",children:[(0,a.jsx)("option",{value:"all",children:"All Branches"}),w.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Net Sales"}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["$",ef.sales.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Total Collection"}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["$",ef.collection.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"In Hand Collection"}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["$",ef.inHandCollection.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Total Tips"}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["$",ef.tips.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6",children:[(0,a.jsx)("h3",{className:"font-semibold mb-4",children:"Payment Methods Breakdown"}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:Object.entries(ef.paymentMethods||{}).map(e=>{let[t,s]=e;return s>0&&(0,a.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500 capitalize",children:t.replace("_"," ")}),(0,a.jsxs)("div",{className:"font-semibold",children:["$",s.toFixed(2)]})]},t)})})]}),(0,a.jsx)("div",{className:"flex justify-end mb-4",children:(0,a.jsxs)("button",{onClick:()=>{let e=new i.Ay({unit:"pt",format:"a4",orientation:"landscape"});e.setFontSize(16),e.text("Finance Report",40,40);let t=["Branch: ".concat(eN),"From: ".concat(ex),"To: ".concat(ep)];e.setFontSize(10),e.text(t.join("   "),40,60);let s=ev.map(e=>{var t,s,a,l,i,n;let r=Number(null!=(t=e.grossSales)?t:e.totalPrice)||0,c=Number(null!=(s=e.discount)?s:0)||0,d=Number(null!=(a=e.refunds)?a:0)||0,o=Number(null!=(l=e.adjustments)?l:0)||0,m=Number(null!=(i=e.tax)?i:0)||0,u=Number(null!=(n=e.tips)?n:0)||0,x=r-c-d+o;return[e.customerName,(0,y.GP)(e.bookingDate,"yyyy-MM-dd"),e.bookingTime,e.branch,e.staff||"—","$".concat(r.toFixed(2)),"$".concat(c.toFixed(2)),"$".concat(d.toFixed(2)),"$".concat(o.toFixed(2)),"$".concat(x.toFixed(2)),"$".concat(m.toFixed(2)),"$".concat((x+m).toFixed(2)),"$".concat(u.toFixed(2)),e.paymentMethod]});(0,n.Ay)(e,{head:[["Customer","Date","Time","Branch","Staff","Gross","Discount","Refunds","Adjustments","Net Sales","Tax","Total Sales","Tips","Payment Method"]],body:s,startY:80,styles:{fontSize:9},margin:{left:20,right:20}}),e.save("Finance_Report_".concat(ex,"_to_").concat(ep,".pdf"))},className:"px-4 py-2 bg-pink-600 text-white rounded flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"w-4 h-4"}),"Export Finance PDF"]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Customer"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Date & Time"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Branch"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Staff"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Gross"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Discount"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Net Sales"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Tax"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Tips"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Payment Method"})]})}),(0,a.jsx)("tbody",{children:ev.map(e=>{var t,s,l,i,n,r,c;let d=Number(null!=(s=e.grossSales)?s:e.totalPrice)||0,o=Number(null!=(l=e.discount)?l:0)||0,m=Number(null!=(i=e.refunds)?i:0)||0,u=Number(null!=(n=e.adjustments)?n:0)||0,x=Number(null!=(r=e.tax)?r:0)||0,h=Number(null!=(c=e.tips)?c:0)||0,p=d-o-m+u;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("div",{className:"font-medium",children:e.customerName}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.customerEmail||"No email"})]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("div",{children:(0,y.GP)(e.bookingDate,"MMM dd, yyyy")}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.bookingTime})]}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.branch}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.staff||"—"}),(0,a.jsxs)("td",{className:"px-4 py-3",children:["$",d.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:["$",o.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:["$",p.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:["$",x.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:["$",h.toFixed(2)]}),(0,a.jsx)("td",{className:"px-4 py-3 capitalize",children:(null==(t=e.paymentMethod)?void 0:t.replace("_"," "))||"cash"})]},e.id)})})]})}),0===ev.length&&(0,a.jsx)("div",{className:"text-center py-10 text-gray-500",children:"No finance records found for selected period."})]})]})})}},32944:(e,t,s)=>{"use strict";s.d(t,{p:()=>l});var a=s(89447);function l(e,t){let s=(0,a.a)(e,null==t?void 0:t.in),l=s.getMonth();return s.setFullYear(s.getFullYear(),l+1,0),s.setHours(23,59,59,999),s}},40283:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,O:()=>d});var a=s(95155),l=s(12115),i=s(79323),n=s(56104);let r=(0,l.createContext)({user:null,userRole:null,loading:!0,isAdmin:!1,error:null,accessiblePages:[],canAccessPage:()=>!1}),c=()=>(0,l.useContext)(r),d=e=>{let{children:t}=e,[s,c]=(0,l.useState)(null),[d,o]=(0,l.useState)(null),[m,u]=(0,l.useState)(!0),[x,h]=(0,l.useState)(null),[p,y]=(0,l.useState)([]);(0,l.useEffect)(()=>{let e,t=!0;return(async()=>{try{u(!0),await (0,n.AU)(),e=(0,i.Bh)(async e=>{if(t){if(c(e),h(null),e)try{let s=await (0,i.uG)(e.uid);if(!s&&e.email){let t="ahmadxeikh786@gmail.com"===e.email?"admin":"user";await (0,i.yS)(e.uid,e.email,t,e.displayName||void 0,[]),s=await (0,i.uG)(e.uid)}(null==s?void 0:s.role)!=="admin"&&"ahmadxeikh786@gmail.com"===e.email&&(await (0,i.yS)(e.uid,e.email,"admin",e.displayName||void 0,[]),s=await (0,i.uG)(e.uid)),t&&(o(s),y((null==s?void 0:s.accessPages)||[]))}catch(e){console.error("Error getting user role:",e),t&&h("Failed to load user role")}else t&&(o(null),y([]));t&&u(!1)}})}catch(e){console.error("Firebase initialization error:",e),t&&(h("Failed to initialize authentication"),u(!1))}})(),()=>{t=!1,e&&e()}},[]);let N=(null==d?void 0:d.role)==="admin";return(0,a.jsx)(r.Provider,{value:{user:s,userRole:d,loading:m,isAdmin:N,error:x,accessiblePages:p,canAccessPage:e=>!!d&&("admin"===d.role||p.includes(e))},children:t})}},40646:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},44940:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},47924:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},53231:(e,t,s)=>{"use strict";s.d(t,{w:()=>l});var a=s(89447);function l(e,t){let s=(0,a.a)(e,null==t?void 0:t.in);return s.setDate(1),s.setHours(0,0,0,0),s}},54861:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},64357:(e,t,s)=>{Promise.resolve().then(s.bind(s,28479))},71007:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},72132:(e,t,s)=>{"use strict";s.d(t,{e:()=>i});var a=s(7239),l=s(89447);function i(e,t,s){var i=-t;let n=(0,l.a)(e,null==s?void 0:s.in);return isNaN(i)?(0,a.w)((null==s?void 0:s.in)||e,NaN):(i&&n.setDate(n.getDate()+i),n)}},72794:(e,t,s)=>{"use strict";s.d(t,{$:()=>i});var a=s(95490),l=s(89447);function i(e,t){var s,i,n,r,c,d,o,m;let u=(0,a.q)(),x=null!=(m=null!=(o=null!=(d=null!=(c=null==t?void 0:t.weekStartsOn)?c:null==t||null==(i=t.locale)||null==(s=i.options)?void 0:s.weekStartsOn)?d:u.weekStartsOn)?o:null==(r=u.locale)||null==(n=r.options)?void 0:n.weekStartsOn)?m:0,h=(0,l.a)(e,null==t?void 0:t.in),p=h.getDay();return h.setDate(h.getDate()+((p<x?-7:0)+6-(p-x))),h.setHours(23,59,59,999),h}},81586:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(19946).A)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])}},e=>{e.O(0,[9135,7210,3930,5033,1748,9836,6373,6118,9323,8441,5964,7358],()=>e(e.s=64357)),_N_E=e.O()}]);