(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1376],{19946:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var s=a(12115);let l=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},r=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,s.forwardRef)((e,t)=>{let{color:a="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:o="",children:d,iconNode:u,...m}=e;return(0,s.createElement)("svg",{ref:t,...n,width:l,height:l,stroke:a,strokeWidth:c?24*Number(i)/Number(l):i,className:r("lucide",o),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[t,a]=e;return(0,s.createElement)(t,a)}),...Array.isArray(d)?d:[d]])}),c=(e,t)=>{let a=(0,s.forwardRef)((a,n)=>{let{className:c,...o}=a;return(0,s.createElement)(i,{ref:n,iconNode:t,className:r("lucide-".concat(l(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),c),...o})});return a.displayName=l(e),a}},28479:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var s=a(95155),l=a(12115),r=a(26597),n=a(76118),i=a(35317),c=a(56104),o=a(47924),d=a(71007),u=a(40646),m=a(54861);let x=(0,a(19946).A)("circle-arrow-out-down-right",[["path",{d:"M12 22a10 10 0 1 1 10-10",key:"130bv5"}],["path",{d:"M22 22 12 12",key:"131aw7"}],["path",{d:"M22 16v6h-6",key:"1gvm70"}]]);var h=a(59836),p=a(53231),y=a(32944),b=a(72132),g=a(84423),N=a(72794),v=a(931);let f=["Al Bustan","Marina","TECOM","AL Muraqabat","IBN Batutta Mall"],j=["cash","card","bank_transfer","cobone","groupon","pay_by_link","paypal","tabby","tamara","extra_pay_mode_1","extra_pay_mode_2","user_balance","redeem"],k=["Komal","Shameem","Do Thi Kim","Alishba"];function w(){let[e,t]=(0,l.useState)([]),[a,w]=(0,l.useState)(!0),[M,S]=(0,l.useState)("bookings"),[C,D]=(0,l.useState)(""),[A,P]=(0,l.useState)("all"),[E,_]=(0,l.useState)(!1),[T,G]=(0,l.useState)(!1),[F,L]=(0,l.useState)(!1),[B,O]=(0,l.useState)(null),[H,z]=(0,l.useState)(f[0]),[q,U]=(0,l.useState)(()=>(0,h.GP)(new Date,"yyyy-MM-dd")),[$,I]=(0,l.useState)("10:00"),[W,Y]=(0,l.useState)(""),[Z,J]=(0,l.useState)("cash"),[K,Q]=(0,l.useState)(!1),[R,V]=(0,l.useState)(!1),[X,ee]=(0,l.useState)(""),[et,ea]=(0,l.useState)("upcoming"),[es,el]=(0,l.useState)([]);es.length;let[er,en]=(0,l.useState)("this_month"),[ei,ec]=(0,l.useState)(()=>(0,h.GP)((0,p.w)(new Date),"yyyy-MM-dd")),[eo,ed]=(0,l.useState)(()=>(0,h.GP)((0,y.p)(new Date),"yyyy-MM-dd")),[eu,em]=(0,l.useState)("all"),[ex,eh]=(0,l.useState)("this_month");(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,i.GG)((0,i.rJ)(c.db,"staff")),t=[];e.forEach(e=>{let a=e.data();(null==a?void 0:a.name)&&t.push(String(a.name))}),el(t.length?t:k)}catch(e){el(k)}})()},[]),(0,l.useEffect)(()=>{let e=(0,i.P)((0,i.rJ)(c.db,"bookings"),(0,i.My)("createdAt","desc")),a=(0,i.aQ)(e,e=>{t(e.docs.map(e=>{var t,a,s,l;let r=e.data();return{id:e.id,userId:r.userId||"",customerName:r.customerName||"",customerEmail:r.customerEmail||"",services:r.services||[],bookingDate:(null==(t=r.bookingDate)?void 0:t.toDate())||new Date,bookingTime:r.bookingTime||"",branch:r.branch||"",staff:r.staffName||r.staff||"â€”",totalPrice:Number(r.totalPrice)||0,totalDuration:Number(r.totalDuration)||0,status:r.status||"upcoming",paymentMethod:r.paymentMethod||"cash",grossSales:Number(r.grossSales)||void 0,discount:Number(r.discount)||void 0,refunds:Number(r.refunds)||void 0,adjustments:Number(r.adjustments)||void 0,tax:Number(r.tax)||void 0,tips:Number(r.tips)||void 0,excludedPayments:Number(r.excludedPayments)||void 0,inHand:Number(r.inHand)||void 0,paymentDetails:r.paymentDetails||void 0,emailConfirmation:!!r.emailConfirmation,smsConfirmation:!!r.smsConfirmation,createdAt:(null==(a=r.createdAt)?void 0:a.toDate())||new Date,updatedAt:(null==(s=r.updatedAt)?void 0:s.toDate())||new Date,remarks:null!=(l=r.remarks)?l:null}})),w(!1)});return()=>a()},[]),(0,l.useEffect)(()=>{let e=new Date;switch(er){case"today":ec((0,h.GP)(e,"yyyy-MM-dd")),ed((0,h.GP)(e,"yyyy-MM-dd"));break;case"yesterday":let t=(0,b.e)(e,1);ec((0,h.GP)(t,"yyyy-MM-dd")),ed((0,h.GP)(t,"yyyy-MM-dd"));break;case"this_week":ec((0,h.GP)((0,g.k)(e,{weekStartsOn:1}),"yyyy-MM-dd")),ed((0,h.GP)((0,N.$)(e,{weekStartsOn:1}),"yyyy-MM-dd"));break;case"this_month":ec((0,h.GP)((0,p.w)(e),"yyyy-MM-dd")),ed((0,h.GP)((0,y.p)(e),"yyyy-MM-dd"))}},[er]);let ep=(0,l.useMemo)(()=>{let t=new Date(ei+"T00:00:00"),a=new Date(eo+"T23:59:59");return e.filter(e=>{let s=e.bookingDate,l="all"===eu||e.branch===eu;return s>=t&&s<=a&&l})},[e,ei,eo,eu]);(0,l.useMemo)(()=>{let e={sales:0,grossSales:0,discount:0,refunds:0,adjustments:0,tax:0,totalSalesWithTax:0,tips:0,collection:0,excludedPayments:0,inHandCollection:0,paymentMethods:{}};return j.forEach(t=>e.paymentMethods[t]=0),ep.forEach(t=>{var a,s,l,r,n,i,c,o;let d=Number(null!=(a=t.grossSales)?a:t.totalPrice)||0,u=Number(null!=(s=t.discount)?s:0)||0,m=Number(null!=(l=t.refunds)?l:0)||0,x=Number(null!=(r=t.adjustments)?r:0)||0,h=Number(null!=(n=t.tax)?n:0)||0,p=Number(null!=(i=t.tips)?i:0)||0,y=Number(null!=(c=t.excludedPayments)?c:0)||0,b=d-u-m+x;e.grossSales+=d,e.discount+=u,e.refunds+=m,e.adjustments+=x,e.tax+=h,e.tips+=p,e.excludedPayments+=y,e.sales+=b,e.totalSalesWithTax+=b+h,e.collection+=b+p;let g=Number(null!=(o=t.inHand)?o:Math.max(0,b+p-y));e.inHandCollection+=g;let N=(t.paymentMethod||"cash").toLowerCase();e.paymentMethods[N]||(e.paymentMethods[N]=0),t.paymentDetails&&"object"==typeof t.paymentDetails?Object.entries(t.paymentDetails).forEach(t=>{let[a,s]=t,l=a.toLowerCase();e.paymentMethods[l]=(e.paymentMethods[l]||0)+Number(s||0)}):e.paymentMethods[N]=(e.paymentMethods[N]||0)+Number(b+p||0)}),e},[ep]);let ey=(0,l.useMemo)(()=>{let t=C.toLowerCase();return e.filter(e=>{let a=e.customerName.toLowerCase().includes(t)||e.branch.toLowerCase().includes(t)||e.services.some(e=>e.serviceName.toLowerCase().includes(t)),s="all"===A||e.status===A;return a&&s})},[e,C,A]),eb=()=>{z(f[0]),ee(""),U((0,h.GP)(new Date,"yyyy-MM-dd")),I("10:00"),Y(""),J("cash"),Q(!1),V(!1),ea("upcoming"),setStaff(""),O(null)},eg=async(e,t)=>{try{let a=(0,i.H9)(c.db,"bookings",e);await (0,i.mZ)(a,{status:t,updatedAt:(0,i.O5)()})}catch(e){console.error("Error updating booking status:",e),alert("Failed to update status.")}};return a?(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600 mx-auto"}),(0,s.jsx)("p",{className:"text-center mt-2",children:"Loading..."})]}):(0,s.jsx)(v.A,{children:(0,s.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Bookings & Finance"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Merged bookings UI + Finance reports (realtime from Firestore)"})]}),(0,s.jsx)("div",{className:"flex space-x-2",children:(0,s.jsx)("button",{onClick:()=>S("bookings"),className:"px-3 py-2 rounded ".concat("bookings"===M?"bg-pink-600 text-white":"bg-gray-100"),children:"Bookings"})})]}),"bookings"===M&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6 flex gap-4 items-center",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(o.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,s.jsx)("input",{value:C,onChange:e=>D(e.target.value),className:"pl-10 pr-3 py-2 w-full border rounded",placeholder:"Search by customer, branch, service..."})]}),(0,s.jsxs)("select",{value:A,onChange:e=>P(e.target.value),className:"border rounded px-3 py-2",children:[(0,s.jsx)("option",{value:"all",children:"All Status"}),(0,s.jsx)("option",{value:"upcoming",children:"Upcoming"}),(0,s.jsx)("option",{value:"past",children:"Past"}),(0,s.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Customer"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Services"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Date & Time"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Staff"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Branch"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Payment"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Actions"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Details"})]})}),(0,s.jsx)("tbody",{children:ey.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{O(e.id),z(e.branch||f[0]),U((0,h.GP)(e.bookingDate,"yyyy-MM-dd")),I(e.bookingTime||"10:00"),Y(e.customerName||""),ee(e.customerEmail||""),J(e.paymentMethod||"cash"),Q(!!e.emailConfirmation),V(!!e.smsConfirmation),ea(e.status||"upcoming"),setStaff(e.staff||""),_(!0)},children:[(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-full bg-pink-100 flex items-center justify-center",children:(0,s.jsx)(d.A,{className:"w-5 h-5 text-pink-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.customerName}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.customerEmail||"No email"})]})]})}),(0,s.jsxs)("td",{className:"px-4 py-3",children:[e.services.slice(0,2).map((e,t)=>(0,s.jsxs)("div",{children:[e.serviceName," ",e.quantity>1&&"(x".concat(e.quantity,")")]},t)),e.services.length>2&&(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["+",e.services.length-2," more"]})]}),(0,s.jsxs)("td",{className:"px-4 py-3",children:[(0,s.jsx)("div",{children:(0,h.GP)(e.bookingDate,"MMM dd, yyyy")}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.bookingTime})]}),(0,s.jsx)("td",{className:"px-4 py-3",children:e.staff||"â€”"}),(0,s.jsx)("td",{className:"px-4 py-3",children:e.branch}),(0,s.jsxs)("td",{className:"px-4 py-3",children:["AED",e.totalPrice.toFixed(2)," ",(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.paymentMethod})]}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full bg-gray-100 text-xs",children:e.status})}),(0,s.jsx)("td",{className:"px-4 py-3",onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>eg(e.id,"past"),title:"Mark as completed",className:"text-green-600",children:(0,s.jsx)(u.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>eg(e.id,"cancelled"),title:"Cancel",className:"text-red-600",children:(0,s.jsx)(m.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>eg(e.id,"upcoming"),title:"Upcoming",className:"text-blue-600",children:(0,s.jsx)(x,{className:"w-4 h-4"})})]})}),(0,s.jsx)("td",{className:"px-4 py-3",onClick:e=>e.stopPropagation(),children:(0,s.jsx)("button",{onClick:()=>(e=>{var t;let a=new r.Ay({unit:"pt",format:"a4",orientation:"portrait"});a.setFontSize(18),a.text("Invoice",40,40),a.setFontSize(12),a.text("Customer: ".concat(e.customerName),40,70),a.text("Email: ".concat(e.customerEmail||"N/A"),40,90),a.text("Booking Date: ".concat((0,h.GP)(e.bookingDate,"MMM dd, yyyy")),40,110),a.text("Time: ".concat(e.bookingTime),40,130),a.text("Branch: ".concat(e.branch),40,150),a.text("Staff: ".concat(e.staff||"â€”"),40,170);let s=e.services.map((e,t)=>[t+1,e.serviceName,e.quantity,"$".concat(Number(e.price).toFixed(2)),"$".concat((Number(e.price)*Number(e.quantity)).toFixed(2))]);(0,n.Ay)(a,{head:[["#","Service","Qty","Unit Price","Total"]],body:s,startY:200,theme:"grid",styles:{fontSize:10},margin:{left:40,right:40}});let l=(null==(t=a.lastAutoTable)?void 0:t.finalY)||200;a.setFontSize(12),a.text("Total Duration: ".concat(e.totalDuration," min"),40,l+25),a.text("Total Price: $".concat(e.totalPrice.toFixed(2)),40,l+45),a.save("Invoice_".concat(e.customerName.replace(/\s+/g,"_"),".pdf"))})(e),className:"px-2 py-1 bg-pink-600 text-white rounded",children:"Details"})})]},e.id))})]})}),0===ey.length&&(0,s.jsx)("div",{className:"text-center py-10 text-gray-500",children:"No bookings found."}),E&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-700 bg-opacity-50 z-50 flex items-start justify-center overflow-y-auto",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-11/12 md:w-3/4 mt-10",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,s.jsx)("h3",{className:"font-semibold",children:B?"Edit Booking":"Add Booking"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[B&&(0,s.jsx)("button",{onClick:async()=>{if(confirm("Delete?")){L(!0);try{await (0,i.kd)((0,i.H9)(c.db,"bookings",B)),_(!1),eb()}catch(e){console.error(e),alert("Delete failed")}finally{L(!1)}}},className:"px-3 py-1 bg-red-600 text-white rounded",children:"Delete"}),(0,s.jsx)("button",{onClick:()=>{_(!1),eb()},className:"px-3 py-1",children:"Close"})]})]}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Branch"}),(0,s.jsx)("select",{value:H,onChange:e=>z(e.target.value),className:"w-full border rounded p-2",children:f.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Staff"}),(0,s.jsx)("select",{value:"",onChange:()=>{},className:"w-full border rounded p-2",children:(0,s.jsx)("option",{children:"â€”"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Payment"}),(0,s.jsx)("select",{value:Z,onChange:e=>J(e.target.value),className:"w-full border rounded p-2",children:["cash","card"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Service Date"}),(0,s.jsx)("input",{type:"date",value:q,onChange:e=>U(e.target.value),className:"w-full border rounded p-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Time"}),(0,s.jsx)("input",{type:"time",value:$,onChange:e=>I(e.target.value),className:"w-full border rounded p-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"Customer Name"}),(0,s.jsx)("input",{value:W,onChange:e=>Y(e.target.value),className:"w-full border rounded p-2"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>{_(!1),eb()},children:"Close"}),(0,s.jsx)("button",{className:"px-3 py-2 bg-emerald-600 text-white rounded",onClick:async()=>{alert("Use back-end saving as needed")},children:"Save"})]})]})]})})]})]})})}},32325:(e,t,a)=>{Promise.resolve().then(a.bind(a,28479))},32944:(e,t,a)=>{"use strict";a.d(t,{p:()=>l});var s=a(89447);function l(e,t){let a=(0,s.a)(e,null==t?void 0:t.in),l=a.getMonth();return a.setFullYear(a.getFullYear(),l+1,0),a.setHours(23,59,59,999),a}},40646:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},47924:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},53231:(e,t,a)=>{"use strict";a.d(t,{w:()=>l});var s=a(89447);function l(e,t){let a=(0,s.a)(e,null==t?void 0:t.in);return a.setDate(1),a.setHours(0,0,0,0),a}},54861:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},71007:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},72132:(e,t,a)=>{"use strict";a.d(t,{e:()=>r});var s=a(7239),l=a(89447);function r(e,t,a){var r=-t;let n=(0,l.a)(e,null==a?void 0:a.in);return isNaN(r)?(0,s.w)((null==a?void 0:a.in)||e,NaN):(r&&n.setDate(n.getDate()+r),n)}},72794:(e,t,a)=>{"use strict";a.d(t,{$:()=>r});var s=a(95490),l=a(89447);function r(e,t){var a,r,n,i,c,o,d,u;let m=(0,s.q)(),x=null!=(u=null!=(d=null!=(o=null!=(c=null==t?void 0:t.weekStartsOn)?c:null==t||null==(r=t.locale)||null==(a=r.options)?void 0:a.weekStartsOn)?o:m.weekStartsOn)?d:null==(i=m.locale)||null==(n=i.options)?void 0:n.weekStartsOn)?u:0,h=(0,l.a)(e,null==t?void 0:t.in),p=h.getDay();return h.setDate(h.getDate()+((p<x?-7:0)+6-(p-x))),h.setHours(23,59,59,999),h}}},e=>{e.O(0,[9135,7210,3930,5033,1748,9836,6373,6118,9323,931,8441,5964,7358],()=>e(e.s=32325)),_N_E=e.O()}]);