(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5009],{931:(e,a,r)=>{"use strict";r.d(a,{A:()=>n});var s=r(95155),t=r(12115),i=r(40283),l=r(35695);function n(e){let{children:a}=e,{userRole:r,loading:n}=(0,i.A)(),o=(0,l.usePathname)(),d=(0,l.useRouter)(),[c,m]=(0,t.useState)(!1);return((0,t.useEffect)(()=>{if(!n&&r){let e=o.split("/")[1]||"dashboard",a=r.accessPages||[];"admin"===r.role||a.includes(e)?m(!0):(m(!1),d.replace("/access-denied"))}},[n,r,o,d]),n||!r)?(0,s.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600"}),(0,s.jsx)("span",{className:"ml-3 text-pink-600",children:"Checking access..."})]}):c?(0,s.jsx)(s.Fragment,{children:a}):null}},36429:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>P});var s=r(95155),t=r(12115),i=r(38274),l=r(60760),n=r(931),o=r(40283),d=r(35317),c=r(56104);let m=async(e,a)=>{try{if(!(0,c.Gg)()||!c.db)return{error:"Firebase is not configured. Please set up your Firebase environment variables."};return await (0,d.mZ)((0,d.H9)(c.db,"users",e),{role:a,updatedAt:new Date}),{error:null}}catch(e){return{error:e instanceof Error?e.message:"Unknown error"}}},u=async(e,a)=>{try{if(!(0,c.Gg)()||!c.db)return{error:"Firebase is not configured. Please set up your Firebase environment variables."};return await (0,d.mZ)((0,d.H9)(c.db,"users",e),{...a,updatedAt:new Date}),{error:null}}catch(e){return{error:e instanceof Error?e.message:"Unknown error"}}},p=async e=>{try{if(!(0,c.Gg)()||!c.db)return{error:"Firebase is not configured. Please set up your Firebase environment variables."};return await (0,d.kd)((0,d.H9)(c.db,"users",e)),{error:null}}catch(e){return{error:e instanceof Error?e.message:"Unknown error"}}};var x=r(79323),h=r(17580),b=r(84616),g=r(17951),y=r(71007),f=r(55670),v=r(89917),w=r(62525),j=r(78749),N=r(92657),k=r(4229);function P(){let{user:e,userRole:a,loading:r}=(0,o.A)(),[P,A]=(0,t.useState)([]),[C,U]=(0,t.useState)(!0),[S,E]=(0,t.useState)(!1),[F,H]=(0,t.useState)(!1),[D,T]=(0,t.useState)(!1),[M,G]=(0,t.useState)(!1),[R,_]=(0,t.useState)(""),[O,q]=(0,t.useState)(""),[z,B]=(0,t.useState)(!1),[Z,J]=(0,t.useState)({uid:"",email:"",password:"",displayName:"",role:"user",accessPages:[]});(0,t.useEffect)(()=>E(!0),[]),(0,t.useEffect)(()=>{let e=((e,a)=>{if(!(0,c.Gg)()||!c.db)return console.warn("Firebase is not configured, skipping users subscription"),()=>{};let r=(0,d.rJ)(c.db,"users"),s=(0,d.P)(r,(0,d.My)("createdAt","desc"));return(0,d.aQ)(s,a=>{e(a.docs.map(e=>{var a,r;return{...e.data(),createdAt:(null==(a=e.data().createdAt)?void 0:a.toDate())||new Date,updatedAt:(null==(r=e.data().updatedAt)?void 0:r.toDate())||new Date}}))},e=>{console.error("Error in users subscription:",e)})})(e=>{A(e),U(!1)});return()=>e()},[]);let L=async(e,a)=>{let{error:r}=await m(e,a);r&&alert("Error updating user role: "+r)},Q=async(e,a)=>{if(confirm("Delete user ".concat(a,"? This action cannot be undone."))){let{error:a}=await p(e);a&&alert("Error deleting user: "+a)}},I=async e=>{if(e.preventDefault(),T(!0),_(""),q(""),!Z.email||!Z.password){_("Email and password are required"),T(!1);return}if(Z.password.length<6){_("Password must be at least 6 characters"),T(!1);return}let a="admin"===Z.role?["dashboard","catagories","services","offers","bookings","chat","branches","staff","customers","users","profile","sales","reports","membership","ecommerce","membershipReport"]:Z.accessPages,{success:r,error:s}=await (0,x.yN)(Z.email,Z.password,Z.displayName,Z.role,a);r?(q("User created successfully!"),V(),setTimeout(()=>{H(!1),q("")},2e3)):_(s||"Failed to create user"),T(!1)},K=async e=>{e.preventDefault(),T(!0),_(""),q("");try{let{error:e}=await u(Z.uid,{email:Z.email,displayName:Z.displayName,role:Z.role,accessPages:Z.accessPages});if(e)throw Error(e);q("User updated successfully!"),setTimeout(()=>{H(!1),q("")},2e3)}catch(e){_(e.message||"Failed to update user")}finally{T(!1)}},V=()=>{J({uid:"",email:"",password:"",displayName:"",role:"user",accessPages:[]}),_(""),q(""),G(!1),B(!1),H(!1)};return C||!S||r?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50",children:(0,s.jsx)("div",{className:"p-2 sm:p-3",children:(0,s.jsx)("div",{className:"max-w-6xl mx-auto flex items-center justify-center py-12",children:(0,s.jsxs)(i.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},className:"flex items-center space-x-3",children:[(0,s.jsx)(i.P.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"rounded-full h-8 w-8 border-4 border-pink-200 border-t-pink-600"}),(0,s.jsx)("span",{className:"text-pink-600 font-medium",children:"Loading users..."})]})})})}):(0,s.jsx)(n.A,{children:(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50",children:(0,s.jsx)("div",{className:"p-2 sm:p-3",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,s.jsxs)(i.P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-6 sm:mb-8 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(i.P.h1,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.1},className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-pink-600 via-purple-600 to-blue-600 bg-clip-text text-transparent mb-2 flex items-center gap-3",children:[(0,s.jsx)(i.P.div,{whileHover:{rotate:360},transition:{duration:.5},className:"p-2 bg-gradient-to-br from-pink-500 to-purple-500 rounded-xl shadow-lg",children:(0,s.jsx)(h.A,{className:"w-6 h-6 text-white"})}),"User Management"]}),(0,s.jsx)(i.P.p,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.2},className:"text-sm sm:text-base text-gray-600",children:"Manage user accounts and permissions"})]}),(0,s.jsxs)(i.P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.3},className:"flex items-center space-x-3",children:[(0,s.jsx)(i.P.div,{whileHover:{scale:1.05},className:"bg-white/80 backdrop-blur-sm px-4 py-2 rounded-xl border border-pink-200/50 shadow-sm",children:(0,s.jsxs)("span",{className:"text-sm font-semibold bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent",children:[P.length," ",1===P.length?"User":"Users"]})}),(0,s.jsxs)(i.P.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>{V(),B(!1),H(!0)},className:"bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white px-4 py-2 rounded-xl text-sm font-medium transition-all shadow-lg hover:shadow-xl flex items-center space-x-2",children:[(0,s.jsx)(b.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Add User"})]})]})]}),(0,s.jsx)(i.P.div,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,staggerChildren:.1},children:(0,s.jsx)(l.N,{children:P.map((e,a)=>{var r;return(0,s.jsxs)(i.P.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-20},transition:{duration:.3,delay:.05*a},whileHover:{y:-5,scale:1.02},className:"bg-white/90 backdrop-blur-xl border border-pink-200/30 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 group",children:[(0,s.jsxs)("div",{className:"p-3 sm:p-4 border-b border-pink-100/50 flex justify-between items-center bg-gradient-to-r from-pink-50/50 to-purple-50/50 rounded-t-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(i.P.div,{whileHover:{rotate:360},transition:{duration:.5},className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center shadow-lg ".concat("admin"===e.role?"bg-gradient-to-br from-yellow-400 to-orange-500":"bg-gradient-to-br from-blue-400 to-purple-500"),children:"admin"===e.role?(0,s.jsx)(g.A,{className:"w-5 h-5 text-white"}):(0,s.jsx)(y.A,{className:"w-5 h-5 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:e.displayName||(null==(r=e.email)?void 0:r.split("@")[0])}),(0,s.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.email})]})]}),(0,s.jsx)(i.P.div,{initial:{scale:0},animate:{scale:1},className:"px-3 py-1.5 rounded-full text-xs font-medium shadow-sm border ".concat("admin"===e.role?"bg-gradient-to-r from-yellow-100 to-orange-100 text-yellow-700 border-yellow-200":"bg-gradient-to-r from-blue-100 to-purple-100 text-blue-700 border-blue-200"),children:"admin"===e.role?"Admin":"User"})]}),(0,s.jsxs)("div",{className:"p-3 sm:p-4 border-t border-pink-100/50 flex justify-between items-center bg-gradient-to-r from-gray-50/50 to-pink-50/50 rounded-b-2xl",children:[(0,s.jsx)("div",{className:"flex items-center space-x-1",children:(0,s.jsx)(i.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>L(e.uid,"admin"===e.role?"user":"admin"),className:"px-3 py-2 rounded-lg text-xs font-medium transition-all shadow-sm border ".concat("admin"===e.role?"bg-gradient-to-r from-blue-500/10 to-purple-500/10 text-blue-600 border-blue-200 hover:from-blue-500/20 hover:to-purple-500/20":"bg-gradient-to-r from-yellow-500/10 to-orange-500/10 text-yellow-600 border-yellow-200 hover:from-yellow-500/20 hover:to-orange-500/20"),title:"admin"===e.role?"Make User":"Make Admin",children:"admin"===e.role?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.A,{className:"w-3 h-3 inline mr-1"}),"Make User"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.A,{className:"w-3 h-3 inline mr-1"}),"Make Admin"]})})}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(i.P.button,{whileHover:{scale:1.1,rotate:5},whileTap:{scale:.9},onClick:()=>{J({uid:e.uid,email:e.email,password:"",displayName:e.displayName||"",role:e.role,accessPages:e.accessPages||[]}),B(!0),H(!0)},className:"p-2 rounded-lg text-blue-600 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all shadow-sm border border-blue-200/50 hover:border-blue-300",title:"Edit User",children:(0,s.jsx)(v.A,{className:"w-3 h-3"})}),(0,s.jsx)(i.P.button,{whileHover:{scale:1.1,rotate:-5},whileTap:{scale:.9},onClick:()=>Q(e.uid,e.email),className:"p-2 rounded-lg text-red-600 hover:bg-gradient-to-r hover:from-red-50 hover:to-pink-50 transition-all shadow-sm border border-red-200/50 hover:border-red-300",title:"Delete User",children:(0,s.jsx)(w.A,{className:"w-3 h-3"})})]})]})]},e.uid)})})}),(0,s.jsx)(l.N,{children:F&&(0,s.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center p-2 sm:p-4 z-50",onClick:e=>e.target===e.currentTarget&&V(),children:(0,s.jsx)(i.P.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"bg-white/95 backdrop-blur-xl border border-pink-200/30 rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)(i.P.h3,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"text-lg font-bold bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent mb-4 flex items-center gap-2",children:z?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.A,{className:"w-4 h-4 text-pink-600"})," Edit User"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.A,{className:"w-4 h-4 text-pink-600"})," Add New User"]})}),(0,s.jsxs)(l.N,{children:[R&&(0,s.jsx)(i.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 p-3 bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-xl text-red-600 text-sm shadow-sm",children:R}),O&&(0,s.jsx)(i.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 p-3 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl text-green-600 text-sm shadow-sm",children:O})]}),(0,s.jsxs)("form",{onSubmit:z?K:I,className:"space-y-4",children:[(0,s.jsxs)(i.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Email Address ",z?"":"*"]}),(0,s.jsx)("input",{type:"email",value:Z.email,onChange:e=>J({...Z,email:e.target.value}),className:"w-full px-4 py-3 border border-pink-200/50 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-pink-400 bg-white/80 backdrop-blur-sm transition-all",placeholder:"user@example.com",required:!z,disabled:D||z})]}),!z&&(0,s.jsxs)(i.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:M?"text":"password",value:Z.password,onChange:e=>J({...Z,password:e.target.value}),className:"w-full px-4 py-3 pr-12 border border-pink-200/50 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-pink-400 bg-white/80 backdrop-blur-sm transition-all",placeholder:"Minimum 6 characters",required:!0,disabled:D}),(0,s.jsx)(i.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},type:"button",onClick:()=>G(!M),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1 rounded-lg hover:bg-gray-100",children:M?(0,s.jsx)(j.A,{className:"w-4 h-4"}):(0,s.jsx)(N.A,{className:"w-4 h-4"})})]})]}),(0,s.jsxs)(i.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name"}),(0,s.jsx)("input",{type:"text",value:Z.displayName,onChange:e=>J({...Z,displayName:e.target.value}),className:"w-full px-4 py-3 border border-pink-200/50 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-pink-400 bg-white/80 backdrop-blur-sm transition-all",placeholder:"Full name (optional)",disabled:D})]}),(0,s.jsxs)(i.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),(0,s.jsxs)("select",{value:Z.role,onChange:e=>J({...Z,role:e.target.value}),className:"w-full px-4 py-3 border border-pink-200/50 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-pink-400 bg-white/80 backdrop-blur-sm cursor-pointer transition-all",disabled:D,children:[(0,s.jsx)("option",{value:"user",children:"User"}),(0,s.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,s.jsxs)(i.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.5},children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"User Access for Pages"}),(0,s.jsxs)("select",{multiple:!0,value:Z.accessPages,onChange:e=>J({...Z,accessPages:Array.from(e.target.selectedOptions,e=>e.value)}),className:"w-full px-4 py-3 border border-pink-200/50 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-pink-400 bg-white/80 backdrop-blur-sm cursor-pointer transition-all min-h-[120px]",disabled:D,children:[(0,s.jsx)("option",{value:"dashboard",children:"Dashboard"}),(0,s.jsx)("option",{value:"catagories",children:"Catagories"}),(0,s.jsx)("option",{value:"services",children:"Services"}),(0,s.jsx)("option",{value:"offers",children:"Offers"}),(0,s.jsx)("option",{value:"bookings",children:"Bookings"}),(0,s.jsx)("option",{value:"chat",children:"Chat"}),(0,s.jsx)("option",{value:"branches",children:"Branches"}),(0,s.jsx)("option",{value:"staff",children:"Staff"}),(0,s.jsx)("option",{value:"customers",children:"Customers"}),(0,s.jsx)("option",{value:"users",children:"Users"}),(0,s.jsx)("option",{value:"sales",children:"sales"}),(0,s.jsx)("option",{value:"reports",children:"reports"}),(0,s.jsx)("option",{value:"profile",children:"Profile"}),(0,s.jsx)("option",{value:"membership",children:"Membership"}),(0,s.jsx)("option",{value:"membershipReport",children:"Membership Report"}),(0,s.jsx)("option",{value:"ecommerce",children:"Ecommerce Page"})]})]}),(0,s.jsxs)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex justify-end space-x-3 pt-4 border-t border-gradient-to-r from-pink-100 to-purple-100",children:[(0,s.jsx)(i.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",onClick:V,disabled:D,className:"px-4 py-2 text-pink-600 bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl text-sm font-medium hover:from-pink-100 hover:to-purple-100 transition-all shadow-sm border border-pink-200/50",children:"Cancel"}),(0,s.jsxs)(i.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:D,className:"px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white rounded-xl text-sm font-medium transition-all flex items-center space-x-2 shadow-lg hover:shadow-xl disabled:opacity-50",children:[D&&(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white/30 border-t-white"}),(0,s.jsx)(k.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:D?z?"Updating...":"Creating...":z?"Update User":"Create User"})]})]})]})]})})})})]})})})})}},40283:(e,a,r)=>{"use strict";r.d(a,{A:()=>o,O:()=>d});var s=r(95155),t=r(12115),i=r(79323),l=r(56104);let n=(0,t.createContext)({user:null,userRole:null,loading:!0,isAdmin:!1,error:null,accessiblePages:[],canAccessPage:()=>!1}),o=()=>(0,t.useContext)(n),d=e=>{let{children:a}=e,[r,o]=(0,t.useState)(null),[d,c]=(0,t.useState)(null),[m,u]=(0,t.useState)(!0),[p,x]=(0,t.useState)(null),[h,b]=(0,t.useState)([]);(0,t.useEffect)(()=>{let e,a=!0;return(async()=>{try{u(!0),await (0,l.AU)(),e=(0,i.Bh)(async e=>{if(a){if(o(e),x(null),e)try{let r=await (0,i.uG)(e.uid);if(!r&&e.email){let a="ahmadxeikh786@gmail.com"===e.email?"admin":"user";await (0,i.yS)(e.uid,e.email,a,e.displayName||void 0,[]),r=await (0,i.uG)(e.uid)}(null==r?void 0:r.role)!=="admin"&&"ahmadxeikh786@gmail.com"===e.email&&(await (0,i.yS)(e.uid,e.email,"admin",e.displayName||void 0,[]),r=await (0,i.uG)(e.uid)),a&&(c(r),b((null==r?void 0:r.accessPages)||[]))}catch(e){console.error("Error getting user role:",e),a&&x("Failed to load user role")}else a&&(c(null),b([]));a&&u(!1)}})}catch(e){console.error("Firebase initialization error:",e),a&&(x("Failed to initialize authentication"),u(!1))}})(),()=>{a=!1,e&&e()}},[]);let g=(null==d?void 0:d.role)==="admin";return(0,s.jsx)(n.Provider,{value:{user:r,userRole:d,loading:m,isAdmin:g,error:p,accessiblePages:h,canAccessPage:e=>!!d&&("admin"===d.role||h.includes(e))},children:a})}},89454:(e,a,r)=>{Promise.resolve().then(r.bind(r,36429))}},e=>{e.O(0,[9135,7210,1748,6061,639,9323,8441,5964,7358],()=>e(e.s=89454)),_N_E=e.O()}]);