(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8407],{931:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(95155),r=a(12115),l=a(40283),i=a(35695);function n(e){let{children:t}=e,{userRole:a,loading:n}=(0,l.A)(),o=(0,i.usePathname)(),c=(0,i.useRouter)(),[d,m]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{if(!n&&a){let e=o.split("/")[1]||"dashboard",t=a.accessPages||[];"admin"===a.role||t.includes(e)?m(!0):(m(!1),c.replace("/access-denied"))}},[n,a,o,c]),n||!a)?(0,s.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600"}),(0,s.jsx)("span",{className:"ml-3 text-pink-600",children:"Checking access..."})]}):d?(0,s.jsx)(s.Fragment,{children:t}):null}},40283:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,O:()=>c});var s=a(95155),r=a(12115),l=a(79323),i=a(56104);let n=(0,r.createContext)({user:null,userRole:null,loading:!0,isAdmin:!1,error:null,accessiblePages:[],canAccessPage:()=>!1}),o=()=>(0,r.useContext)(n),c=e=>{let{children:t}=e,[a,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[m,u]=(0,r.useState)(!0),[x,h]=(0,r.useState)(null),[g,b]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e,t=!0;return(async()=>{try{u(!0),await (0,i.AU)(),e=(0,l.Bh)(async e=>{if(t){if(o(e),h(null),e)try{let a=await (0,l.uG)(e.uid);if(!a&&e.email){let t="ahmadxeikh786@gmail.com"===e.email?"admin":"user";await (0,l.yS)(e.uid,e.email,t,e.displayName||void 0,[]),a=await (0,l.uG)(e.uid)}(null==a?void 0:a.role)!=="admin"&&"ahmadxeikh786@gmail.com"===e.email&&(await (0,l.yS)(e.uid,e.email,"admin",e.displayName||void 0,[]),a=await (0,l.uG)(e.uid)),t&&(d(a),b((null==a?void 0:a.accessPages)||[]))}catch(e){console.error("Error getting user role:",e),t&&h("Failed to load user role")}else t&&(d(null),b([]));t&&u(!1)}})}catch(e){console.error("Firebase initialization error:",e),t&&(h("Failed to initialize authentication"),u(!1))}})(),()=>{t=!1,e&&e()}},[]);let p=(null==c?void 0:c.role)==="admin";return(0,s.jsx)(n.Provider,{value:{user:a,userRole:c,loading:m,isAdmin:p,error:x,accessiblePages:g,canAccessPage:e=>!!c&&("admin"===c.role||g.includes(e))},children:t})}},40954:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ei});var s=a(95155),r=a(12115),l=a(931);function i(e){let{children:t}=e,[a,l]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{l(!0)},[]),a)?(0,s.jsx)(s.Fragment,{children:t}):null}var n=a(40646),o=a(69074),c=a(85339),d=a(54861),m=a(14186);let u=(()=>{let e=new Map;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1440,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r="".concat(t,"-").concat(a,"-").concat(s);if(e.has(r))return e.get(r);let l=[];for(let e=t;e<=a;e+=s){let t=Math.floor(e/60).toString().padStart(2,"0"),a=(e%60).toString().padStart(2,"0");l.push("".concat(t,":").concat(a))}return e.set(r,l),l}})(),x=(()=>{let e=new Map;return t=>{if(e.has(t))return e.get(t);let[a,s]=t.split(":"),r=Number(a),l=r>=12?"PM":"AM";0===r&&(r=12),r>12&&(r-=12);let i="".concat(r,":").concat(s," ").concat(l);return e.set(t,i),i}})(),h=Array.from(new Set(u().map(e=>e.split(":")[0]))).sort((e,t)=>Number(e)-Number(t));h.length;let g={blue:{gradient:"from-blue-500 to-cyan-600",text:"text-blue-600",bg:"bg-blue-50",border:"border-blue-200"},green:{gradient:"from-green-500 to-emerald-600",text:"text-green-600",bg:"bg-green-50",border:"border-green-200"},amber:{gradient:"from-amber-500 to-yellow-600",text:"text-amber-600",bg:"bg-amber-50",border:"border-amber-200"},red:{gradient:"from-red-500 to-rose-600",text:"text-red-600",bg:"bg-red-50",border:"border-red-200"}},b=(0,r.memo)(e=>{let{title:t,value:a,icon:r,color:l}=e,i=g[l];return(0,s.jsx)("div",{className:"group relative overflow-hidden rounded-lg ".concat(i.bg," border ").concat(i.border," p-3 transition-all duration-200 hover:shadow-md"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"p-1.5 bg-gradient-to-r ".concat(i.gradient," rounded-lg shadow-sm"),children:(0,s.jsx)(r,{className:"w-3 h-3 text-white"})}),(0,s.jsx)("span",{className:"text-xs font-medium ".concat(i.text),children:t})]}),(0,s.jsx)("div",{className:"text-lg font-bold ".concat(i.text),children:a})]})})});b.displayName="CompactStatCard";let p=(0,r.memo)(e=>{let{hour:t,enabled:a,onChange:l}=e,i=(0,r.useCallback)(e=>{l(e.target.checked)},[l]),o=Number(t)>12?Number(t)-12:0===Number(t)?12:Number(t);return(0,s.jsxs)("label",{className:"relative cursor-pointer group",title:x("".concat(t,":00")),children:[(0,s.jsx)("input",{type:"checkbox",checked:a,onChange:i,className:"sr-only"}),(0,s.jsxs)("div",{className:"\n        relative p-1.5 rounded text-[10px] font-medium text-center transition-all duration-150\n        border backdrop-blur-sm min-w-[32px]\n        ".concat(a?"bg-gradient-to-br from-green-500 to-emerald-600 text-white shadow-sm border-green-500":"bg-white/80 text-gray-600 border-gray-300 group-hover:bg-white group-hover:border-gray-400","\n        group-hover:scale-105\n      "),children:[(0,s.jsx)("div",{className:"flex items-center justify-center",children:a?(0,s.jsx)(n.A,{className:"w-2.5 h-2.5"}):(0,s.jsx)("span",{className:"text-[10px] font-medium",children:o})}),(0,s.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[x("".concat(t,":00")),(0,s.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})]})]})});p.displayName="CompactHourToggle";let f=(0,r.memo)(function(e){let{bookings:t,enabledHours:a,onHoursChange:l}=e,i=(0,r.useMemo)(()=>{let e=t.length,a=0,s=0,r=0;for(let e=0;e<t.length;e++)switch(t[e].status){case"upcoming":a++;break;case"past":s++;break;case"cancelled":r++}return{total:e,upcoming:a,past:s,cancelled:r}},[t]),u=(0,r.useMemo)(()=>{let e=0,t=Object.values(a);for(let a=0;a<t.length;a++)t[a]&&e++;return e},[a]),x=h.length,g=(0,r.useCallback)(e=>{let t={};for(let a=0;a<h.length;a++)t[h[a]]=e;l(t)},[l]),f=(0,r.useCallback)((e,t)=>{l({...a,[e]:t})},[a,l]);return(0,s.jsx)("div",{className:"w-full",children:(0,s.jsxs)("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-br from-indigo-50 via-white to-purple-50 border border-white/20 shadow-lg backdrop-blur-sm",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/3 via-purple-500/3 to-pink-500/3"}),(0,s.jsxs)("div",{className:"relative p-4 sm:p-5",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg bg-gradient-to-r from-indigo-500 to-purple-600 shadow-md",children:(0,s.jsx)(o.A,{className:"w-4 h-4 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-gray-800",children:"Schedule Controls"}),(0,s.jsxs)("p",{className:"text-xs text-gray-600 hidden sm:block",children:[u,"/",x," hours enabled"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-sm font-bold text-indigo-600",children:i.total}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Total"})]}),(0,s.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-sm font-bold text-emerald-600",children:i.upcoming}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Active"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4",children:[(0,s.jsx)("div",{className:"lg:col-span-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-2 gap-3",children:[(0,s.jsx)(b,{title:"Total",value:i.total,icon:o.A,color:"blue"}),(0,s.jsx)(b,{title:"Upcoming",value:i.upcoming,icon:n.A,color:"green"}),(0,s.jsx)(b,{title:"Completed",value:i.past,icon:c.A,color:"amber"}),(0,s.jsx)(b,{title:"Cancelled",value:i.cancelled,icon:d.A,color:"red"})]})}),(0,s.jsx)("div",{className:"lg:col-span-8",children:(0,s.jsxs)("div",{className:"bg-white/50 rounded-lg p-4 border border-white/50",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.A,{className:"w-4 h-4 text-gray-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Business Hours"})]}),(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)("button",{onClick:()=>g(!0),className:"px-2 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"All"}),(0,s.jsx)("button",{onClick:()=>g(!1),className:"px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"None"})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 gap-1",children:h.map(e=>(0,s.jsx)(p,{hour:e,enabled:!!a[e],onChange:t=>f(e,t)},e))}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-600",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500"}),(0,s.jsx)("span",{children:"Enabled"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-300"}),(0,s.jsx)("span",{children:"Disabled"})]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[u,"/",x," enabled"]})]})]})})]})]})]})})});var v=a(54416),y=a(81586),j=a(71007),N=a(84616),w=a(47924),k=a(66932),C=a(3898),D=a(59836),M=a(40283);let S=(()=>{let e=[];for(let t=0;t<=1440;t+=15){let a=Math.floor(t/60).toString().padStart(2,"0"),s=(t%60).toString().padStart(2,"0");e.push("".concat(a,":").concat(s))}return e})(),A={timeConversions:new Map,bookingPositions:new Map,displayTimes:new Map,paymentMethods:new Map},E=e=>A.timeConversions.get(e)||(()=>{if(e.includes("AM")||e.includes("PM"))return A.timeConversions.set(e,e),e;let[t,a]=e.split(":"),s=Number(t),r=s>=12?"PM":"AM";0===s?s=12:s>12&&(s-=12);let l="".concat(s,":").concat(a," ").concat(r);return A.timeConversions.set(e,l),l})(),P=(e,t)=>{let a=e;if(e.includes("PM")||e.includes("AM")){let[t,s]=e.split(" "),[r,l]=t.split(":").map(Number);"PM"===s&&r<12&&(r+=12),"AM"===s&&12===r&&(r=0),a="".concat(r.toString().padStart(2,"0"),":").concat(l.toString().padStart(2,"0"))}let[s,r]=a.split(":").map(Number),l=60*s+r+t,i=Math.floor(l/60);return"".concat(i.toString().padStart(2,"0"),":").concat((l%60).toString().padStart(2,"0"))},T=(e,t)=>{let a="".concat(e,"-").concat(t);if(A.bookingPositions.has(a))return A.bookingPositions.get(a);let s=e;if(e.includes("PM")||e.includes("AM")){let[t,a]=e.split(" "),[r,l]=t.split(":").map(Number);"PM"===a&&r<12&&(r+=12),"AM"===a&&12===r&&(r=0),s="".concat(r.toString().padStart(2,"0"),":").concat(l.toString().padStart(2,"0"))}let[r,l]=s.split(":").map(Number),i=60*r+l,n=Math.max(1,Math.ceil(t/15)),o={startSlotIndex:Math.min(Math.floor((60*r+l)/15),S.length-1),durationInSlots:n,startMinutes:i,endMinutes:i+t,endTime:P(e,t),normalizedTime:s};return A.bookingPositions.set(a,o),o},B=(0,r.memo)(e=>{let{notifications:t,removeNotification:a}=e;return(0,s.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm w-full",children:t.map(e=>(0,s.jsx)("div",{className:"p-4 rounded-lg shadow-lg border-l-4 transform transition-all duration-200 ease-out ".concat("success"===e.type?"bg-green-50 border-green-500 text-green-800":"error"===e.type?"bg-red-50 border-red-500 text-red-800":"bg-blue-50 border-blue-500 text-blue-800"," animate-in slide-in-from-right-full"),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 ".concat("success"===e.type?"text-green-500":"error"===e.type?"text-red-500":"text-blue-500"),children:"success"===e.type?(0,s.jsx)(n.A,{className:"w-5 h-5"}):(e.type,(0,s.jsx)(c.A,{className:"w-5 h-5"}))}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h4",{className:"font-semibold text-sm",children:e.title}),(0,s.jsx)("p",{className:"text-sm opacity-90 mt-1",children:e.message})]}),(0,s.jsx)("button",{onClick:()=>a(e.id),className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors duration-150",children:(0,s.jsx)(v.A,{className:"w-4 h-4"})})]})},e.id))})});B.displayName="NotificationContainer";let I=(0,r.memo)(e=>{let{paymentMethods:t}=e,a=(0,r.useMemo)(()=>Array.isArray(t)?t:"string"==typeof t&&""!==t.trim()?t.includes(",")?t.split(",").map(e=>e.trim()).filter(e=>""!==e):[t.trim()]:["cash"],[t]),l=(0,r.useMemo)(()=>{let e={cash:{icon:"\uD83D\uDCB5",label:"Cash"},card:{icon:"\uD83D\uDCB3",label:"Card"},"credit card":{icon:"\uD83D\uDCB3",label:"Card"},upi:{icon:"\uD83D\uDCF1",label:"UPI"},wallet:{icon:"\uD83D\uDC5B",label:"Wallet"},netbanking:{icon:"\uD83C\uDFE6",label:"Net Banking"},cheque:{icon:"\uD83D\uDCC4",label:"Cheque"},paypal:{icon:"\uD83D\uDD35",label:"PayPal"}};return a.map(t=>e[t.toLowerCase().trim()]||{icon:"\uD83D\uDCB3",label:t})},[a]);return 0===a.length?(0,s.jsxs)("div",{className:"flex items-center text-[11px] font-semibold opacity-95 min-w-0",children:[(0,s.jsx)(y.A,{className:"w-3 h-3 mr-1.5 flex-shrink-0 text-gray-400"}),(0,s.jsx)("span",{className:"text-gray-500 italic",children:"No payment"})]}):1===a.length?(0,s.jsxs)("div",{className:"flex items-center text-[11px] font-semibold opacity-95 min-w-0",children:[(0,s.jsx)(y.A,{className:"w-3 h-3 mr-1.5 flex-shrink-0"}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:l[0].icon}),(0,s.jsx)("span",{children:l[0].label})]})]}):(0,s.jsxs)("div",{className:"flex items-center text-[11px] font-semibold opacity-95 min-w-0 group relative",children:[(0,s.jsx)(y.A,{className:"w-3 h-3 mr-1.5 flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:l[0].icon}),(0,s.jsx)("span",{children:l[0].label})]}),(0,s.jsxs)("span",{className:"bg-blue-100 text-blue-700 px-1 rounded text-[10px] font-bold border border-blue-200 ml-1",children:["+",a.length-1]})]})]})});I.displayName="PaymentMethodsDisplay";let O=(0,r.memo)(e=>{let{booking:t,onEdit:a,onGenerateInvoice:l,isAdmin:i,showTime:n=!0,slotDuration:o=1,onDragStart:c,onDragEnd:d}=e,u=(0,r.useRef)(null),x=(0,r.useCallback)(e=>{e.stopPropagation(),l(t)},[t,l]),h=(0,r.useCallback)(e=>{e.target.closest(".invoice-button")||e.target.closest(".drag-handle")||a(t)},[t,a]),g=(0,r.useCallback)(e=>{e.stopPropagation();let a={type:"booking",id:t.id};e.dataTransfer.setData("application/json",JSON.stringify(a)),e.dataTransfer.effectAllowed="move",u.current&&(u.current.style.opacity="0.7"),null==c||c(t)},[t,c]),b=(0,r.useCallback)(e=>{u.current&&(u.current.style.opacity="1"),null==d||d()},[d]),{serviceNames:p,statusStyle:f,displayTime:v,endTimeDisplay:y,cardHeight:N}=(0,r.useMemo)(()=>{var e;return{serviceNames:(null==(e=t.services)?void 0:e.map(e=>e.serviceName).join(", "))||"No services",statusStyle:(e=>{let t={upcoming:{background:"bg-gradient-to-r from-blue-500 to-blue-600",border:"border-2 border-blue-400 shadow-md",text:"text-white",header:"bg-blue-600/20"},past:{background:"bg-gradient-to-r from-green-500 to-green-600",border:"border-2 border-green-400 shadow-md",text:"text-white",header:"bg-green-600/20"},cancelled:{background:"bg-gradient-to-r from-red-500 to-red-600",border:"border-2 border-red-400 shadow-md",text:"text-white",header:"bg-red-600/20"}};return t[e]||t.upcoming})(t.status),displayTime:A.displayTimes.get(t.bookingTime)||E(t.bookingTime),endTimeDisplay:E(P(t.bookingTime,t.totalDuration||30)),cardHeight:60*o-8}},[t,o]);return(0,s.jsxs)("div",{ref:u,onClick:h,draggable:"true",onDragStart:g,onDragEnd:b,className:"w-full rounded-lg ".concat(f.background," ").concat(f.border," ").concat(f.text," shadow-lg hover:shadow-xl transition-all duration-150 ease-out cursor-grab active:cursor-grabbing overflow-hidden absolute top-1 left-1 right-1 bottom-1 transform-gpu"),style:{height:"".concat(N,"px"),minHeight:"52px"},title:"Drag to move - ".concat(t.customerName),children:[(0,s.jsxs)("div",{className:"".concat(f.header," border-b border-white/20 px-2 py-1 flex justify-between items-center"),children:[(0,s.jsx)("div",{className:"flex-1 min-w-0 pr-2",children:(0,s.jsxs)("div",{className:"font-extrabold text-sm truncate flex items-center",children:[(0,s.jsx)("span",{className:"drag-handle mr-1 cursor-grab",children:"⠿"}),t.customerName]})}),(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0 min-w-0",children:["past"===t.status&&(0,s.jsx)("button",{onClick:x,className:"invoice-button text-[10px] px-2 py-1 rounded-lg bg-white text-gray-800 hover:bg-gray-100 transition-colors border border-gray-300 hover:border-gray-400 whitespace-nowrap font-bold shadow-sm flex-shrink-0",children:"\uD83D\uDCB0 Invoice"}),n&&(0,s.jsx)("span",{className:"text-[10px] font-black bg-black bg-opacity-30 px-2 py-1 rounded-md whitespace-nowrap tracking-tight flex-shrink-0",children:v})]})]}),(0,s.jsxs)("div",{className:"p-2 h-full flex flex-col min-w-0",children:[(0,s.jsx)("div",{className:"mb-2 flex-shrink-0 min-w-0",children:(0,s.jsx)("div",{className:"text-xs font-semibold opacity-95 line-clamp-1",children:p})}),(0,s.jsxs)("div",{className:"flex-1 min-h-0 space-y-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center text-[11px] font-semibold opacity-95 min-w-0",children:[(0,s.jsx)(m.A,{className:"w-3 h-3 mr-1.5 flex-shrink-0"}),(0,s.jsxs)("span",{className:"truncate",children:[v," - ",y]})]}),(0,s.jsx)(I,{paymentMethods:t.paymentMethods||t.paymentMethod}),t.staff&&o>=2&&(0,s.jsxs)("div",{className:"flex items-center text-[11px] font-semibold opacity-95 min-w-0",children:[(0,s.jsx)(j.A,{className:"w-3 h-3 mr-1.5 flex-shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:t.staff})]})]}),(0,s.jsx)("div",{className:"absolute bottom-1 right-1",children:(0,s.jsxs)("div",{className:"text-[10px] font-bold bg-black bg-opacity-40 px-2 py-0.5 rounded-md border border-white/20",children:[t.totalDuration||30,"m"]})})]})]})});O.displayName="BookingCard";let q=(0,r.memo)(e=>{let{staffName:t}=e;return(0,s.jsx)("div",{className:"sticky top-0 z-20 bg-gradient-to-r from-gray-100 to-gray-50 border-b-2 border-gray-300 px-4 py-3 font-extrabold text-gray-800 text-sm truncate",children:t})});q.displayName="StaffHeader";let F=(0,r.memo)(e=>{let{time:t}=e,a=(0,r.useMemo)(()=>E(t),[t]);return(0,s.jsx)("div",{className:"sticky left-0 z-10 bg-gray-100 border-r-2 border-gray-300 px-4 py-4 font-bold text-gray-800 h-[60px] flex items-center truncate",children:a})});F.displayName="TimeSlot";let G=(0,r.memo)(e=>{let{time:t,staff:a,isOccupied:l,hasPrimary:i,onCellClick:n,onDropBooking:o,primaryBookings:c,getSlotDuration:d,onEditBooking:m,onGenerateInvoice:u,isAdmin:x,onDragStart:h,onDragEnd:g}=e,[b,p]=(0,r.useState)(!1),f=(0,r.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",l||p(!0)},[l]),v=(0,r.useCallback)(e=>{e.preventDefault(),p(!1)},[]),y=(0,r.useCallback)(e=>{e.preventDefault(),p(!1);try{let s=JSON.parse(e.dataTransfer.getData("application/json"));"booking"===s.type&&o(s,a,t)}catch(e){console.log("Drop error")}},[a,t,o]),j=(0,r.useCallback)(()=>{l||n(a,t)},[l,a,t,n]);return(0,s.jsx)("div",{className:"border-r border-gray-200 relative h-full transition-colors duration-100 ".concat(b?"bg-blue-100 border-2 border-blue-400":l?"":"hover:bg-gray-50 cursor-pointer"),onDragOver:f,onDragLeave:v,onDrop:y,onClick:j,children:(0,s.jsx)("div",{className:"p-1 h-full relative",children:b&&!l?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-blue-600 font-bold h-full",children:[(0,s.jsx)("div",{className:"text-2xl mb-1",children:"⬇️"}),(0,s.jsx)("div",{className:"text-xs",children:"Drop to Move"})]}):l||i?c.map(e=>{let r=d(e);return(0,s.jsx)(O,{booking:e,onEdit:m,onGenerateInvoice:u,isAdmin:x,showTime:!0,slotDuration:r,onDragStart:h,onDragEnd:g},"booking-".concat(e.id,"-").concat(t,"-").concat(a))}):(0,s.jsx)("button",{className:"flex items-center justify-center w-10 h-10 text-emerald-700 hover:text-emerald-900 hover:bg-emerald-100 rounded-full transition-colors border-2 border-dashed border-emerald-400 hover:border-emerald-500 z-10",onClick:e=>{e.stopPropagation(),n(a,t)},title:"Add Booking",children:(0,s.jsx)(N.A,{className:"w-5 h-5 font-bold"})})})})});G.displayName="ScheduleCell";let L=(0,r.memo)(e=>{let{branches:t,staff:a,uniqueTimes:l,filters:i,onFiltersChange:n,searchTerm:o,onSearchChange:c}=e,[d,m]=(0,r.useState)(o);(0,r.useEffect)(()=>{let e=setTimeout(()=>{c(d)},150);return()=>clearTimeout(e)},[d,c]);let u=(0,r.useCallback)((e,t)=>{n({...i,[e]:t})},[i,n]),x=(0,r.useCallback)(()=>{n({branch:"",staff:"",date:"",customer:"",time:""}),m("")},[n]),h=d||Object.values(i).some(e=>""!==e);return(0,s.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm p-4 rounded-lg border border-gray-200 mb-4",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-3 items-start lg:items-end",children:[(0,s.jsxs)("div",{className:"flex-1 w-full",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Search Bookings"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(w.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,s.jsx)("input",{type:"text",placeholder:"Search bookings...",value:d,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),[{key:"branch",label:"Branch",options:t,width:"w-40"},{key:"staff",label:"Staff",options:a,width:"w-40"},{key:"time",label:"Time",options:l,width:"w-40"}].map(e=>{let{key:t,label:a,options:r,width:l}=e;return(0,s.jsxs)("div",{className:"w-full ".concat(l),children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:a}),(0,s.jsxs)("select",{value:i[t],onChange:e=>u(t,e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,s.jsxs)("option",{value:"",children:["All ",a]}),"staff"===t&&(0,s.jsx)("option",{value:"Unassigned",children:"Unassigned"}),r.map(e=>(0,s.jsx)("option",{value:e,children:"time"===t?E(e):e},e))]})]},t)}),(0,s.jsxs)("div",{className:"w-full lg:w-40",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Date"}),(0,s.jsx)("input",{type:"date",value:i.date,onChange:e=>u("date",e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),h&&(0,s.jsx)("div",{className:"w-full lg:w-auto",children:(0,s.jsxs)("button",{onClick:x,className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:[(0,s.jsx)(v.A,{className:"w-4 h-4"}),"Clear"]})})]}),h&&(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-sm text-blue-600",children:[(0,s.jsx)(k.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Filters Active"})]})]})});function U(e){let{bookings:t,staffOptions:a,scheduleDate:l,scheduleBranch:i,enabledHours:n,onCellClick:c,onEditBooking:d,onGenerateInvoice:m,filters:u={},searchTerm:x=""}=e,{isAdmin:h}=(0,M.A)(),[g,b]=(0,r.useState)({branch:"",staff:"",date:"",customer:"",time:""}),[p,f]=(0,r.useState)(""),[v,y]=(0,r.useState)(null),[j,N]=(0,r.useState)([]),w=(0,r.useCallback)(e=>{let t=Math.random().toString(36).substr(2,9),a={...e,id:t};N(e=>[...e,a]),setTimeout(()=>k(t),e.duration||3e3)},[]),k=(0,r.useCallback)(e=>{N(t=>t.filter(t=>t.id!==e))},[]),A=(0,r.useCallback)(e=>{y(e)},[]),P=(0,r.useCallback)(()=>{y(null)},[]),I=(0,r.useCallback)((e,a,s)=>{let r=t.find(t=>t.id===e.id);r&&(d({...r,staff:a,bookingTime:s}),w({type:"success",title:"Booking Moved",message:"Moved to ".concat(a," at ").concat(E(s)),duration:2e3}))},[t,d,w]),O=Object.keys(u).length>0?u:g,U=x||p,z=(0,r.useMemo)(()=>S.filter(e=>!0===n[e.split(":")[0]]),[n]),H=(0,r.useMemo)(()=>{let e=new Set(a||[]);return e.add("Unassigned"),null==t||t.forEach(t=>{var a;(null==(a=t.staff)?void 0:a.trim())&&e.add(t.staff)}),Array.from(e)},[a,t]),[R,J]=(0,r.useMemo)(()=>{let e=new Set,a=new Set;return null==t||t.forEach(t=>{t.branch&&e.add(t.branch),t.bookingTime&&a.add(t.bookingTime)}),[Array.from(e).sort(),Array.from(a).sort()]},[t]),_=(0,r.useMemo)(()=>(null==t?void 0:t.length)?t.filter(e=>{if(l){let t=new Date(e.bookingDate),a=new Date(l);if(!(0,C.r)(t,a))return!1}if(i&&"all"!==i&&e.branch!==i)return!1;if(U.length>0){var t,a,s;let r=U.toLowerCase();if(!((null==(t=e.customerName)?void 0:t.toLowerCase().includes(r))||(null==(a=e.branch)?void 0:a.toLowerCase().includes(r))||(null==(s=e.services)?void 0:s.some(e=>{var t;return null==(t=e.serviceName)?void 0:t.toLowerCase().includes(r)}))||e.staff&&e.staff.toLowerCase().includes(r)))return!1}if(O.branch&&e.branch!==O.branch)return!1;if(O.staff){if("Unassigned"===O.staff){if(e.staff&&e.staff.trim()&&"—"!==e.staff)return!1}else if(e.staff!==O.staff)return!1}return(!O.date||(0,D.GP)(new Date(e.bookingDate),"yyyy-MM-dd")===O.date)&&(!O.time||e.bookingTime===O.time)}):[],[t,l,i,U,O]),W=(0,r.useMemo)(()=>{let e={};return z.forEach(t=>{e[t]={},H.forEach(a=>{e[t][a]=[]})}),_.forEach(t=>{let a=T(t.bookingTime,t.totalDuration||30),s=t.staff&&H.includes(t.staff)?t.staff:"Unassigned";for(let l=0;l<a.durationInSlots;l++){let i=a.startSlotIndex+l;if(i<S.length){var r;let a=S[i];(null==(r=e[a])?void 0:r[s])&&!e[a][s].some(e=>e.id===t.id)&&e[a][s].push(t)}}}),e},[_,z,H]),Q=(0,r.useMemo)(()=>({isPrimarySlot:(e,t)=>S[T(e.bookingTime,e.totalDuration||30).startSlotIndex]===t,getSlotDuration:e=>T(e.bookingTime,e.totalDuration||30).durationInSlots,isCellOccupied:(e,t)=>{var a;return((null==(a=W[e])?void 0:a[t])||[]).length>0},hasPrimaryBookings:(e,t)=>{var a;return((null==(a=W[e])?void 0:a[t])||[]).some(t=>S[T(t.bookingTime,t.totalDuration||30).startSlotIndex]===e)}}),[W]),Z=(0,r.useCallback)((e,t)=>{c(e,t)},[c]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B,{notifications:j,removeNotification:k}),(0,s.jsxs)("div",{className:"relative overflow-hidden rounded-2xl bg-slate-50 border-2 border-gray-300 shadow-2xl backdrop-blur-sm mb-0",children:[(0,s.jsx)("div",{className:"relative p-6 border-b-2 border-gray-300 bg-gradient-to-r from-gray-50 to-white",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 shadow-lg border-2 border-indigo-400",children:(0,s.jsx)(o.A,{className:"w-5 h-5 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-extrabold text-gray-800 tracking-wide",children:"Schedule Board"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[_.length," bookings • ",z.length," time slots • ",H.length," staff"]})]})]})}),(0,s.jsx)("div",{className:"px-6 py-4",children:(0,s.jsx)(L,{branches:R,staff:H,uniqueTimes:J,filters:O,onFiltersChange:b,searchTerm:U,onSearchChange:f})}),(0,s.jsxs)("div",{className:"relative overflow-x-auto w-full",children:[(0,s.jsxs)("div",{className:"grid sticky top-0 z-30 bg-white border-b-2 border-gray-300",style:{gridTemplateColumns:"180px repeat(".concat(H.length,", 200px)")},children:[(0,s.jsx)("div",{className:"sticky left-0 z-40 bg-white border-r-2 border-gray-300 px-4 py-3 font-extrabold text-gray-800 h-[60px] flex items-center",children:"Time"}),H.map(e=>(0,s.jsx)(q,{staffName:e},e))]}),z.map(e=>(0,s.jsxs)("div",{className:"grid border-b border-gray-200",style:{gridTemplateColumns:"180px repeat(".concat(H.length,", 200px)"),height:"60px"},children:[(0,s.jsx)(F,{time:e}),H.map(t=>{var a;let r=((null==(a=W[e])?void 0:a[t])||[]).filter(t=>Q.isPrimarySlot(t,e));return(0,s.jsx)(G,{time:e,staff:t,isOccupied:Q.isCellOccupied(e,t),hasPrimary:Q.hasPrimaryBookings(e,t),onCellClick:Z,onDropBooking:I,primaryBookings:r,getSlotDuration:Q.getSlotDuration,onEditBooking:d,onGenerateInvoice:m,isAdmin:h,onDragStart:A,onDragEnd:P},"".concat(e,"-").concat(t))})]},e))]})]})]})}L.displayName="FilterBar";var z=a(62525);let H=(0,r.memo)(e=>{let{service:t,index:a,serviceOptions:l,selectedCategory:i,staffOptions:n,onChange:o,onRemove:c,showRemove:d}=e,m=(0,r.useCallback)((e,t)=>{o(a,e,t)},[a,o]),u=(0,r.useCallback)(()=>{c(a)},[a,c]),x=(0,r.useMemo)(()=>l.filter(e=>!i||e.category===i),[l,i]),h=(0,r.useMemo)(()=>n,[n]);return(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 border-t",children:[(0,s.jsx)("div",{className:"col-span-3",children:(0,s.jsxs)("select",{className:"w-full border rounded-md px-3 py-2",value:t.serviceName,onChange:e=>m("serviceName",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select a service"}),x.map(e=>(0,s.jsx)("option",{value:e.name,children:e.name},e.id))]})}),(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsxs)("select",{className:"w-full border rounded-md px-3 py-2",value:t.staffMember||"",onChange:e=>m("staffMember",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select staff"}),h.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})}),(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)("input",{type:"number",min:0,className:"w-full border rounded-md px-3 py-2",value:t.duration,onChange:e=>m("duration",Number(e.target.value||0))})}),(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)("input",{type:"number",min:0,step:"0.01",className:"w-full border rounded-md px-3 py-2",value:t.price,onChange:e=>m("price",Number(e.target.value||0))})}),(0,s.jsx)("div",{className:"col-span-1",children:(0,s.jsx)("input",{type:"number",min:1,className:"w-full border rounded-md px-3 py-2",value:t.quantity,onChange:e=>m("quantity",Number(e.target.value||1))})}),(0,s.jsx)("div",{className:"col-span-1 flex justify-end items-center",children:d&&(0,s.jsx)("button",{onClick:u,className:"p-2 rounded hover:bg-red-50 text-red-600 transition-colors",title:"Remove",children:(0,s.jsx)(z.A,{className:"w-4 h-4"})})})]})});H.displayName="ServiceRow";let R=(0,r.memo)(e=>{let{payment:t,index:a,paymentMethods:l,onChange:i,onRemove:n,showRemove:o}=e,c=(0,r.useCallback)((e,t)=>{i(a,e,t)},[a,i]),d=(0,r.useCallback)(()=>{n(a)},[a,n]);return(0,r.useMemo)(()=>l.length>0?l:W,[l]),(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 border-t",children:[(0,s.jsx)("div",{className:"col-span-6",children:(0,s.jsxs)("select",{className:"w-full border rounded-md px-3 py-2",value:t.method,onChange:e=>c("method",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select payment method"}),l.length>0?l.map(e=>(0,s.jsx)("option",{value:e.name||e.method||e.title||"",children:(e.name||e.method||e.title||"").toUpperCase()},e.id)):W.map(e=>(0,s.jsx)("option",{value:e,children:e.toUpperCase()},e))]})}),(0,s.jsx)("div",{className:"col-span-4",children:(0,s.jsx)("input",{type:"number",min:0,step:"0.01",className:"w-full border rounded-md px-3 py-2",placeholder:"Amount (AED)",value:t.amount,onChange:e=>c("amount",Number(e.target.value||0))})}),(0,s.jsx)("div",{className:"col-span-2 flex justify-end items-center",children:o&&(0,s.jsx)("button",{onClick:d,className:"p-2 rounded hover:bg-red-50 text-red-600 transition-colors",title:"Remove payment method",children:(0,s.jsx)(z.A,{className:"w-4 h-4"})})})]})});R.displayName="PaymentDetailRow";let J={serviceId:"",serviceName:"",category:"",duration:30,price:0,quantity:1,staffMember:""},_=Object.freeze(["AI Bustaan","Marina","TECOM","AL Muraqabat","IBN Batutta Mall"]),W=Object.freeze(["cash","card","tabby","tamara","apple pay","google pay","samsung wallet","paypal","american express","ewallet STC pay","bank transfer","cash on delivery","other"]),Q=new Map,Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1440,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,s="".concat(e,"-").concat(t,"-").concat(a);if(Q.has(s))return Q.get(s);let r=[];for(let s=e;s<=t;s+=a){let e=Math.floor(s/60).toString().padStart(2,"0"),t=(s%60).toString().padStart(2,"0");r.push("".concat(e,":").concat(t))}return Q.set(s,r),r}(),K=new Map,$=(0,r.memo)(function(e){let{isOpen:t,isEditing:a,editingId:l,bookingData:i,staffOptions:n,serviceOptions:o,paymentMethods:c,enabledHours:m,onSave:u,onDelete:x,onClose:h,onGenerateInvoice:g}=e,b=(0,r.useMemo)(()=>({...J}),[]),p=(0,r.useMemo)(()=>({branch:_[0],serviceDate:(0,D.GP)(new Date,"yyyy-MM-dd"),serviceTime:"10:00",customerName:"",customerEmail:"",paymentMethod:"cash",paymentDetails:[{method:"cash",amount:0}],customPaymentMethod:"",emailConfirmation:!1,smsConfirmation:!1,status:"upcoming",staff:"",services:[b],remarks:"",tip:0,discount:0}),[b]),f=(0,r.useMemo)(()=>Z.filter(e=>!!m[e.split(":")[0]]),[m]),v=(0,r.useMemo)(()=>Array.from(new Set(o.map(e=>e.category))),[o]),[y,j]=(0,r.useState)(p),[w,k]=(0,r.useState)(""),[C,M]=(0,r.useState)(!1),[S,A]=(0,r.useState)(!1),E=(0,r.useMemo)(()=>{var e;return{totalPrice:(e=y.services).reduce((e,t)=>e+(Number(t.price)||0)*(Number(t.quantity)||0),0),totalDuration:e.reduce((e,t)=>e+(Number(t.duration)||0)*(Number(t.quantity)||0),0)}},[y.services]),P=(0,r.useMemo)(()=>E.totalPrice+(y.tip||0)-(y.discount||0),[E.totalPrice,y.tip,y.discount]),T=(0,r.useMemo)(()=>y.paymentDetails.reduce((e,t)=>e+(t.amount||0),0),[y.paymentDetails]),B=(0,r.useMemo)(()=>Math.abs(T-P)>.01,[T,P]);(0,r.useEffect)(()=>{t&&i?j({...i,paymentDetails:i.paymentDetails||[{method:i.paymentMethod||"cash",amount:0}]}):t&&(j(p),k(""))},[t,i,p]);let I=(0,r.useCallback)((e,t,a)=>{j(s=>({...s,services:s.services.map((s,r)=>{if(r!==e)return s;if("serviceName"===t){let e=o.find(e=>e.name===a);if(e)return{...s,serviceName:a,duration:e.duration||0,price:e.price||0,category:e.category||s.category}}return{...s,[t]:a}})}))},[o]),O=(0,r.useCallback)(()=>{j(e=>({...e,services:[...e.services,{...J}]}))},[]),q=(0,r.useCallback)(e=>{j(t=>({...t,services:t.services.filter((t,a)=>a!==e)}))},[]),F=(0,r.useCallback)((e,t)=>{j(a=>({...a,[e]:t}))},[]),G=(0,r.useCallback)((e,t,a)=>{j(s=>({...s,paymentDetails:s.paymentDetails.map((s,r)=>r!==e?s:{...s,[t]:a})}))},[]),L=(0,r.useCallback)(()=>{j(e=>({...e,paymentDetails:[...e.paymentDetails,{method:"",amount:0}]}))},[]),U=(0,r.useCallback)(e=>{j(t=>({...t,paymentDetails:t.paymentDetails.filter((t,a)=>a!==e)}))},[]),W=(0,r.useCallback)(()=>y.customerName.trim()?y.serviceDate?y.serviceTime?y.branch?y.staff?0===y.services.length?"Add at least one service":y.services.every(e=>e.serviceName.trim().length>0)?m[y.serviceTime.split(":")[0]]?0===y.paymentDetails.length?"Add at least one payment method":y.paymentDetails.every(e=>e.method.trim().length>0&&e.amount>0)?B?"Total payment amount (".concat(T.toFixed(2),") must equal the final total (").concat(P.toFixed(2),")"):null:"Each payment method must have a valid method and amount":"Selected time falls into a disabled hour":"Each service must have a name":"Staff is required":"Branch is required":"Service time is required":"Service date is required":"Customer name is required",[y,m,B,T,P]),Q=(0,r.useCallback)(async()=>{let e=W();if(e)return void alert(e);try{M(!0);let e={...y,paymentMethod:y.paymentDetails.map(e=>e.method).join(", ")};await u(e,l||void 0),h()}catch(e){console.error("Error saving booking:",e),alert("Failed to save booking")}finally{M(!1)}},[y,l,W,u,h]),$=(0,r.useCallback)(async()=>{if(l&&confirm("Delete this booking? This action cannot be undone."))try{A(!0),await x(l),h()}catch(e){console.error("Error deleting booking:",e),alert("Failed to delete booking")}finally{A(!1)}},[l,x,h]),V=(0,r.useCallback)(()=>{h()},[h]);return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 z-50 overflow-y-auto h-full w-full animate-fade-in",children:(0,s.jsx)("div",{className:"relative top-10 mx-auto w-11/12 md:w-4/5 lg:w-3/4 xl:w-2/3",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl border animate-scale-in",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:a?"Edit Schedule":"Add Schedule"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[a&&(0,s.jsxs)("button",{onClick:$,disabled:S,className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-60 transition-colors",title:"Delete booking",children:[(0,s.jsx)(z.A,{className:"w-4 h-4"}),S?"Deleting...":"Delete"]}),(0,s.jsx)("button",{onClick:V,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Close",disabled:C||S,children:(0,s.jsx)(d.A,{className:"w-6 h-6"})})]})]}),(0,s.jsxs)("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Branch"}),(0,s.jsx)("select",{className:"mt-1 w-full border rounded-md px-3 py-2",value:y.branch,onChange:e=>F("branch",e.target.value),children:_.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Customer Email"}),(0,s.jsx)("input",{type:"email",placeholder:"Customer email",className:"mt-1 w-full border rounded-md px-3 py-2",value:y.customerEmail,onChange:e=>F("customerEmail",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),(0,s.jsxs)("select",{className:"mt-1 w-full border rounded-md px-3 py-2",value:w,onChange:e=>k(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select One"}),v.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Staff"}),(0,s.jsxs)("select",{className:"mt-1 w-full border rounded-md px-3 py-2",value:y.staff,onChange:e=>F("staff",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select One"}),n.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Service Date"}),(0,s.jsx)("input",{type:"date",className:"mt-1 w-full border rounded-md px-3 py-2",value:y.serviceDate,onChange:e=>F("serviceDate",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Time Slot"}),(0,s.jsx)("select",{className:"mt-1 w-full border rounded-md px-3 py-2",value:y.serviceTime,onChange:e=>F("serviceTime",e.target.value),children:f.map(e=>(0,s.jsx)("option",{value:e,children:function(e){if(K.has(e))return K.get(e);let[t,a]=e.split(":"),s=Number(t),r=s>=12?"PM":"AM";0===s&&(s=12),s>12&&(s-=12);let l="".concat(s,":").concat(a," ").concat(r);return K.set(e,l),l}(e)},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Customer"}),(0,s.jsx)("input",{type:"text",placeholder:"Customer name",className:"mt-1 w-full border rounded-md px-3 py-2",value:y.customerName,onChange:e=>F("customerName",e.target.value)})]})]}),(0,s.jsxs)("div",{className:"border rounded-lg",children:[(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 bg-gray-50 text-xs font-semibold",children:[(0,s.jsx)("div",{className:"col-span-3",children:"Service"}),(0,s.jsx)("div",{className:"col-span-2",children:"Staff Member"}),(0,s.jsx)("div",{className:"col-span-2",children:"Duration (min)"}),(0,s.jsx)("div",{className:"col-span-2",children:"Price"}),(0,s.jsx)("div",{className:"col-span-1",children:"Qty"}),(0,s.jsx)("div",{className:"col-span-1 text-right",children:"—"})]}),y.services.map((e,t)=>(0,s.jsx)(H,{service:e,index:t,serviceOptions:o,selectedCategory:w,staffOptions:n,onChange:I,onRemove:q,showRemove:y.services.length>1},t)),(0,s.jsx)("div",{className:"px-4 py-3 border-t space-y-3",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Tip Amount (AED)"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",className:"mt-1 w-full border rounded-md px-3 py-2",placeholder:"Enter tip",value:y.tip||"",onChange:e=>F("tip",Number(e.target.value)||0)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Discount (%)"}),(0,s.jsx)("input",{type:"number",min:"0",max:"100",step:"0.1",className:"mt-1 w-full border rounded-md px-3 py-2",placeholder:"Enter discount percentage",value:y.discount||"",onChange:e=>F("discount",Number(e.target.value)||0)})]}),(0,s.jsx)("div",{className:"flex flex-col justify-end",children:(0,s.jsxs)("div",{className:"text-sm font-semibold text-gray-800",children:["Final Total: AED ",P.toFixed(2)]})})]})})]}),(0,s.jsxs)("button",{onClick:O,className:"flex items-center gap-2 px-4 py-2 text-sm text-blue-600 hover:text-blue-800 transition-colors",children:[(0,s.jsx)(N.A,{className:"w-4 h-4"}),"Add Service"]}),(0,s.jsxs)("div",{className:"border rounded-lg",children:[(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 px-4 py-3 bg-gray-50 text-xs font-semibold",children:[(0,s.jsx)("div",{className:"col-span-6",children:"Payment Method"}),(0,s.jsx)("div",{className:"col-span-4",children:"Amount (AED)"}),(0,s.jsx)("div",{className:"col-span-2 text-right",children:"—"})]}),y.paymentDetails.map((e,t)=>(0,s.jsx)(R,{payment:e,index:t,paymentMethods:c,onChange:G,onRemove:U,showRemove:y.paymentDetails.length>1},t)),(0,s.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Total Payments: AED ",T.toFixed(2)]}),(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Expected: AED ",P.toFixed(2)]})]}),B&&(0,s.jsx)("div",{className:"text-sm text-red-600 mt-1",children:"⚠️ Payment total does not match expected amount"})]})]}),(0,s.jsxs)("button",{onClick:L,className:"flex items-center gap-2 px-4 py-2 text-sm text-green-600 hover:text-green-800 transition-colors",children:[(0,s.jsx)(N.A,{className:"w-4 h-4"}),"Add Payment Method"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks (optional)"}),(0,s.jsx)("textarea",{className:"mt-1 w-full border rounded-md px-3 py-2 min-h-[80px]",value:y.remarks,onChange:e=>F("remarks",e.target.value)})]}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Application Status"}),(0,s.jsxs)("select",{className:"mt-1 w-full border rounded-md px-3 py-2",value:y.status,onChange:e=>F("status",e.target.value),children:[(0,s.jsx)("option",{value:"upcoming",children:"Approved (Upcoming)"}),(0,s.jsx)("option",{value:"past",children:"Completed (Past)"}),(0,s.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]})})]})]}),(0,s.jsxs)("div",{className:"px-6 py-4 border-t flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:V,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",disabled:C||S,children:"Close"}),(0,s.jsx)("button",{onClick:Q,className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:opacity-60 transition-colors",disabled:C||S,children:C?a?"Updating...":"Saving...":a?"Update":"Save"})]})]})})}):null});var V=a(78064),X=a(26597),Y=a(85055),ee=a(35317),et=a(56104);let ea=(0,r.memo)(function(e){let{isOpen:t,invoiceData:a,onClose:l}=e,[i,n]=(0,r.useState)(!1),[o,c]=(0,r.useState)({title:"Invoice Receipt",businessName:"MirrorsBeautyLounge",businessEmail:"",businessPhone:"",businessAddress:"",customerName:"",customerEmail:"",customerPhone:"",branch:"",bookingDate:"",bookingTime:"",staff:"",paymentMethod:"",paymentDetails:[],services:[],totalPrice:0,tip:0,discount:0,footerText:"Thank you for your booking! We look forward to serving you."}),{isAdmin:d}=(0,M.A)(),m=(e,t)=>{c(a=>({...a,[e]:t}))};(0,r.useEffect)(()=>{a&&c({title:"Invoice Receipt",businessName:"MirrorsBeautyLounge",businessEmail:"",businessPhone:"",businessAddress:"",customerName:a.customerName||"",customerEmail:a.customerEmail||"",customerPhone:"",branch:a.branch||"",bookingDate:(0,D.GP)(a.bookingDate,"dd MMM yyyy"),bookingTime:a.bookingTime||"",staff:a.staff||"",paymentMethod:a.paymentMethod||"cash",paymentDetails:a.paymentDetails||[{method:a.paymentMethod||"cash",amount:a.totalPrice||0}],services:a.services||[],totalPrice:a.totalPrice||0,tip:a.tipAmount||0,discount:a.discount||0,footerText:"Thank you for your booking! We look forward to serving you."})},[a]);let u=async e=>{try{if(!et.db)return void console.error("❌ Firebase not initialized");let t=e.userId||(0,Y.A)();await (0,ee.gS)((0,ee.rJ)(et.db,"invoices"),{...e,userId:t,bookingId:e.id,createdAt:new Date}),console.log("✅ Invoice saved to Firebase")}catch(e){console.error("❌ Error saving invoice:",e)}},x=async()=>{let e=document.getElementById("invoice-content");if(e)try{let t=await (0,V.$E)(e,{cacheBust:!0}),s=new X.Ay({orientation:"p",unit:"mm",format:"a4"}),r=s.internal.pageSize.getWidth()-20,l=e.offsetHeight*r/e.offsetWidth;s.addImage(t,"PNG",10,10,r,l),s.save("invoice_".concat((null==a?void 0:a.id)||Date.now(),".pdf")),a&&await u(a)}catch(e){console.error("❌ Error generating PDF:",e),alert("Failed to generate PDF")}};if(!t||!a)return null;let h=(o.totalPrice||0)+(o.tip||0)-(o.discount||0);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-auto",children:[(0,s.jsxs)("div",{className:"p-4 border-b flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Invoice"}),(0,s.jsx)("button",{onClick:l,className:"text-gray-500 hover:text-gray-800",children:(0,s.jsx)(v.A,{className:"w-6 h-6"})})]}),(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 rounded mb-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Select Branch Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Brand Email"}),(0,s.jsxs)("select",{className:"border border-gray-300 rounded px-3 py-2 text-sm focus:ring-indigo-500",value:o.businessEmail,onChange:e=>m("businessEmail",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select email"}),(0,s.jsx)("option",{value:"branch@mirrosalon.ae",children:"branch@mirrosalon.ae"}),(0,s.jsx)("option",{value:"marina@mirrosalon.ae",children:"marina@mirrosalon.ae"}),(0,s.jsx)("option",{value:"ibnbattuta@mirrosalon.ae",children:"ibnbattuta@mirrosalon.ae"}),(0,s.jsx)("option",{value:"albustan@mirrosalon.ae",children:"albustan@mirrosalon.ae"}),(0,s.jsx)("option",{value:"tecom@mirrosalon.ae",children:"tecom@mirrosalon.ae"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Brand Phone"}),(0,s.jsxs)("select",{className:"border border-gray-300 rounded px-3 py-2 text-sm focus:ring-indigo-500",value:o.businessPhone,onChange:e=>m("businessPhone",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select number"}),(0,s.jsx)("option",{value:"+971 56 300 5629",children:"Marina: +971 56 300 5629"}),(0,s.jsx)("option",{value:"+971 54 321 0758",children:"IBN Battuta: +971 54 321 0758"}),(0,s.jsx)("option",{value:"+971 50 545 8263",children:"Al Bustan: +971 50 545 8263"}),(0,s.jsx)("option",{value:"+971 4 568 6219",children:"TECOM: +971 4 568 6219"}),(0,s.jsx)("option",{value:"+971 4 269 1449",children:"Al Muraqqabat: +971 4 269 1449"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Brand Address"}),(0,s.jsxs)("select",{className:"border border-gray-300 rounded px-3 py-2 text-sm focus:ring-indigo-500",value:o.businessAddress,onChange:e=>m("businessAddress",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select address"}),(0,s.jsx)("option",{value:"Marina Jannah Hotel, Marina - Dubai Marina - Dubai - UAE",children:"Marina Jannah Hotel, Dubai Marina"}),(0,s.jsx)("option",{value:"IBN Battuta Mall - Sheikh Zayed Rd - Dubai - UAE",children:"IBN Battuta Mall, Dubai"}),(0,s.jsx)("option",{value:"Al Bustan Centre & Residence - Qusais - Dubai - UAE",children:"Al Bustan Centre, Dubai"}),(0,s.jsx)("option",{value:"New API Building - Barsha Heights - Dubai - UAE",children:"TECOM, Dubai"}),(0,s.jsx)("option",{value:"Dominos Pizza Building - Al Muraqqabat - Dubai - UAE",children:"Al Muraqqabat, Dubai"})]})]})]})]}),(0,s.jsxs)("div",{id:"invoice-content",className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-6",children:[(0,s.jsxs)("div",{children:[i?(0,s.jsx)("input",{value:o.title,onChange:e=>m("title",e.target.value),className:"text-2xl font-bold text-indigo-700 border-b border-gray-300 focus:outline-none"}):(0,s.jsx)("h2",{className:"text-2xl font-bold text-indigo-700",children:o.title}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Booking ID: ",a.id]})]}),(0,s.jsx)("div",{className:"text-right",children:["businessName","businessEmail","businessPhone","businessAddress"].map(e=>(0,s.jsx)("p",{className:"text-sm text-gray-500",children:i?(0,s.jsx)("input",{value:o[e],onChange:t=>m(e,t.target.value),className:"border-b border-gray-300 focus:outline-none text-right w-full"}):o[e]},e))})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-sm",children:["customerName","customerEmail","customerPhone","branch","bookingDate","bookingTime","staff"].map(e=>(0,s.jsx)("div",{children:(0,s.jsxs)("p",{children:[(0,s.jsxs)("strong",{children:[e.replace(/([A-Z])/g," $1"),": "]}),i?(0,s.jsx)("input",{value:o[e],onChange:t=>m(e,t.target.value),className:"border-b border-gray-300 focus:outline-none"}):o[e]]})},e))}),(0,s.jsxs)("div",{className:"mb-4 text-sm",children:[(0,s.jsx)("h4",{className:"font-semibold mb-2",children:"Payment Details:"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:o.paymentDetails.map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between border-b pb-1",children:[(0,s.jsxs)("span",{children:[e.method.toUpperCase(),":"]}),(0,s.jsxs)("span",{children:["AED ",e.amount.toFixed(2)]})]},t))})]}),(0,s.jsx)("div",{className:"border rounded-lg mb-4 overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-3 text-left",children:"Service"}),(0,s.jsx)("th",{className:"p-3 text-left",children:"Staff"}),(0,s.jsx)("th",{className:"p-3 text-center",children:"Qty"}),(0,s.jsx)("th",{className:"p-3 text-right",children:"Price"}),(0,s.jsx)("th",{className:"p-3 text-right",children:"Total"})]})}),(0,s.jsx)("tbody",{children:o.services.map((e,t)=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"p-3",children:i?(0,s.jsx)("input",{value:e.serviceName,onChange:e=>{let a=[...o.services];a[t].serviceName=e.target.value,m("services",a)},className:"border-b border-gray-300 focus:outline-none w-full"}):e.serviceName}),(0,s.jsx)("td",{className:"p-3",children:i?(0,s.jsx)("input",{value:e.staffMember||"",onChange:e=>{let a=[...o.services];a[t].staffMember=e.target.value,m("services",a)},className:"border-b border-gray-300 focus:outline-none w-full"}):e.staffMember||"N/A"}),(0,s.jsx)("td",{className:"p-3 text-center",children:i?(0,s.jsx)("input",{value:e.quantity,onChange:e=>{let a=[...o.services];a[t].quantity=e.target.value,m("services",a)},className:"border-b border-gray-300 focus:outline-none w-16 text-center"}):e.quantity}),(0,s.jsx)("td",{className:"p-3 text-right",children:i?(0,s.jsx)("input",{value:e.price,onChange:e=>{let a=[...o.services];a[t].price=e.target.value,m("services",a)},className:"border-b border-gray-300 focus:outline-none w-20 text-right"}):"AED ".concat(Number(e.price).toFixed(2))}),(0,s.jsxs)("td",{className:"p-3 text-right",children:["AED ",(Number(e.price)*Number(e.quantity)).toFixed(2)]})]},t))})]})}),(0,s.jsxs)("div",{className:"flex flex-col items-end gap-2 text-sm",children:[["totalPrice","tip","discount"].map(e=>(0,s.jsxs)("div",{className:"flex justify-between w-64",children:[(0,s.jsx)("span",{children:"totalPrice"===e?"Subtotal:":"tip"===e?"Tip:":"Discount:"}),(0,s.jsx)("span",{children:i?(0,s.jsx)("input",{value:o[e],onChange:t=>m(e,t.target.value),className:"border-b border-gray-300 focus:outline-none text-right w-20"}):"AED ".concat(Number(o[e]||0).toFixed(2))})]},e)),(0,s.jsxs)("div",{className:"flex justify-between w-64 border-t pt-2 font-bold",children:[(0,s.jsx)("span",{children:"Grand Total:"}),(0,s.jsxs)("span",{children:["AED ",h.toFixed(2)]})]})]}),(0,s.jsx)("div",{className:"mt-6 text-center text-sm text-gray-500",children:i?(0,s.jsx)("textarea",{value:o.footerText,onChange:e=>m("footerText",e.target.value),className:"border border-gray-300 rounded p-2 w-full focus:outline-none"}):o.footerText})]}),(0,s.jsxs)("div",{className:"p-4 border-t flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:l,className:"px-4 py-2 bg-gray-100 rounded-md",children:"Close"}),d&&(0,s.jsx)("button",{onClick:()=>n(!i),className:"px-4 py-2 bg-indigo-500 text-white rounded-md",children:i?"Save Changes":"Edit Invoice"}),(0,s.jsx)("button",{onClick:x,className:"px-4 py-2 bg-pink-600 text-white rounded-md",children:"Download PDF"})]})]})})}),es=["AI Bustaan","Marina","TECOM","AL Muraqabat","IBN Batutta Mall"],er=Object.fromEntries(Array.from(new Set((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1440,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,s=[];for(let r=e;r<=t;r+=a){let e=Math.floor(r/60).toString().padStart(2,"0"),t=(r%60).toString().padStart(2,"0");s.push("".concat(e,":").concat(t))}return s})().map(e=>e.split(":")[0]))).sort((e,t)=>Number(e)-Number(t)).map(e=>[e,!0])),el={serviceId:"",serviceName:"",category:"",duration:30,price:0,quantity:1},ei=(0,r.memo)(function(){let{bookings:e,loading:t,saveBooking:a,deleteBooking:n}=function(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=(0,ee.P)((0,ee.rJ)(et.db,"bookings"),(0,ee.My)("createdAt","desc")),a=(0,ee.aQ)(e,e=>{t(e.docs.map(e=>{var t,a,s,r,l,i,n;let o,c=e.data();return o=(null==(t=c.bookingDate)?void 0:t.toDate)?c.bookingDate.toDate():"string"==typeof c.bookingDate?new Date(c.bookingDate):(null==(a=c.bookingDate)?void 0:a.seconds)?new Date(1e3*c.bookingDate.seconds):new Date,{id:e.id,userId:c.userId||"",customerName:c.customerName||"",services:c.services||[],bookingDate:o,bookingTime:c.bookingTime||"",branch:c.branch||"",staff:(null==(s=c.staff)?void 0:s.trim())||(null==(r=c.staffName)?void 0:r.trim())||"Unassigned",totalPrice:c.totalPrice||0,totalDuration:c.totalDuration||0,status:c.status||"upcoming",paymentMethod:c.paymentMethod||"cash",emailConfirmation:c.emailConfirmation||!1,smsConfirmation:c.smsConfirmation||!1,createdAt:(null==(l=c.createdAt)?void 0:l.toDate)?c.createdAt.toDate():new Date,updatedAt:(null==(i=c.updatedAt)?void 0:i.toDate)?c.updatedAt.toDate():new Date,remarks:null!=(n=c.remarks)?n:null,customerEmail:c.customerEmail||"",tipAmount:c.tipAmount||0,discount:c.discount||0}})),s(!1)});return()=>a()},[]);let l=(0,r.useCallback)(async(a,s)=>{try{t(e=>e.map(e=>e.id===a?{...e,status:s}:e));let e=(0,ee.H9)(et.db,"bookings",a);await (0,ee.mZ)(e,{status:s,updatedAt:(0,ee.O5)()})}catch(s){throw console.error("Error updating booking status:",s),t(t=>t.map(t=>{var s;return t.id===a?{...t,status:(null==(s=e.find(e=>e.id===a))?void 0:s.status)||"upcoming"}:t})),s}},[e]);return{bookings:e,loading:a,updateBookingStatus:l,saveBooking:(0,r.useCallback)(async(e,t)=>{let a={...e,bookingDate:ee.Dc.fromDate(e.bookingDate),updatedAt:(0,ee.O5)()};if(t){let e=(0,ee.H9)(et.db,"bookings",t);await (0,ee.mZ)(e,a)}else await (0,ee.gS)((0,ee.rJ)(et.db,"bookings"),{...a,createdAt:(0,ee.O5)()})},[]),deleteBooking:(0,r.useCallback)(async e=>{await (0,ee.kd)((0,ee.H9)(et.db,"bookings",e))},[])}}(),{staff:o,branches:c,services:d,paymentMethods:m,loading:u}=function(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)([]),[l,i]=(0,r.useState)([]),[n,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(async()=>{try{let[e,a,r,l]=await Promise.all([(0,ee.GG)((0,ee.rJ)(et.db,"staff")),(0,ee.GG)((0,ee.rJ)(et.db,"branches")),(0,ee.GG)((0,ee.rJ)(et.db,"services")),(0,ee.GG)((0,ee.rJ)(et.db,"paymentMethods"))]),n=Array.from(new Set(e.docs.map(e=>String(e.data().name||e.data().staffName||"")).filter(e=>""!==e.trim()))),c=Array.from(new Set(a.docs.map(e=>String(e.data().name||"")).filter(e=>""!==e.trim())));t(n),s(c),i(r.docs.map(e=>({id:e.id,...e.data()}))),o(l.docs.map(e=>({id:e.id,...e.data()}))),console.log("Loaded resources:",{staff:n,branches:c,services:r.docs.length,paymentMethods:l.docs.length})}catch(e){console.error("Error loading resources:",e),t(["Komal","Shameem","Do Thi Kim","Alishba"]),s(["AI Bustaan","Marina","TECOM","AL Muraqabat","IBN Batutta Mall"])}finally{d(!1)}})()},[]),{staff:e,branches:a,services:l,paymentMethods:n,loading:c}}(),[x,h]=(0,r.useState)(""),[g,b]=(0,r.useState)("all"),[p,v]=(0,r.useState)({branch:"",staff:"",date:"",customer:"",time:""}),[y,j]=(0,r.useState)(!1),[N,w]=(0,r.useState)(!1),[k,C]=(0,r.useState)(null),[M,S]=(0,r.useState)(null),[A,E]=(0,r.useState)(null),[P,T]=(0,r.useState)(()=>(0,D.GP)(new Date,"yyyy-MM-dd")),[B,I]=(0,r.useState)("all"),[O,q]=(0,r.useState)(er),[F,G]=(0,r.useState)(!0),[L,z]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(!t&&!u){let e=setTimeout(()=>{G(!1)},500);return()=>clearTimeout(e)}},[t,u]),(0,r.useEffect)(()=>{if(F){let e=setInterval(()=>{z(e=>e>=90?90:e+10)},200);return()=>clearInterval(e)}{z(100);let e=setTimeout(()=>z(0),500);return()=>clearTimeout(e)}},[F]);let H=(0,r.useMemo)(()=>{if(!e.length)return[];let t=x.toLowerCase(),a=x.length>0,s=Object.values(p).some(Boolean),r="all"===g;if(!a&&!s&&r)return e;let l=p.branch,i=p.staff,n=p.date,o=p.customer.toLowerCase(),c=p.time;return e.filter(e=>{if(!r&&e.status!==g||l&&e.branch!==l||i&&e.staff!==i||n&&(0,D.GP)(e.bookingDate,"yyyy-MM-dd")!==n||o&&!e.customerName.toLowerCase().includes(o)||c&&e.bookingTime!==c)return!1;if(a){let a=e.customerName.toLowerCase(),s=e.branch.toLowerCase();return a.includes(t)||s.includes(t)||e.services.some(e=>e.serviceName.toLowerCase().includes(t))}return!0})},[e,x,g,p]);(0,r.useMemo)(()=>{if(!e.length)return[];let t=new Set;for(let a=0;a<e.length;a++){let s=e[a].bookingTime;s&&t.add(s)}return Array.from(t).sort()},[e]),(0,r.useMemo)(()=>c.length?c:es,[c]);let R=(0,r.useMemo)(()=>o,[o]),J=(0,r.useMemo)(()=>d,[d]),_=(0,r.useMemo)(()=>m,[m]);(0,r.useCallback)(()=>{C(null),E(null),j(!0)},[]);let W=(0,r.useCallback)((e,t)=>{O[t.split(":")[0]]&&(C(null),E({branch:es[0],serviceDate:P,serviceTime:t,customerName:"",customerEmail:"",paymentMethod:"cash",paymentDetails:[{method:"cash",amount:0}],customPaymentMethod:"",emailConfirmation:!1,smsConfirmation:!1,status:"upcoming",staff:e,services:[el],remarks:"",tip:0,discount:0}),j(!0))},[O,P]),Q=(0,r.useCallback)(e=>{C(e.id),E({branch:e.branch||es[0],serviceDate:(0,D.GP)(e.bookingDate,"yyyy-MM-dd"),serviceTime:e.bookingTime||"10:00",customerName:e.customerName||"",customerEmail:e.customerEmail||"",paymentMethod:e.paymentMethod||"cash",paymentDetails:e.paymentDetails||[{method:e.paymentMethod||"cash",amount:e.totalPrice||0}],customPaymentMethod:"",emailConfirmation:!!e.emailConfirmation,smsConfirmation:!!e.smsConfirmation,status:e.status||"upcoming",staff:e.staff||"",services:e.services&&e.services.length>0?e.services.map(e=>({serviceId:e.serviceId||"",serviceName:e.serviceName||"",category:e.category||"",duration:Number(e.duration)||0,price:Number(e.price)||0,quantity:Number(e.quantity)||1,staffMember:e.staffMember||""})):[{...el,staffMember:""}],remarks:e.remarks||"",tip:e.tipAmount||0,discount:e.discount||0}),j(!0)},[]),Z=(0,r.useCallback)(e=>{S(e),w(!0)},[]),K=(0,r.useCallback)(async(e,t)=>{let s=0,r=0,l=e.services.map(e=>{let t=Number(e.price)||0,a=Number(e.duration)||0,l=Number(e.quantity)||0;return s+=t*l,r+=a*l,{...e,price:t,duration:a,quantity:l}}),i={userId:(0,Y.A)(),customerName:e.customerName.trim(),services:l,bookingDate:new Date(e.serviceDate+"T00:00:00"),bookingTime:e.serviceTime,branch:e.branch,customerEmail:e.customerEmail.trim(),staff:e.staff||null,totalPrice:s,totalDuration:r,status:e.status,paymentMethod:"custom"===e.paymentMethod?e.customPaymentMethod:e.paymentMethod,emailConfirmation:e.emailConfirmation,smsConfirmation:e.smsConfirmation,remarks:e.remarks||null,tipAmount:Number(e.tip)||0,discount:Number(e.discount)||0};await a(i,t)},[a]),V=(0,r.useCallback)(async e=>{await n(e)},[n]),X=(0,r.useCallback)(()=>j(!1),[]),ei=(0,r.useCallback)(()=>w(!1),[]);return F?(0,s.jsx)("div",{className:"fixed inset-0 bg-white dark:bg-gray-900 z-50 flex flex-col items-center justify-center",children:(0,s.jsxs)("div",{className:"w-64 max-w-full mx-auto",children:[(0,s.jsx)("div",{className:"flex justify-center mb-6",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-pink-600"})}),(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-2",children:"Loading Bookings"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Preparing your schedule..."})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-4",children:(0,s.jsx)("div",{className:"bg-pink-600 h-2 rounded-full transition-all duration-300 ease-out",style:{width:"".concat(L,"%")}})}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[L,"%"]})})]})}):(0,s.jsx)(l.A,{children:(0,s.jsx)(i,{children:(0,s.jsxs)("div",{className:"w-full px-4 sm:px-6 lg:px-8 dark:text-white",children:[(0,s.jsx)(f,{bookings:H,enabledHours:O,onHoursChange:q}),(0,s.jsx)(U,{bookings:H,staffOptions:R,scheduleDate:P,scheduleBranch:B,enabledHours:O,onCellClick:W,onEditBooking:Q,onGenerateInvoice:Z}),0===H.length&&(0,s.jsxs)("div",{className:"text-center py-12 w-full",children:[(0,s.jsx)("div",{className:"mx-auto h-12 w-12 text-gray-400",children:"\uD83D\uDCC5"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No bookings found"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:x||"all"!==g?"Try adjusting your search or filter criteria.":"No bookings have been made yet."})]}),(0,s.jsx)($,{isOpen:y,isEditing:!!k,editingId:k,bookingData:A,staffOptions:R,serviceOptions:J,paymentMethods:_,enabledHours:O,onSave:K,onDelete:V,onClose:X,onGenerateInvoice:Z}),(0,s.jsx)(ea,{isOpen:N,invoiceData:M,onClose:ei})]})})})})},55838:(e,t,a)=>{Promise.resolve().then(a.bind(a,40954))}},e=>{e.O(0,[9135,7210,3930,5033,1748,9836,6373,4341,9323,8441,5964,7358],()=>e(e.s=55838)),_N_E=e.O()}]);