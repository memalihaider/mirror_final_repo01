(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8407],{931:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(95155),r=a(12115),l=a(40283),i=a(35695);function n(e){let{children:t}=e,{userRole:a,loading:n}=(0,l.A)(),o=(0,i.usePathname)(),c=(0,i.useRouter)(),[d,m]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{if(!n&&a){let e=o.split("/")[1]||"dashboard",t=a.accessPages||[];"admin"===a.role||t.includes(e)?m(!0):(m(!1),c.replace("/access-denied"))}},[n,a,o,c]),n||!a)?(0,s.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600"}),(0,s.jsx)("span",{className:"ml-3 text-pink-600",children:"Checking access..."})]}):d?(0,s.jsx)(s.Fragment,{children:t}):null}},10754:(e,t,a)=>{Promise.resolve().then(a.bind(a,75307))},40283:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,O:()=>c});var s=a(95155),r=a(12115),l=a(79323),i=a(56104);let n=(0,r.createContext)({user:null,userRole:null,loading:!0,isAdmin:!1,error:null,accessiblePages:[],canAccessPage:()=>!1}),o=()=>(0,r.useContext)(n),c=e=>{let{children:t}=e,[a,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[m,u]=(0,r.useState)(!0),[h,x]=(0,r.useState)(null),[b,g]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e,t=!0;return(async()=>{try{u(!0),await (0,i.AU)(),e=(0,l.Bh)(async e=>{if(t){if(o(e),x(null),e)try{let a=await (0,l.uG)(e.uid);if(!a&&e.email){let t="ahmadxeikh786@gmail.com"===e.email?"admin":"user";await (0,l.yS)(e.uid,e.email,t,e.displayName||void 0,[]),a=await (0,l.uG)(e.uid)}(null==a?void 0:a.role)!=="admin"&&"ahmadxeikh786@gmail.com"===e.email&&(await (0,l.yS)(e.uid,e.email,"admin",e.displayName||void 0,[]),a=await (0,l.uG)(e.uid)),t&&(d(a),g((null==a?void 0:a.accessPages)||[]))}catch(e){console.error("Error getting user role:",e),t&&x("Failed to load user role")}else t&&(d(null),g([]));t&&u(!1)}})}catch(e){console.error("Firebase initialization error:",e),t&&(x("Failed to initialize authentication"),u(!1))}})(),()=>{t=!1,e&&e()}},[]);let p=(null==c?void 0:c.role)==="admin";return(0,s.jsx)(n.Provider,{value:{user:a,userRole:c,loading:m,isAdmin:p,error:h,accessiblePages:b,canAccessPage:e=>!!c&&("admin"===c.role||b.includes(e))},children:t})}},75307:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eh});var s=a(95155),r=a(12115),l=a(931);function i(e){let{children:t}=e,[a,l]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{l(!0)},[]),a)?(0,s.jsx)(s.Fragment,{children:t}):null}var n=a(40646),o=a(69074),c=a(85339),d=a(54861),m=a(14186);let u=(()=>{let e=new Map;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1440,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r="".concat(t,"-").concat(a,"-").concat(s);if(e.has(r))return e.get(r);let l=[];for(let e=t;e<=a;e+=s){let t=Math.floor(e/60).toString().padStart(2,"0"),a=(e%60).toString().padStart(2,"0");l.push("".concat(t,":").concat(a))}return e.set(r,l),l}})(),h=(()=>{let e=new Map;return t=>{if(e.has(t))return e.get(t);let[a,s]=t.split(":"),r=Number(a),l=r>=12?"PM":"AM";0===r&&(r=12),r>12&&(r-=12);let i="".concat(r,":").concat(s," ").concat(l);return e.set(t,i),i}})(),x=Array.from(new Set(u().map(e=>e.split(":")[0]))).sort((e,t)=>Number(e)-Number(t));x.length;let b={blue:{gradient:"from-blue-500 to-cyan-600",text:"text-blue-600",bg:"bg-blue-50",border:"border-blue-200"},green:{gradient:"from-green-500 to-emerald-600",text:"text-green-600",bg:"bg-green-50",border:"border-green-200"},amber:{gradient:"from-amber-500 to-yellow-600",text:"text-amber-600",bg:"bg-amber-50",border:"border-amber-200"},red:{gradient:"from-red-500 to-rose-600",text:"text-red-600",bg:"bg-red-50",border:"border-red-200"}},g=(0,r.memo)(e=>{let{title:t,value:a,icon:r,color:l}=e,i=b[l];return(0,s.jsx)("div",{className:"group relative overflow-hidden rounded-lg ".concat(i.bg," border ").concat(i.border," p-3 transition-all duration-200 hover:shadow-md"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"p-1.5 bg-gradient-to-r ".concat(i.gradient," rounded-lg shadow-sm"),children:(0,s.jsx)(r,{className:"w-3 h-3 text-white"})}),(0,s.jsx)("span",{className:"text-xs font-medium ".concat(i.text),children:t})]}),(0,s.jsx)("div",{className:"text-lg font-bold ".concat(i.text),children:a})]})})});g.displayName="CompactStatCard";let p=(0,r.memo)(e=>{let{hour:t,enabled:a,onChange:l}=e,i=(0,r.useCallback)(e=>{l(e.target.checked)},[l]),o=Number(t)>12?Number(t)-12:0===Number(t)?12:Number(t);return(0,s.jsxs)("label",{className:"relative cursor-pointer group",title:h("".concat(t,":00")),children:[(0,s.jsx)("input",{type:"checkbox",checked:a,onChange:i,className:"sr-only"}),(0,s.jsxs)("div",{className:"\n        relative p-1.5 rounded text-[10px] font-medium text-center transition-all duration-150\n        border backdrop-blur-sm min-w-[32px]\n        ".concat(a?"bg-gradient-to-br from-green-500 to-emerald-600 text-white shadow-sm border-green-500":"bg-white/80 text-gray-600 border-gray-300 group-hover:bg-white group-hover:border-gray-400","\n        group-hover:scale-105\n      "),children:[(0,s.jsx)("div",{className:"flex items-center justify-center",children:a?(0,s.jsx)(n.A,{className:"w-2.5 h-2.5"}):(0,s.jsx)("span",{className:"text-[10px] font-medium",children:o})}),(0,s.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[h("".concat(t,":00")),(0,s.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})]})]})});p.displayName="CompactHourToggle";let f=(0,r.memo)(function(e){let{bookings:t,enabledHours:a,onHoursChange:l}=e,i=(0,r.useMemo)(()=>{let e=t.length,a=0,s=0,r=0;for(let e=0;e<t.length;e++)switch(t[e].status){case"upcoming":a++;break;case"past":s++;break;case"cancelled":r++}return{total:e,upcoming:a,past:s,cancelled:r}},[t]),u=(0,r.useMemo)(()=>{let e=0,t=Object.values(a);for(let a=0;a<t.length;a++)t[a]&&e++;return e},[a]),h=x.length,[b,f]=(0,r.useState)(!1),v=(0,r.useCallback)(()=>f(e=>!e),[]),j=(0,r.useCallback)(e=>{let t={};for(let a=0;a<x.length;a++)t[x[a]]=e;l(t)},[l]),y=(0,r.useCallback)((e,t)=>{l({...a,[e]:t})},[a,l]);return(0,s.jsx)("div",{className:"w-full",children:(0,s.jsxs)("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-br from-indigo-50 via-white to-purple-50 border border-white/20 shadow-lg backdrop-blur-sm",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/3 via-purple-500/3 to-pink-500/3"}),(0,s.jsxs)("div",{className:"relative p-2 sm:p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg bg-gradient-to-r from-indigo-500 to-purple-600 shadow-md",children:(0,s.jsx)(o.A,{className:"w-4 h-4 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-gray-800",children:"Schedule Controls"}),(0,s.jsxs)("p",{className:"text-xs text-gray-600 hidden sm:block",children:[u,"/",h," hours enabled"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-sm font-bold text-indigo-600",children:i.total}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Total"})]}),(0,s.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-sm font-bold text-emerald-600",children:i.upcoming}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Active"})]}),(0,s.jsxs)("button",{onClick:v,className:"ml-2 inline-flex items-center gap-2 px-3 py-1.5 text-xs font-semibold rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 transition-colors","aria-expanded":b,"aria-controls":"schedule-controls-panel",children:[b?"Hide":"Show"," controls"]})]})]}),b&&(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4",id:"schedule-controls-panel",children:[(0,s.jsx)("div",{className:"lg:col-span-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-2 gap-3",children:[(0,s.jsx)(g,{title:"Total",value:i.total,icon:o.A,color:"blue"}),(0,s.jsx)(g,{title:"Upcoming",value:i.upcoming,icon:n.A,color:"green"}),(0,s.jsx)(g,{title:"Completed",value:i.past,icon:c.A,color:"amber"}),(0,s.jsx)(g,{title:"Cancelled",value:i.cancelled,icon:d.A,color:"red"})]})}),(0,s.jsx)("div",{className:"lg:col-span-8",children:(0,s.jsxs)("div",{className:"bg-white/50 rounded-lg p-4 border border-white/50",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.A,{className:"w-4 h-4 text-gray-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Business Hours"})]}),(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)("button",{onClick:()=>j(!0),className:"px-2 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"All"}),(0,s.jsx)("button",{onClick:()=>j(!1),className:"px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"None"})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 gap-1",children:x.map(e=>(0,s.jsx)(p,{hour:e,enabled:!!a[e],onChange:t=>y(e,t)},e))}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-600",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500"}),(0,s.jsx)("span",{children:"Enabled"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-300"}),(0,s.jsx)("span",{children:"Disabled"})]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[u,"/",h," enabled"]})]})]})})]})]})]})})});var v=a(81586),j=a(71007),y=a(84616),N=a(47924),w=a(54416),k=a(66932),C=a(3898),M=a(59836),D=a(40283);let S=(()=>{let e=[];for(let t=0;t<=1440;t+=15){let a=Math.floor(t/60).toString().padStart(2,"0"),s=(t%60).toString().padStart(2,"0");e.push("".concat(a,":").concat(s))}return e})(),A={timeConversions:new Map,bookingPositions:new Map,displayTimes:new Map,paymentMethods:new Map},T=e=>A.timeConversions.get(e)||(()=>{if(e.includes("AM")||e.includes("PM"))return A.timeConversions.set(e,e),e;let[t,a]=e.split(":"),s=Number(t),r=s>=12?"PM":"AM";0===s?s=12:s>12&&(s-=12);let l="".concat(s,":").concat(a," ").concat(r);return A.timeConversions.set(e,l),l})(),E=(e,t)=>{let a=e;if(e.includes("PM")||e.includes("AM")){let[t,s]=e.split(" "),[r,l]=t.split(":").map(Number);"PM"===s&&r<12&&(r+=12),"AM"===s&&12===r&&(r=0),a="".concat(r.toString().padStart(2,"0"),":").concat(l.toString().padStart(2,"0"))}let[s,r]=a.split(":").map(Number),l=60*s+r+t,i=Math.floor(l/60);return"".concat(i.toString().padStart(2,"0"),":").concat((l%60).toString().padStart(2,"0"))},P=(e,t)=>{let a="".concat(e,"-").concat(t);if(A.bookingPositions.has(a))return A.bookingPositions.get(a);let s=e;if(e.includes("PM")||e.includes("AM")){let[t,a]=e.split(" "),[r,l]=t.split(":").map(Number);"PM"===a&&r<12&&(r+=12),"AM"===a&&12===r&&(r=0),s="".concat(r.toString().padStart(2,"0"),":").concat(l.toString().padStart(2,"0"))}let[r,l]=s.split(":").map(Number),i=60*r+l,n=Math.max(1,Math.ceil(t/15)),o={startSlotIndex:Math.min(Math.floor((60*r+l)/15),S.length-1),durationInSlots:n,startMinutes:i,endMinutes:i+t,endTime:E(e,t),normalizedTime:s};return A.bookingPositions.set(a,o),o},B=(0,r.memo)(e=>{let{notifications:t,removeNotification:a}=e;return null});B.displayName="NotificationContainer";let I=(0,r.memo)(e=>{let{paymentMethods:t}=e,a=(0,r.useMemo)(()=>Array.isArray(t)?t:"string"==typeof t&&""!==t.trim()?t.includes(",")?t.split(",").map(e=>e.trim()).filter(e=>""!==e):[t.trim()]:["cash"],[t]),l=(0,r.useMemo)(()=>{let e={cash:{icon:"\uD83D\uDCB5",label:"Cash"},card:{icon:"\uD83D\uDCB3",label:"Card"},"credit card":{icon:"\uD83D\uDCB3",label:"Card"},upi:{icon:"\uD83D\uDCF1",label:"UPI"},wallet:{icon:"\uD83D\uDC5B",label:"Wallet"},netbanking:{icon:"\uD83C\uDFE6",label:"Net Banking"},cheque:{icon:"\uD83D\uDCC4",label:"Cheque"},paypal:{icon:"\uD83D\uDD35",label:"PayPal"}};return a.map(t=>e[t.toLowerCase().trim()]||{icon:"\uD83D\uDCB3",label:t})},[a]);return 0===a.length?(0,s.jsxs)("div",{className:"flex items-center text-[11px] font-semibold opacity-95 min-w-0",children:[(0,s.jsx)(v.A,{className:"w-3 h-3 mr-1.5 flex-shrink-0 text-gray-400"}),(0,s.jsx)("span",{className:"text-gray-500 italic",children:"No payment"})]}):1===a.length?(0,s.jsxs)("div",{className:"flex items-center text-[11px] font-semibold opacity-95 min-w-0",children:[(0,s.jsx)(v.A,{className:"w-3 h-3 mr-1.5 flex-shrink-0"}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:l[0].icon}),(0,s.jsx)("span",{children:l[0].label})]})]}):(0,s.jsxs)("div",{className:"flex items-center text-[11px] font-semibold opacity-95 min-w-0 group relative",children:[(0,s.jsx)(v.A,{className:"w-3 h-3 mr-1.5 flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:l[0].icon}),(0,s.jsx)("span",{children:l[0].label})]}),(0,s.jsxs)("span",{className:"bg-blue-100 text-blue-700 px-1 text-[10px] font-bold border border-blue-200 ml-1",children:["+",a.length-1]})]})]})});I.displayName="PaymentMethodsDisplay";let q=(0,r.memo)(e=>{let{booking:t,onEdit:a,onGenerateInvoice:l,isAdmin:i,showTime:n=!0,slotDuration:o=1}=e,c=(0,r.useCallback)(e=>{e.stopPropagation(),l(t)},[t,l]),d=(0,r.useCallback)(e=>{e.target.closest(".invoice-button")||a(t)},[t,a]),{serviceNames:u,statusStyle:h,displayTime:x,endTimeDisplay:b,cardHeight:g}=(0,r.useMemo)(()=>{var e;return{serviceNames:(null==(e=t.services)?void 0:e.map(e=>e.serviceName).join(", "))||"No services",statusStyle:(e=>{let t={upcoming:{background:"bg-gradient-to-r from-blue-500 to-blue-600",border:"border-2 border-blue-400 shadow-md",text:"text-white",header:"bg-blue-600/20"},past:{background:"bg-gradient-to-r from-green-500 to-green-600",border:"border-2 border-green-400 shadow-md",text:"text-white",header:"bg-green-600/20"},cancelled:{background:"bg-gradient-to-r from-red-500 to-red-600",border:"border-2 border-red-400 shadow-md",text:"text-white",header:"bg-red-600/20"}};return t[e]||t.upcoming})(t.status),displayTime:A.displayTimes.get(t.bookingTime)||T(t.bookingTime),endTimeDisplay:T(E(t.bookingTime,t.totalDuration||30)),cardHeight:60*o-8}},[t,o]);return(0,s.jsxs)("div",{onClick:d,className:"w-full ".concat(h.background," ").concat(h.border," ").concat(h.text," cursor-pointer overflow-hidden absolute top-1 left-1 right-1 bottom-1"),style:{height:"".concat(g,"px"),minHeight:"52px"},title:t.customerName,children:[(0,s.jsxs)("div",{className:"".concat(h.header," border-b border-white/20 px-2 py-1 flex justify-between items-center"),children:[(0,s.jsx)("div",{className:"flex-1 min-w-0 pr-2",children:(0,s.jsx)("div",{className:"font-extrabold text-sm truncate",children:t.customerName})}),(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0 min-w-0",children:["past"===t.status&&(0,s.jsx)("button",{onClick:c,className:"invoice-button text-[10px] px-2 py-1 bg-white text-gray-800 hover:bg-gray-100 border border-gray-300 hover:border-gray-400 whitespace-nowrap font-bold flex-shrink-0",children:"\uD83D\uDCB0 Invoice"}),n&&(0,s.jsx)("span",{className:"text-[10px] font-black bg-black bg-opacity-30 px-2 py-1 whitespace-nowrap tracking-tight flex-shrink-0",children:x})]})]}),(0,s.jsxs)("div",{className:"p-2 h-full flex flex-col min-w-0",children:[(0,s.jsx)("div",{className:"mb-2 flex-shrink-0 min-w-0",children:(0,s.jsx)("div",{className:"text-xs font-semibold opacity-95 line-clamp-1",children:u})}),(0,s.jsxs)("div",{className:"flex-1 min-h-0 space-y-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center text-[11px] font-semibold opacity-95 min-w-0",children:[(0,s.jsx)(m.A,{className:"w-3 h-3 mr-1.5 flex-shrink-0"}),(0,s.jsxs)("span",{className:"truncate",children:[x," - ",b]})]}),(0,s.jsx)(I,{paymentMethods:t.paymentMethods||t.paymentMethod}),t.staff&&o>=2&&(0,s.jsxs)("div",{className:"flex items-center text-[11px] font-semibold opacity-95 min-w-0",children:[(0,s.jsx)(j.A,{className:"w-3 h-3 mr-1.5 flex-shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:t.staff})]})]}),(0,s.jsx)("div",{className:"absolute bottom-1 right-1",children:(0,s.jsxs)("div",{className:"text-[10px] font-bold bg-black bg-opacity-40 px-2 py-0.5 border border-white/20",children:[t.totalDuration||30,"m"]})})]})]})});q.displayName="BookingCard";let F=(0,r.memo)(e=>{let{staffName:t}=e;return(0,s.jsx)("div",{className:"sticky top-0 z-20 bg-gradient-to-r from-gray-100 to-gray-50 border-b-2 border-gray-300 px-4 py-3 font-extrabold text-gray-800 text-sm truncate",children:t})});F.displayName="StaffHeader";let O=(0,r.memo)(e=>{let{time:t}=e,a=(0,r.useMemo)(()=>T(t),[t]);return(0,s.jsx)("div",{className:"sticky left-0 z-10 bg-gray-100 border-r-2 border-gray-300 px-4 py-4 font-bold text-gray-800 h-[60px] flex items-center truncate",children:a})});O.displayName="TimeSlot";let G=(0,r.memo)(e=>{let{time:t,staff:a,isOccupied:l,hasPrimary:i,onCellClick:n,primaryBookings:o,getSlotDuration:c,onEditBooking:d,onGenerateInvoice:m,isAdmin:u}=e,h=(0,r.useCallback)(()=>{l||n(a,t)},[l,a,t,n]),x=(0,r.useCallback)(e=>{e.stopPropagation(),n(a,t)},[a,t,n]);return(0,s.jsx)("div",{className:"border-r border-gray-200 relative h-full ".concat(l?"":"hover:bg-gray-50 cursor-pointer"),onClick:h,children:(0,s.jsx)("div",{className:"p-1 h-full relative",children:l||i?o.map(e=>{let r=c(e);return(0,s.jsx)(q,{booking:e,onEdit:d,onGenerateInvoice:m,isAdmin:u,showTime:!0,slotDuration:r},"booking-".concat(e.id,"-").concat(t,"-").concat(a))}):(0,s.jsx)("button",{className:"flex items-center justify-center w-10 h-10 text-emerald-700 hover:text-emerald-900 hover:bg-emerald-100 border-2 border-dashed border-emerald-400 hover:border-emerald-500 z-10",onClick:x,title:"Add Booking",children:(0,s.jsx)(y.A,{className:"w-5 h-5 font-bold"})})})})},(e,t)=>e.staff===t.staff&&e.time===t.time&&e.isOccupied===t.isOccupied&&e.hasPrimary===t.hasPrimary&&e.primaryBookings===t.primaryBookings&&e.isAdmin===t.isAdmin);G.displayName="ScheduleCell";let L=(0,r.memo)(e=>{let{branches:t,staff:a,uniqueTimes:l,filters:i,onFiltersChange:n,searchTerm:o,onSearchChange:c}=e,[d,m]=(0,r.useState)(o);(0,r.useEffect)(()=>{let e=setTimeout(()=>{c(d)},150);return()=>clearTimeout(e)},[d,c]);let u=(0,r.useCallback)((e,t)=>{n({...i,[e]:t})},[i,n]),h=(0,r.useCallback)(()=>{n({branch:"",staff:"",date:"",customer:"",time:""}),m("")},[n]),x=d||Object.values(i).some(e=>""!==e);return(0,s.jsxs)("div",{className:"bg-white/80 p-4 border border-gray-200 mb-4",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-3 items-start lg:items-end",children:[(0,s.jsxs)("div",{className:"flex-1 w-full",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Search Bookings"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(N.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,s.jsx)("input",{type:"text",placeholder:"Search bookings...",value:d,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300"})]})]}),[{key:"branch",label:"Branch",options:t,width:"w-40"},{key:"staff",label:"Staff",options:a,width:"w-40"},{key:"time",label:"Time",options:l,width:"w-40"}].map(e=>{let{key:t,label:a,options:r,width:l}=e;return(0,s.jsxs)("div",{className:"w-full ".concat(l),children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:a}),(0,s.jsxs)("select",{value:i[t],onChange:e=>u(t,e.target.value),className:"w-full border border-gray-300 px-3 py-2",children:[(0,s.jsxs)("option",{value:"",children:["All ",a]}),"staff"===t&&(0,s.jsx)("option",{value:"Unassigned",children:"Unassigned"}),r.map(e=>(0,s.jsx)("option",{value:e,children:"time"===t?T(e):e},e))]})]},t)}),(0,s.jsxs)("div",{className:"w-full lg:w-40",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Date"}),(0,s.jsx)("input",{type:"date",value:i.date,onChange:e=>u("date",e.target.value),className:"w-full border border-gray-300 px-3 py-2"})]}),x&&(0,s.jsx)("div",{className:"w-full lg:w-auto",children:(0,s.jsxs)("button",{onClick:h,className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-700 bg-gray-100 hover:bg-gray-200",children:[(0,s.jsx)(w.A,{className:"w-4 h-4"}),"Clear"]})})]}),x&&(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-sm text-blue-600",children:[(0,s.jsx)(k.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Filters Active"})]})]})});L.displayName="FilterBar";let z=(0,r.memo)(function(e){let{bookings:t,staffOptions:a,scheduleDate:l,scheduleBranch:i,enabledHours:n,onCellClick:c,onEditBooking:d,onGenerateInvoice:m,filters:u={},searchTerm:h=""}=e,{isAdmin:x}=(0,D.A)(),[b,g]=(0,r.useState)({branch:"",staff:"",date:"",customer:"",time:""}),[p,f]=(0,r.useState)(""),[v,j]=(0,r.useState)([]),y=(0,r.useCallback)(e=>{j(t=>t.filter(t=>t.id!==e))},[]),N=Object.keys(u).length>0?u:b,w=h||p,k=(0,r.useMemo)(()=>S.filter(e=>!0===n[e.split(":")[0]]),[n]),A=(0,r.useMemo)(()=>{let e=new Set(a||[]);return e.add("Unassigned"),null==t||t.forEach(t=>{var a;(null==(a=t.staff)?void 0:a.trim())&&e.add(t.staff)}),Array.from(e)},[a,t]),[T,E]=(0,r.useMemo)(()=>{let e=new Set,a=new Set;return null==t||t.forEach(t=>{t.branch&&e.add(t.branch),t.bookingTime&&a.add(t.bookingTime)}),[Array.from(e).sort(),Array.from(a).sort()]},[t]),I=(0,r.useMemo)(()=>(null==t?void 0:t.length)?t.filter(e=>{if(l){let t=new Date(e.bookingDate),a=new Date(l);if(!(0,C.r)(t,a))return!1}if(i&&"all"!==i&&e.branch!==i)return!1;if(w.length>0){var t,a,s;let r=w.toLowerCase();if(!((null==(t=e.customerName)?void 0:t.toLowerCase().includes(r))||(null==(a=e.branch)?void 0:a.toLowerCase().includes(r))||(null==(s=e.services)?void 0:s.some(e=>{var t;return null==(t=e.serviceName)?void 0:t.toLowerCase().includes(r)}))||e.staff&&e.staff.toLowerCase().includes(r)))return!1}if(N.branch&&e.branch!==N.branch)return!1;if(N.staff){if("Unassigned"===N.staff){if(e.staff&&e.staff.trim()&&"—"!==e.staff)return!1}else if(e.staff!==N.staff)return!1}return(!N.date||(0,M.GP)(new Date(e.bookingDate),"yyyy-MM-dd")===N.date)&&(!N.time||e.bookingTime===N.time)}):[],[t,l,i,w,N]),q=(0,r.useMemo)(()=>{let e={};return k.forEach(t=>{e[t]={},A.forEach(a=>{e[t][a]=[]})}),I.forEach(t=>{let a=P(t.bookingTime,t.totalDuration||30),s=t.staff&&A.includes(t.staff)?t.staff:"Unassigned";for(let l=0;l<a.durationInSlots;l++){let i=a.startSlotIndex+l;if(i<S.length){var r;let a=S[i];(null==(r=e[a])?void 0:r[s])&&!e[a][s].some(e=>e.id===t.id)&&e[a][s].push(t)}}}),e},[I,k,A]),z=(0,r.useMemo)(()=>({isPrimarySlot:(e,t)=>S[P(e.bookingTime,e.totalDuration||30).startSlotIndex]===t,getSlotDuration:e=>P(e.bookingTime,e.totalDuration||30).durationInSlots,isCellOccupied:(e,t)=>{var a;return((null==(a=q[e])?void 0:a[t])||[]).length>0},hasPrimaryBookings:(e,t)=>{var a;return((null==(a=q[e])?void 0:a[t])||[]).some(t=>S[P(t.bookingTime,t.totalDuration||30).startSlotIndex]===e)}}),[q]),R=(0,r.useCallback)((e,t)=>{c(e,t)},[c]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B,{notifications:v,removeNotification:y}),(0,s.jsxs)("div",{className:"relative overflow-hidden bg-slate-50 border-2 border-gray-300 mb-0",children:[(0,s.jsx)("div",{className:"relative p-6 border-b-2 border-gray-300 bg-gradient-to-r from-gray-50 to-white",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 bg-gradient-to-r from-indigo-500 to-purple-600 border-2 border-indigo-400",children:(0,s.jsx)(o.A,{className:"w-5 h-5 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-extrabold text-gray-800 tracking-wide",children:"Schedule Board"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[I.length," bookings • ",k.length," time slots • ",A.length," staff"]})]})]})}),(0,s.jsx)("div",{className:"px-6 py-4",children:(0,s.jsx)(L,{branches:T,staff:A,uniqueTimes:E,filters:N,onFiltersChange:g,searchTerm:w,onSearchChange:f})}),(0,s.jsxs)("div",{className:"relative overflow-x-auto w-full",children:[(0,s.jsxs)("div",{className:"grid sticky top-0 z-30 bg-white border-b-2 border-gray-300",style:{gridTemplateColumns:"180px repeat(".concat(A.length,", 200px)")},children:[(0,s.jsx)("div",{className:"sticky left-0 z-40 bg-white border-r-2 border-gray-300 px-4 py-3 font-extrabold text-gray-800 h-[60px] flex items-center",children:"Time"}),A.map(e=>(0,s.jsx)(F,{staffName:e},e))]}),k.map(e=>(0,s.jsxs)("div",{className:"grid border-b border-gray-200",style:{gridTemplateColumns:"180px repeat(".concat(A.length,", 200px)"),height:"60px"},children:[(0,s.jsx)(O,{time:e}),A.map(t=>{var a;let r=((null==(a=q[e])?void 0:a[t])||[]).filter(t=>z.isPrimarySlot(t,e));return(0,s.jsx)(G,{time:e,staff:t,isOccupied:z.isCellOccupied(e,t),hasPrimary:z.hasPrimaryBookings(e,t),onCellClick:R,primaryBookings:r,getSlotDuration:z.getSlotDuration,onEditBooking:d,onGenerateInvoice:m,isAdmin:x},"".concat(e,"-").concat(t))})]},e))]})]})]})});var R=a(62525);(0,r.memo)(e=>{let{service:t,index:a,serviceOptions:l,selectedCategory:i,staffOptions:n,onChange:o,onRemove:c,showRemove:d}=e,m=(0,r.useCallback)((e,t)=>{o(a,e,t)},[a,o]),u=(0,r.useCallback)(()=>{c(a)},[a,c]),h=(0,r.useMemo)(()=>l.filter(e=>!i||e.category===i),[l,i]),x=(0,r.useMemo)(()=>n,[n]);return(0,s.jsxs)("div",{className:$,style:{gridTemplateColumns:"3fr 2fr 2fr 2fr 1fr 2fr 1fr"},children:[(0,s.jsx)("div",{children:(0,s.jsxs)("select",{className:Q,value:t.serviceName,onChange:e=>m("serviceName",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Service"}),h.map(e=>(0,s.jsx)("option",{value:e.name,children:e.name},e.id))]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("select",{className:Q,value:t.staffMember||"",onChange:e=>m("staffMember",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Staff"}),x.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"number",min:0,className:_,placeholder:"Duration",value:t.duration,onChange:e=>m("duration",Number(e.target.value||0))})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"number",min:0,step:"0.01",className:_,placeholder:"Price",value:t.price,onChange:e=>m("price",Number(e.target.value||0))})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"number",min:1,className:_,placeholder:"Qty",value:t.quantity,onChange:e=>m("quantity",Number(e.target.value||1))})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"number",min:0,step:"0.01",className:_,placeholder:"Tip",value:t.tip||0,onChange:e=>m("tip",e.target.value)})}),(0,s.jsx)("div",{className:"flex justify-center items-center",children:d&&(0,s.jsx)("button",{onClick:u,className:"p-1 text-red-500 hover:bg-red-50 rounded",title:"Remove",children:(0,s.jsx)(R.A,{className:"w-4 h-4"})})})]})}).displayName="ServiceRow";let U=(0,r.memo)(e=>{let{payment:t,index:a,paymentMethods:l,onChange:i,onRemove:n,showRemove:o}=e,c=(0,r.useCallback)((e,t)=>{i(a,e,t)},[a,i]),d=(0,r.useCallback)(()=>{n(a)},[a,n]);(0,r.useMemo)(()=>l.length>0?l:J,[l]);let m=(0,r.useMemo)(()=>{let e=t.method.toLowerCase();return e.includes("card")||e.includes("credit")||e.includes("debit")},[t.method]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:$,style:{gridTemplateColumns:"2fr 1.5fr 2fr 0.5fr"},children:[(0,s.jsx)("div",{children:(0,s.jsxs)("select",{className:Q,value:t.method,onChange:e=>c("method",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Method"}),l.length>0?l.map(e=>(0,s.jsx)("option",{value:e.name||e.method||e.title||"",children:(e.name||e.method||e.title||"").toUpperCase()},e.id)):J.map(e=>(0,s.jsx)("option",{value:e,children:e.toUpperCase()},e))]})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"text",className:_,placeholder:"Ref #",value:t.referenceNumber||"",onChange:e=>c("referenceNumber",e.target.value)})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"number",min:0,step:"0.01",className:_,placeholder:"Amount (AED)",value:t.amount,onChange:e=>c("amount",Number(e.target.value||0))})}),(0,s.jsx)("div",{className:"flex justify-center items-center",children:o&&(0,s.jsx)("button",{onClick:d,className:"p-1 text-red-500 hover:bg-red-50 rounded",title:"Remove",children:(0,s.jsx)(R.A,{className:"w-4 h-4"})})})]}),m&&(0,s.jsxs)("div",{className:$,style:{gridTemplateColumns:"1fr 1fr"},className:"bg-blue-50",children:[(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"text",className:_,placeholder:"Cardholder Name",value:t.cardholderName||"",onChange:e=>c("cardholderName",e.target.value)})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"text",className:_,placeholder:"Card # (XXXX-XXXX-XXXX-XXXX)",value:t.cardNumber||"",onChange:e=>{c("cardNumber",e.target.value.replace(/[^0-9-]/g,""))},maxLength:19})})]})]})});U.displayName="PaymentDetailRow";let H={serviceId:"",serviceName:"",category:"",duration:30,price:0,quantity:1,staffMember:"",tip:0},X=Object.freeze(["AI Bustaan","Marina","TECOM","AL Muraqabat","IBN Batutta Mall"]),J=Object.freeze(["cash","card","tabby","tamara","apple pay","google pay","samsung wallet","paypal","american express","ewallet STC pay","bank transfer","cash on delivery","other"]),_="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500 bg-white",Q="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500 bg-white cursor-pointer",W="block text-xs font-semibold text-gray-700 mb-1.5 uppercase tracking-tight",Z="border border-gray-200 rounded-lg overflow-hidden",K="grid gap-0 px-4 py-2.5 bg-gradient-to-r from-gray-100 to-gray-50 border-b border-gray-200 text-xs font-bold text-gray-700 uppercase tracking-wide",$="grid gap-0 px-4 py-2.5 border-b border-gray-100 hover:bg-gray-50 transition-colors",V=new Map,Y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1440,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,s="".concat(e,"-").concat(t,"-").concat(a);if(V.has(s))return V.get(s);let r=[];for(let s=e;s<=t;s+=a){let e=Math.floor(s/60).toString().padStart(2,"0"),t=(s%60).toString().padStart(2,"0");r.push("".concat(e,":").concat(t))}return V.set(s,r),r}(),ee=new Map,et=(0,r.memo)(function(e){let{isOpen:t,isEditing:a,editingId:l,bookingData:i,staffOptions:n,serviceOptions:o,paymentMethods:c,enabledHours:m,onSave:u,onDelete:h,onClose:x,onGenerateInvoice:b}=e,g=(0,r.useMemo)(()=>({...H}),[]),p=(0,r.useMemo)(()=>({branch:X[0],serviceDate:(0,M.GP)(new Date,"yyyy-MM-dd"),serviceTime:"10:00",customerName:"",customerEmail:"",trn:"",paymentMethod:"cash",paymentDetails:[{method:"cash",amount:0}],customPaymentMethod:"",emailConfirmation:!1,smsConfirmation:!1,status:"upcoming",staff:"",services:[g],remarks:"",tip:0,discount:0}),[g]),f=(0,r.useMemo)(()=>Y.filter(e=>!!m[e.split(":")[0]]),[m]),v=(0,r.useMemo)(()=>Array.from(new Set(o.map(e=>e.category))),[o]),[j,N]=(0,r.useState)(p),[w,k]=(0,r.useState)(""),[C,D]=(0,r.useState)(!1),[S,A]=(0,r.useState)(!1),T=(0,r.useMemo)(()=>({current:!0}),[]),E=(0,r.useMemo)(()=>(function(e){let t=e.reduce((e,t)=>e+(Number(t.price)||0)*(Number(t.quantity)||0),0);return{totalPrice:t,totalDuration:e.reduce((e,t)=>e+(Number(t.duration)||0)*(Number(t.quantity)||0),0),totalTip:e.reduce((e,t)=>e+(Number(t.tip)||0),0)}})(j.services),[j.services]),P=(0,r.useMemo)(()=>E.totalPrice+E.totalTip-(j.discount||0),[E.totalPrice,E.totalTip,j.discount]),B=(0,r.useMemo)(()=>j.paymentDetails.reduce((e,t)=>e+(t.amount||0),0),[j.paymentDetails]),I=(0,r.useMemo)(()=>Math.abs(B-P)>.01,[B,P]);(0,r.useEffect)(()=>{t&&i?N({...i,paymentDetails:i.paymentDetails||[{method:i.paymentMethod||"cash",amount:0}]}):t&&(N(p),k(""))},[t,i,p]);let q=(0,r.useCallback)((e,t,a)=>{N(s=>({...s,services:s.services.map((s,r)=>{if(r!==e)return s;if("serviceName"===t){let e=o.find(e=>e.name===a);if(e)return{...s,serviceName:a,duration:e.duration||0,price:e.price||0,category:e.category||s.category}}return"tip"===t?{...s,tip:Number(a)||0}:{...s,[t]:a}})}))},[o]),F=(0,r.useCallback)(()=>{N(e=>({...e,services:[...e.services,{...H}]}))},[]),O=(0,r.useCallback)(e=>{N(t=>({...t,services:t.services.filter((t,a)=>a!==e)}))},[]),G=(0,r.useCallback)((e,t)=>{N(a=>({...a,[e]:t}))},[]),L=(0,r.useCallback)((e,t,a)=>{N(s=>({...s,paymentDetails:s.paymentDetails.map((s,r)=>r!==e?s:{...s,[t]:a})}))},[]),z=(0,r.useCallback)(()=>{N(e=>({...e,paymentDetails:[...e.paymentDetails,{method:"",amount:0}]}))},[]),J=(0,r.useCallback)(e=>{N(t=>({...t,paymentDetails:t.paymentDetails.filter((t,a)=>a!==e)}))},[]),V=(0,r.useCallback)(()=>j.customerName.trim()?j.serviceDate?j.serviceTime?j.branch?j.staff?0===j.services.length?"Add at least one service":j.services.every(e=>e.serviceName.trim().length>0)?m[j.serviceTime.split(":")[0]]?0===j.paymentDetails.length?"Add at least one payment method":j.paymentDetails.every(e=>e.method.trim().length>0&&e.amount>0)?I?"Total payment amount (".concat(B.toFixed(2),") must equal the final total (").concat(P.toFixed(2),")"):null:"Each payment method must have a valid method and amount":"Selected time falls into a disabled hour":"Each service must have a name":"Staff is required":"Branch is required":"Service time is required":"Service date is required":"Customer name is required",[j,m,I,B,P]),et=(0,r.useCallback)(async()=>{let e=V();if(e)return void alert(e);try{T.current&&D(!0);let e={...j,paymentMethod:j.paymentDetails.map(e=>e.method).join(", ")};await u(e,l||void 0),T.current&&x()}catch(e){console.error("Error saving booking:",e),alert("Failed to save booking")}finally{T.current&&D(!1)}},[j,l,V,u,x,T]),ea=(0,r.useCallback)(async()=>{if(l&&confirm("Delete this booking? This action cannot be undone."))try{T.current&&A(!0),await h(l),T.current&&x()}catch(e){console.error("Error deleting booking:",e),alert("Failed to delete booking")}finally{T.current&&A(!1)}},[l,h,x,T]),es=(0,r.useCallback)(()=>{x()},[x]);return((0,r.useEffect)(()=>{if(t)return document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}},[t]),(0,r.useEffect)(()=>()=>{T.current=!1},[T]),t)?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex animate-fadeIn",children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 animate-fadeIn",onClick:es}),(0,s.jsxs)("div",{className:"relative w-full max-w-4xl h-full bg-white flex flex-col ml-auto z-50 animate-slideInRight shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-3 border-b border-gray-200 bg-gradient-to-r from-blue-600 to-blue-700 text-white flex-shrink-0",children:[(0,s.jsx)("h3",{className:"text-lg font-bold tracking-tight",children:a?"✍️ Edit Booking":"➕ New Booking"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[a&&(0,s.jsxs)("button",{onClick:ea,disabled:S,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-white bg-red-600 hover:bg-red-700 disabled:opacity-60 rounded text-sm font-semibold transition-colors",title:"Delete",children:[(0,s.jsx)(R.A,{className:"w-4 h-4"}),S?"Deleting...":"Delete"]}),(0,s.jsx)("button",{onClick:es,className:"text-white hover:bg-blue-800 p-1 rounded transition-colors",title:"Close",disabled:C||S,children:(0,s.jsx)(d.A,{className:"w-6 h-6"})})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-6 space-y-5",children:[(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-5 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"Branch"}),(0,s.jsx)("select",{className:Q,value:j.branch,onChange:e=>G("branch",e.target.value),children:X.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"TRN"}),(0,s.jsx)("input",{type:"text",className:_,placeholder:"Tax ID",value:j.trn||"",onChange:e=>G("trn",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"Email"}),(0,s.jsx)("input",{type:"email",className:_,placeholder:"customer@email.com",value:j.customerEmail,onChange:e=>G("customerEmail",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"Category"}),(0,s.jsxs)("select",{className:Q,value:w,onChange:e=>k(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"All"}),v.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"Staff"}),(0,s.jsxs)("select",{className:Q,value:j.staff,onChange:e=>G("staff",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select"}),n.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"Date"}),(0,s.jsx)("input",{type:"date",className:_,value:j.serviceDate,onChange:e=>G("serviceDate",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"Time"}),(0,s.jsx)("select",{className:Q,value:j.serviceTime,onChange:e=>G("serviceTime",e.target.value),children:f.map(e=>(0,s.jsx)("option",{value:e,children:function(e){if(ee.has(e))return ee.get(e);let[t,a]=e.split(":"),s=Number(t),r=s>=12?"PM":"AM";0===s&&(s=12),s>12&&(s-=12);let l="".concat(s,":").concat(a," ").concat(r);return ee.set(e,l),l}(e)},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"Customer Name"}),(0,s.jsx)("input",{type:"text",className:_,placeholder:"Full name",value:j.customerName,onChange:e=>G("customerName",e.target.value)})]})]}),(0,s.jsxs)("div",{className:Z,children:[(0,s.jsxs)("div",{className:K,style:{gridTemplateColumns:"3fr 2fr 2fr 2fr 1fr 2fr 1fr"},children:[(0,s.jsx)("div",{children:"Service"}),(0,s.jsx)("div",{children:"Staff"}),(0,s.jsx)("div",{children:"Duration"}),(0,s.jsx)("div",{children:"Price"}),(0,s.jsx)("div",{children:"Qty"}),(0,s.jsx)("div",{children:"Tip"}),(0,s.jsx)("div",{className:"text-center",children:"\xd7"})]}),j.services.map((e,t)=>(0,s.jsxs)("div",{className:$,style:{gridTemplateColumns:"3fr 2fr 2fr 2fr 1fr 2fr 1fr"},children:[(0,s.jsx)("div",{children:(0,s.jsxs)("select",{className:Q,value:e.serviceName,onChange:e=>q(t,"serviceName",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Service"}),o.filter(e=>!w||e.category===w).map(e=>(0,s.jsx)("option",{value:e.name,children:e.name},e.id))]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("select",{className:Q,value:e.staffMember||"",onChange:e=>q(t,"staffMember",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Staff"}),n.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"number",min:0,className:_,placeholder:"30",value:e.duration,onChange:e=>q(t,"duration",Number(e.target.value||0))})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"number",min:0,step:"0.01",className:_,placeholder:"0.00",value:e.price,onChange:e=>q(t,"price",Number(e.target.value||0))})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"number",min:1,className:_,placeholder:"1",value:e.quantity,onChange:e=>q(t,"quantity",Number(e.target.value||1))})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"number",min:0,step:"0.01",className:_,placeholder:"0",value:e.tip||0,onChange:e=>q(t,"tip",e.target.value)})}),(0,s.jsx)("div",{className:"flex justify-center items-center",children:j.services.length>1&&(0,s.jsx)("button",{onClick:()=>O(t),className:"p-1 text-red-500 hover:bg-red-50 rounded",title:"Remove",children:(0,s.jsx)(R.A,{className:"w-4 h-4"})})})]},t)),(0,s.jsxs)("div",{className:"px-4 py-3 bg-gray-50 grid gap-3",style:{gridTemplateColumns:"auto 1fr auto"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"Discount %"}),(0,s.jsx)("input",{type:"number",min:"0",max:"100",step:"0.1",className:_,placeholder:"0",value:j.discount||"",onChange:e=>G("discount",Number(e.target.value)||0)})]}),(0,s.jsx)("div",{className:"flex items-end justify-center py-1.5",children:(0,s.jsxs)("span",{className:"text-sm font-bold text-gray-800",children:["Total: AED ",P.toFixed(2)]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"Tip Total"}),(0,s.jsxs)("div",{className:"py-2 px-3 bg-white border border-gray-300 rounded text-sm font-semibold text-gray-700",children:["AED ",E.totalTip.toFixed(2)]})]})]})]}),(0,s.jsxs)("button",{onClick:F,className:"flex items-center gap-2 px-3 py-2 text-sm text-blue-600 hover:text-blue-700 font-semibold transition-colors\\",children:[(0,s.jsx)(y.A,{className:"w-4 h-4\\"}),"Add Service"]}),(0,s.jsxs)("div",{className:Z,children:[(0,s.jsxs)("div",{className:K,style:{gridTemplateColumns:"2fr 1.5fr 2fr 0.5fr"},children:[(0,s.jsx)("div",{children:"Method"}),(0,s.jsx)("div",{children:"Ref #"}),(0,s.jsx)("div",{children:"Amount"}),(0,s.jsx)("div",{className:"text-center",children:"\xd7"})]}),j.paymentDetails.map((e,t)=>(0,s.jsx)(U,{payment:e,index:t,paymentMethods:c,onChange:L,onRemove:J,showRemove:j.paymentDetails.length>1},t)),(0,s.jsxs)("div",{className:"px-4 py-2.5 bg-gray-50 border-t border-gray-200 grid gap-3",style:{gridTemplateColumns:"1fr 1fr"},children:[(0,s.jsxs)("div",{className:"text-xs font-bold text-gray-700",children:["Paid: ",(0,s.jsxs)("span",{className:"text-blue-600 font-semibold",children:["AED ",B.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"text-xs font-bold text-gray-700",children:["Expected: ",(0,s.jsxs)("span",{className:"text-blue-600 font-semibold",children:["AED ",P.toFixed(2)]})]}),I&&(0,s.jsx)("div",{className:"col-span-2 text-xs text-red-600 font-semibold",children:"⚠️ Mismatch"})]})]}),(0,s.jsxs)("button",{onClick:z,className:"flex items-center gap-2 px-3 py-2 text-sm text-green-600 hover:text-green-700 font-semibold transition-colors\\",children:[(0,s.jsx)(y.A,{className:"w-4 h-4\\"}),"Add Payment"]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:W,children:"Remarks"}),(0,s.jsx)("textarea",{className:"".concat(_," resize-none"),rows:3,placeholder:"Optional notes...",value:j.remarks,onChange:e=>G("remarks",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:W,children:"Status"}),(0,s.jsxs)("select",{className:Q,value:j.status,onChange:e=>G("status",e.target.value),children:[(0,s.jsx)("option",{value:"upcoming",children:"Upcoming"}),(0,s.jsx)("option",{value:"past",children:"Completed"}),(0,s.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]})]})]}),(0,s.jsxs)("div",{className:"px-6 py-3 border-t border-gray-200 bg-gradient-to-r from-gray-50 to-white flex justify-end gap-2 flex-shrink-0",children:[(0,s.jsx)("button",{onClick:es,className:"px-4 py-2 text-sm font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 rounded transition-colors",disabled:C||S,children:"Close"}),(0,s.jsx)("button",{onClick:et,className:"px-5 py-2 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 rounded transition-colors disabled:opacity-60",disabled:C||S,children:C?a?"Updating...":"Saving...":a?"Update":"Save"})]})]})]}):null});var ea=a(78064),es=a(26597),er=a(85055),el=a(35317),ei=a(56104);let en=(0,r.memo)(function(e){let{isOpen:t,invoiceData:a,onClose:l}=e,[i,n]=(0,r.useState)(!1),[o,c]=(0,r.useState)({title:"Invoice Receipt",businessName:"MirrorsBeautyLounge",businessEmail:"",businessPhone:"",businessAddress:"",customerName:"",customerEmail:"",customerPhone:"",branch:"",bookingDate:"",bookingTime:"",staff:"",paymentMethod:"",paymentDetails:[],services:[],totalPrice:0,tip:0,discount:0,footerText:"Thank you for your booking! We look forward to serving you."}),{isAdmin:d}=(0,D.A)(),m=(e,t)=>{c(a=>({...a,[e]:t}))};(0,r.useEffect)(()=>{a&&c({title:"Invoice Receipt",businessName:"MirrorsBeautyLounge",businessEmail:"",businessPhone:"",businessAddress:"",customerName:a.customerName||"",customerEmail:a.customerEmail||"",customerPhone:"",branch:a.branch||"",bookingDate:(0,M.GP)(a.bookingDate,"dd MMM yyyy"),bookingTime:a.bookingTime||"",staff:a.staff||"",paymentMethod:a.paymentMethod||"cash",paymentDetails:a.paymentDetails||[{method:a.paymentMethod||"cash",amount:a.totalPrice||0}],services:a.services||[],totalPrice:a.totalPrice||0,tip:a.tipAmount||0,discount:a.discount||0,footerText:"Thank you for your booking! We look forward to serving you."})},[a]);let u=async e=>{try{if(!ei.db)return void console.error("❌ Firebase not initialized");let t=e.userId||(0,er.A)();await (0,el.gS)((0,el.rJ)(ei.db,"invoices"),{...e,userId:t,bookingId:e.id,createdAt:new Date}),console.log("✅ Invoice saved to Firebase")}catch(e){console.error("❌ Error saving invoice:",e)}},h=async()=>{let e=document.getElementById("invoice-content");if(e)try{let t=await (0,ea.$E)(e,{cacheBust:!0}),s=new es.Ay({orientation:"p",unit:"mm",format:"a4"}),r=s.internal.pageSize.getWidth()-20,l=e.offsetHeight*r/e.offsetWidth;s.addImage(t,"PNG",10,10,r,l),s.save("invoice_".concat((null==a?void 0:a.id)||Date.now(),".pdf")),a&&await u(a)}catch(e){console.error("❌ Error generating PDF:",e),alert("Failed to generate PDF")}};if(!t||!a)return null;let x=(o.totalPrice||0)+(o.tip||0)-(o.discount||0);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-auto",children:[(0,s.jsxs)("div",{className:"p-4 border-b flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Invoice"}),(0,s.jsx)("button",{onClick:l,className:"text-gray-500 hover:text-gray-800",children:(0,s.jsx)(w.A,{className:"w-6 h-6"})})]}),(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 rounded mb-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Select Branch Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Brand Email"}),(0,s.jsxs)("select",{className:"border border-gray-300 rounded px-3 py-2 text-sm focus:ring-indigo-500",value:o.businessEmail,onChange:e=>m("businessEmail",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select email"}),(0,s.jsx)("option",{value:"branch@mirrosalon.ae",children:"branch@mirrosalon.ae"}),(0,s.jsx)("option",{value:"marina@mirrosalon.ae",children:"marina@mirrosalon.ae"}),(0,s.jsx)("option",{value:"ibnbattuta@mirrosalon.ae",children:"ibnbattuta@mirrosalon.ae"}),(0,s.jsx)("option",{value:"albustan@mirrosalon.ae",children:"albustan@mirrosalon.ae"}),(0,s.jsx)("option",{value:"tecom@mirrosalon.ae",children:"tecom@mirrosalon.ae"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Brand Phone"}),(0,s.jsxs)("select",{className:"border border-gray-300 rounded px-3 py-2 text-sm focus:ring-indigo-500",value:o.businessPhone,onChange:e=>m("businessPhone",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select number"}),(0,s.jsx)("option",{value:"+971 56 300 5629",children:"Marina: +971 56 300 5629"}),(0,s.jsx)("option",{value:"+971 54 321 0758",children:"IBN Battuta: +971 54 321 0758"}),(0,s.jsx)("option",{value:"+971 50 545 8263",children:"Al Bustan: +971 50 545 8263"}),(0,s.jsx)("option",{value:"+971 4 568 6219",children:"TECOM: +971 4 568 6219"}),(0,s.jsx)("option",{value:"+971 4 269 1449",children:"Al Muraqqabat: +971 4 269 1449"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Brand Address"}),(0,s.jsxs)("select",{className:"border border-gray-300 rounded px-3 py-2 text-sm focus:ring-indigo-500",value:o.businessAddress,onChange:e=>m("businessAddress",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select address"}),(0,s.jsx)("option",{value:"Marina Jannah Hotel, Marina - Dubai Marina - Dubai - UAE",children:"Marina Jannah Hotel, Dubai Marina"}),(0,s.jsx)("option",{value:"IBN Battuta Mall - Sheikh Zayed Rd - Dubai - UAE",children:"IBN Battuta Mall, Dubai"}),(0,s.jsx)("option",{value:"Al Bustan Centre & Residence - Qusais - Dubai - UAE",children:"Al Bustan Centre, Dubai"}),(0,s.jsx)("option",{value:"New API Building - Barsha Heights - Dubai - UAE",children:"TECOM, Dubai"}),(0,s.jsx)("option",{value:"Dominos Pizza Building - Al Muraqqabat - Dubai - UAE",children:"Al Muraqqabat, Dubai"})]})]})]})]}),(0,s.jsxs)("div",{id:"invoice-content",className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-6",children:[(0,s.jsxs)("div",{children:[i?(0,s.jsx)("input",{value:o.title,onChange:e=>m("title",e.target.value),className:"text-2xl font-bold text-indigo-700 border-b border-gray-300 focus:outline-none"}):(0,s.jsx)("h2",{className:"text-2xl font-bold text-indigo-700",children:o.title}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Booking ID: ",a.id]})]}),(0,s.jsx)("div",{className:"text-right",children:["businessName","businessEmail","businessPhone","businessAddress"].map(e=>(0,s.jsx)("p",{className:"text-sm text-gray-500",children:i?(0,s.jsx)("input",{value:o[e],onChange:t=>m(e,t.target.value),className:"border-b border-gray-300 focus:outline-none text-right w-full"}):o[e]},e))})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-sm",children:["customerName","customerEmail","customerPhone","branch","bookingDate","bookingTime","staff"].map(e=>(0,s.jsx)("div",{children:(0,s.jsxs)("p",{children:[(0,s.jsxs)("strong",{children:[e.replace(/([A-Z])/g," $1"),": "]}),i?(0,s.jsx)("input",{value:o[e],onChange:t=>m(e,t.target.value),className:"border-b border-gray-300 focus:outline-none"}):o[e]]})},e))}),(0,s.jsxs)("div",{className:"mb-4 text-sm",children:[(0,s.jsx)("h4",{className:"font-semibold mb-2",children:"Payment Details:"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:o.paymentDetails.map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between border-b pb-1",children:[(0,s.jsxs)("span",{children:[e.method.toUpperCase(),":"]}),(0,s.jsxs)("span",{children:["AED ",e.amount.toFixed(2)]})]},t))})]}),(0,s.jsx)("div",{className:"border rounded-lg mb-4 overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-3 text-left",children:"Service"}),(0,s.jsx)("th",{className:"p-3 text-left",children:"Staff"}),(0,s.jsx)("th",{className:"p-3 text-center",children:"Qty"}),(0,s.jsx)("th",{className:"p-3 text-right",children:"Price"}),(0,s.jsx)("th",{className:"p-3 text-right",children:"Tip"}),(0,s.jsx)("th",{className:"p-3 text-right",children:"Total"})]})}),(0,s.jsx)("tbody",{children:o.services.map((e,t)=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"p-3",children:i?(0,s.jsx)("input",{value:e.serviceName,onChange:e=>{let a=[...o.services];a[t].serviceName=e.target.value,m("services",a)},className:"border-b border-gray-300 focus:outline-none w-full"}):e.serviceName}),(0,s.jsx)("td",{className:"p-3",children:i?(0,s.jsx)("input",{value:e.staffMember||"",onChange:e=>{let a=[...o.services];a[t].staffMember=e.target.value,m("services",a)},className:"border-b border-gray-300 focus:outline-none w-full"}):e.staffMember||"N/A"}),(0,s.jsx)("td",{className:"p-3 text-center",children:i?(0,s.jsx)("input",{value:e.quantity,onChange:e=>{let a=[...o.services];a[t].quantity=e.target.value,m("services",a)},className:"border-b border-gray-300 focus:outline-none w-16 text-center"}):e.quantity}),(0,s.jsx)("td",{className:"p-3 text-right",children:i?(0,s.jsx)("input",{value:e.price,onChange:e=>{let a=[...o.services];a[t].price=e.target.value,m("services",a)},className:"border-b border-gray-300 focus:outline-none w-20 text-right"}):"AED ".concat(Number(e.price).toFixed(2))}),(0,s.jsx)("td",{className:"p-3 text-right",children:void 0!==e.tip&&null!==e.tip&&""!==e.tip?"AED ".concat(Number(e.tip).toFixed(2)):"-"}),(0,s.jsxs)("td",{className:"p-3 text-right",children:["AED ",(Number(e.price)*Number(e.quantity)+(Number(e.tip)||0)).toFixed(2)]})]},t))})]})}),(0,s.jsxs)("div",{className:"flex flex-col items-end gap-2 text-sm",children:[["totalPrice","tip","discount"].map(e=>(0,s.jsxs)("div",{className:"flex justify-between w-64",children:[(0,s.jsx)("span",{children:"totalPrice"===e?"Subtotal:":"tip"===e?"Tip:":"Discount:"}),(0,s.jsx)("span",{children:i?(0,s.jsx)("input",{value:o[e],onChange:t=>m(e,t.target.value),className:"border-b border-gray-300 focus:outline-none text-right w-20"}):"AED ".concat(Number(o[e]||0).toFixed(2))})]},e)),(0,s.jsxs)("div",{className:"flex justify-between w-64 border-t pt-2 font-bold",children:[(0,s.jsx)("span",{children:"Grand Total:"}),(0,s.jsxs)("span",{children:["AED ",x.toFixed(2)]})]})]}),(0,s.jsx)("div",{className:"mt-6 text-center text-sm text-gray-500",children:i?(0,s.jsx)("textarea",{value:o.footerText,onChange:e=>m("footerText",e.target.value),className:"border border-gray-300 rounded p-2 w-full focus:outline-none"}):o.footerText})]}),(0,s.jsxs)("div",{className:"p-4 border-t flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:l,className:"px-4 py-2 bg-gray-100 rounded-md",children:"Close"}),d&&(0,s.jsx)("button",{onClick:()=>n(!i),className:"px-4 py-2 bg-indigo-500 text-white rounded-md",children:i?"Save Changes":"Edit Invoice"}),(0,s.jsx)("button",{onClick:h,className:"px-4 py-2 bg-pink-600 text-white rounded-md",children:"Download PDF"})]})]})})}),eo=[];function ec(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a=(0,r.useRef)(null);return(0,r.useCallback)(function(){for(var s=arguments.length,r=Array(s),l=0;l<s;l++)r[l]=arguments[l];a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{e(...r)},t)},[e,t])}let ed=["AI Bustaan","Marina","TECOM","AL Muraqabat","IBN Batutta Mall"],em=Object.fromEntries(Array.from(new Set((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1440,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,s=[];for(let r=e;r<=t;r+=a){let e=Math.floor(r/60).toString().padStart(2,"0"),t=(r%60).toString().padStart(2,"0");s.push("".concat(e,":").concat(t))}return s})().map(e=>e.split(":")[0]))).sort((e,t)=>Number(e)-Number(t)).map(e=>[e,!0])),eu={serviceId:"",serviceName:"",category:"",duration:30,price:0,quantity:1},eh=(0,r.memo)(function(){let{bookings:e,loading:t,saveBooking:a,deleteBooking:n}=function(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0),l=(0,r.useRef)(!0);(0,r.useEffect)(()=>{l.current=!0;let e=(0,el.P)((0,el.rJ)(ei.db,"bookings"),(0,el.My)("createdAt","desc")),a=(0,el.aQ)(e,e=>{if(!l.current)return;let a=e.docs.map(e=>{var t,a,s,r,l,i,n;let o,c=e.data();return o=(null==(t=c.bookingDate)?void 0:t.toDate)?c.bookingDate.toDate():"string"==typeof c.bookingDate?new Date(c.bookingDate):(null==(a=c.bookingDate)?void 0:a.seconds)?new Date(1e3*c.bookingDate.seconds):new Date,{id:e.id,userId:c.userId||"",customerName:c.customerName||"",services:c.services||[],bookingDate:o,bookingTime:c.bookingTime||"",branch:c.branch||"",staff:(null==(s=c.staff)?void 0:s.trim())||(null==(r=c.staffName)?void 0:r.trim())||"Unassigned",totalPrice:c.totalPrice||0,totalDuration:c.totalDuration||0,status:c.status||"upcoming",paymentMethod:c.paymentMethod||"cash",emailConfirmation:c.emailConfirmation||!1,smsConfirmation:c.smsConfirmation||!1,createdAt:(null==(l=c.createdAt)?void 0:l.toDate)?c.createdAt.toDate():new Date,updatedAt:(null==(i=c.updatedAt)?void 0:i.toDate)?c.updatedAt.toDate():new Date,remarks:null!=(n=c.remarks)?n:null,customerEmail:c.customerEmail||"",tipAmount:c.tipAmount||0,discount:c.discount||0}});JSON.stringify(a)!==JSON.stringify(eo)&&(eo=a,t(a)),s(!1)},e=>{console.error("Error fetching bookings:",e),l.current&&s(!1)});return()=>{l.current=!1,a()}},[]);let i=(0,r.useCallback)(async(e,a)=>{try{t(t=>t.map(t=>t.id===e?{...t,status:a}:t));let s=(0,el.H9)(ei.db,"bookings",e);await (0,el.mZ)(s,{status:a,updatedAt:(0,el.O5)()})}catch(a){throw console.error("Error updating booking status:",a),t(t=>t.map(t=>{var a;return t.id===e?{...t,status:(null==(a=eo.find(t=>t.id===e))?void 0:a.status)||"upcoming"}:t})),a}},[]);return{bookings:e,loading:a,updateBookingStatus:i,saveBooking:(0,r.useCallback)(async(e,t)=>{let a={...e,bookingDate:el.Dc.fromDate(e.bookingDate),updatedAt:(0,el.O5)()};if(t){let e=(0,el.H9)(ei.db,"bookings",t);await (0,el.mZ)(e,a)}else await (0,el.gS)((0,el.rJ)(ei.db,"bookings"),{...a,createdAt:(0,el.O5)()})},[]),deleteBooking:(0,r.useCallback)(async e=>{await (0,el.kd)((0,el.H9)(ei.db,"bookings",e))},[])}}(),{staff:o,branches:c,services:d,paymentMethods:m,loading:u}=function(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)([]),[l,i]=(0,r.useState)([]),[n,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(async()=>{try{let[e,a,r,l]=await Promise.all([(0,el.GG)((0,el.rJ)(ei.db,"staff")),(0,el.GG)((0,el.rJ)(ei.db,"branches")),(0,el.GG)((0,el.rJ)(ei.db,"services")),(0,el.GG)((0,el.rJ)(ei.db,"paymentMethods"))]),n=Array.from(new Set(e.docs.map(e=>String(e.data().name||e.data().staffName||"")).filter(e=>""!==e.trim()))),c=Array.from(new Set(a.docs.map(e=>String(e.data().name||"")).filter(e=>""!==e.trim())));t(n),s(c),i(r.docs.map(e=>({id:e.id,...e.data()}))),o(l.docs.map(e=>({id:e.id,...e.data()}))),console.log("Loaded resources:",{staff:n,branches:c,services:r.docs.length,paymentMethods:l.docs.length})}catch(e){console.error("Error loading resources:",e),t(["Komal","Shameem","Do Thi Kim","Alishba"]),s(["AI Bustaan","Marina","TECOM","AL Muraqabat","IBN Batutta Mall"])}finally{d(!1)}})()},[]),{staff:e,branches:a,services:l,paymentMethods:n,loading:c}}(),[h,x]=(0,r.useState)(""),[b,g]=(0,r.useState)("all"),[p,v]=(0,r.useState)({branch:"",staff:"",date:"",customer:"",time:""}),[j,y]=(0,r.useState)(!1),[N,w]=(0,r.useState)(!1),[k,C]=(0,r.useState)(null),[D,S]=(0,r.useState)(null),[A,T]=(0,r.useState)(null),[E,P]=(0,r.useState)(()=>(0,M.GP)(new Date,"yyyy-MM-dd")),[B,I]=(0,r.useState)("all"),[q,F]=(0,r.useState)(em),[O,G]=(0,r.useState)(!0);(0,r.useEffect)(()=>{t||u||G(!1)},[t,u]);let L=(0,r.useMemo)(()=>{if(!e.length)return[];let t=h.toLowerCase(),a=h.length>0,s=Object.values(p).some(Boolean),r="all"===b;if(!a&&!s&&r)return e;let l=p.branch,i=p.staff,n=p.date,o=p.customer.toLowerCase(),c=p.time;return e.filter(e=>{if(!r&&e.status!==b||l&&e.branch!==l||i&&e.staff!==i||n&&(0,M.GP)(e.bookingDate,"yyyy-MM-dd")!==n||o&&!e.customerName.toLowerCase().includes(o)||c&&e.bookingTime!==c)return!1;if(a){let a=e.customerName.toLowerCase(),s=e.branch.toLowerCase();return a.includes(t)||s.includes(t)||e.services.some(e=>e.serviceName.toLowerCase().includes(t))}return!0})},[e,h,b,p]);(0,r.useMemo)(()=>{if(!e.length)return[];let t=new Set;for(let a=0;a<e.length;a++){let s=e[a].bookingTime;s&&t.add(s)}return Array.from(t).sort()},[e]),(0,r.useMemo)(()=>c.length?c:ed,[c]);let R=(0,r.useMemo)(()=>o,[o]),U=(0,r.useMemo)(()=>d,[d]),H=(0,r.useMemo)(()=>m,[m]);(0,r.useCallback)(()=>{C(null),T(null),y(!0)},[]);let X=(0,r.useCallback)((e,t)=>{q[t.split(":")[0]]&&(C(null),T({branch:ed[0],serviceDate:E,serviceTime:t,customerName:"",customerEmail:"",paymentMethod:"cash",paymentDetails:[{method:"cash",amount:0}],customPaymentMethod:"",emailConfirmation:!1,smsConfirmation:!1,status:"upcoming",staff:e,services:[eu],remarks:"",tip:0,discount:0}),y(!0))},[q,E]),J=(0,r.useCallback)(e=>{C(e.id),T({branch:e.branch||ed[0],serviceDate:(0,M.GP)(e.bookingDate,"yyyy-MM-dd"),serviceTime:e.bookingTime||"10:00",customerName:e.customerName||"",customerEmail:e.customerEmail||"",paymentMethod:e.paymentMethod||"cash",paymentDetails:e.paymentDetails||[{method:e.paymentMethod||"cash",amount:e.totalPrice||0}],customPaymentMethod:"",emailConfirmation:!!e.emailConfirmation,smsConfirmation:!!e.smsConfirmation,status:e.status||"upcoming",staff:e.staff||"",services:e.services&&e.services.length>0?e.services.map(e=>({serviceId:e.serviceId||"",serviceName:e.serviceName||"",category:e.category||"",duration:Number(e.duration)||0,price:Number(e.price)||0,quantity:Number(e.quantity)||1,staffMember:e.staffMember||""})):[{...eu,staffMember:""}],remarks:e.remarks||"",tip:e.tipAmount||0,discount:e.discount||0}),y(!0)},[]),_=(0,r.useCallback)(e=>{S(e),w(!0)},[]),Q=(0,r.useCallback)(async(e,t)=>{let s=0,r=0,l=e.services.map(e=>{let t=Number(e.price)||0,a=Number(e.duration)||0,l=Number(e.quantity)||0;return s+=t*l,r+=a*l,{...e,price:t,duration:a,quantity:l}}),i={userId:(0,er.A)(),customerName:e.customerName.trim(),services:l,bookingDate:new Date(e.serviceDate+"T00:00:00"),bookingTime:e.serviceTime,branch:e.branch,customerEmail:e.customerEmail.trim(),staff:e.staff||null,totalPrice:s,totalDuration:r,status:e.status,paymentMethod:"custom"===e.paymentMethod?e.customPaymentMethod:e.paymentMethod,emailConfirmation:e.emailConfirmation,smsConfirmation:e.smsConfirmation,remarks:e.remarks||null,tipAmount:Number(e.tip)||0,discount:Number(e.discount)||0};await a(i,t)},[a]),W=(0,r.useCallback)(async e=>{await n(e)},[n]),Z=(0,r.useCallback)(()=>y(!1),[]),K=(0,r.useCallback)(()=>w(!1),[]),$=ec(Z,50),V=ec(K,50);return O?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70 z-[9999] flex flex-col items-center justify-center",children:(0,s.jsxs)("div",{className:"w-64 max-w-full mx-auto text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),(0,s.jsx)("div",{className:"text-lg font-semibold text-white mb-2",children:"Loading Bookings..."}),(0,s.jsx)("div",{className:"text-sm text-gray-300",children:"Please wait while we fetch your data"})]})}):(0,s.jsx)(l.A,{children:(0,s.jsx)(i,{children:(0,s.jsxs)("div",{className:"w-full px-4 sm:px-2 lg:px-2 dark:text-white",children:[(0,s.jsx)(f,{bookings:L,enabledHours:q,onHoursChange:F}),(0,s.jsx)(z,{bookings:L,staffOptions:R,scheduleDate:E,scheduleBranch:B,enabledHours:q,onCellClick:X,onEditBooking:J,onGenerateInvoice:_}),0===L.length&&(0,s.jsxs)("div",{className:"text-center py-12 w-full",children:[(0,s.jsx)("div",{className:"mx-auto h-12 w-12 text-gray-400",children:"\uD83D\uDCC5"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No bookings found"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:h||"all"!==b?"Try adjusting your search or filter criteria.":"No bookings have been made yet."})]}),(0,s.jsx)(et,{isOpen:j,isEditing:!!k,editingId:k,bookingData:A,staffOptions:R,serviceOptions:U,paymentMethods:H,enabledHours:q,onSave:Q,onDelete:W,onClose:$,onGenerateInvoice:_}),(0,s.jsx)(en,{isOpen:N,invoiceData:D,onClose:V})]})})})})}},e=>{e.O(0,[9135,7210,3930,5033,1748,9836,6373,4341,9323,8441,5964,7358],()=>e(e.s=10754)),_N_E=e.O()}]);